/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => RaindropToObsidian
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");
var import_obsidian4 = require("obsidian");

// src/utils/fileUtils.ts
async function doesPathExist(app, path) {
  return app.vault.adapter.exists(path);
}
async function isPathAFolder(app, path) {
  const stat = await app.vault.adapter.stat(path);
  return (stat == null ? void 0 : stat.type) === "folder";
}
async function createFolder(app, path) {
  const doesFolderExist = await doesPathExist(app, path);
  if (doesFolderExist) {
    const isFolder = await isPathAFolder(app, path);
    if (isFolder) return true;
    throw new Error(`Path exists but is not a folder: ${path}`);
  }
  try {
    await app.vault.createFolder(path);
    return true;
  } catch (error) {
    const errorMessage = error instanceof Error ? error.message : String(error);
    throw new Error(`Failed to create folder at ${path}: ${errorMessage}`);
  }
}
function sanitizeFileName(fileName) {
  const invalidChars = /[/\\:*?"<>|#%&{}$!@'`+=]/g;
  const replacement = "";
  const isStringEmpty = !fileName || fileName.trim() === "";
  if (isStringEmpty) return "Unnamed_Raindrop";
  const sanitizedName = fileName.replace(invalidChars, replacement).trim();
  const isSanitizedEmpty = !sanitizedName;
  const maxLength = 200;
  return (isSanitizedEmpty ? "Unnamed_Raindrop" : sanitizedName).substring(0, maxLength);
}
async function createFolderStructure(app, fullPath) {
  if (!fullPath || fullPath === "/") return true;
  try {
    const doesExist = await doesPathExist(app, fullPath);
    if (doesExist) {
      const isFolder = await isPathAFolder(app, fullPath);
      if (isFolder) return true;
      throw new Error(`Path exists but is not a folder: ${fullPath}`);
    }
    const lastSlashIndex = fullPath.lastIndexOf("/");
    if (lastSlashIndex > 0) {
      const parentPath = fullPath.substring(0, lastSlashIndex);
      await createFolderStructure(app, parentPath);
    }
    await createFolder(app, fullPath);
    return true;
  } catch (error) {
    const errorMessage = error instanceof Error ? error.message : String(error);
    throw new Error(`Failed to create/verify folder: ${fullPath}. Error: ${errorMessage}.`);
  }
}

// src/utils/apiUtils.ts
var import_obsidian = require("obsidian");
function createRateLimiter(maxRequestsPerMinute = 60, delayBetweenRequests = 300) {
  let requestCount = 0;
  let resetTime = Date.now() + 6e4;
  const checkLimit = async () => {
    const now = Date.now();
    if (now > resetTime) {
      resetTime = now + 6e4;
      requestCount = 0;
    }
    if (requestCount >= maxRequestsPerMinute) {
      const waitTime = resetTime - now;
      console.log(`Rate limit reached. Waiting ${waitTime}ms before next request.`);
      await new Promise((resolve) => setTimeout(resolve, waitTime));
      resetTime = Date.now() + 6e4;
      requestCount = 0;
    } else {
      await new Promise((resolve) => setTimeout(resolve, delayBetweenRequests));
    }
    requestCount++;
  };
  const resetCounter = () => {
    resetTime = Date.now() + 6e4;
    requestCount = 0;
    console.log("Rate limiter counter reset.");
  };
  return { checkLimit, resetCounter };
}
function parseApiResponse(response) {
  if (typeof response === "string") {
    return JSON.parse(response);
  }
  return response;
}
async function handleRequestError(error, rateLimiter, attemptNumber, maxRetries, delayBetweenRetries) {
  const isLastAttempt = attemptNumber >= maxRetries - 1;
  if (error.status === 429 || error.message && error.message.includes("rate limit")) {
    console.log("Rate limit hit, resetting counter and waiting...");
    rateLimiter.resetCounter();
    await new Promise((resolve) => setTimeout(resolve, delayBetweenRetries * 2));
    return true;
  }
  console.error(`Error in API request (attempt ${attemptNumber + 1}/${maxRetries}):`, error);
  if (!isLastAttempt) {
    await new Promise((resolve) => setTimeout(resolve, delayBetweenRetries));
    return true;
  }
  return false;
}
async function fetchWithRetry(appOrUrl, urlOrOptions, optionsOrRateLimiter, rateLimiterOrMaxRetries, maxRetries = 3, delayBetweenRetries = 1e3) {
  let app;
  let url;
  let requestOptions;
  let rateLimiter;
  if (typeof appOrUrl === "string") {
    url = appOrUrl;
    requestOptions = urlOrOptions;
    rateLimiter = optionsOrRateLimiter;
    if (typeof rateLimiterOrMaxRetries === "number") {
      maxRetries = rateLimiterOrMaxRetries;
    }
  } else {
    app = appOrUrl;
    url = urlOrOptions;
    requestOptions = optionsOrRateLimiter;
    rateLimiter = rateLimiterOrMaxRetries;
  }
  for (let attemptNumber = 0; attemptNumber < maxRetries; attemptNumber++) {
    const isLastAttempt = attemptNumber === maxRetries - 1;
    try {
      await rateLimiter.checkLimit();
      const response = await (0, import_obsidian.request)({
        url,
        method: requestOptions.method || "GET",
        headers: requestOptions.headers,
        body: requestOptions.body
      });
      return parseApiResponse(response);
    } catch (error) {
      if (!await handleRequestError(error, rateLimiter, attemptNumber, maxRetries, delayBetweenRetries) && isLastAttempt) {
        throw error;
      }
    }
  }
  throw new Error("Request failed after maximum retry attempts");
}

// src/utils/yamlUtils.ts
var import_obsidian2 = require("obsidian");
function isPlainObject(value) {
  return value !== null && typeof value === "object" && !Array.isArray(value);
}
function formatYamlValue(value, indentLevel = 0) {
  const indent = "  ".repeat(indentLevel);
  if (value === null || value === void 0) {
    return "null";
  }
  if (typeof value === "boolean") {
    return value ? "true" : "false";
  }
  if (typeof value === "number") {
    return value.toString();
  }
  if (typeof value === "string") {
    if (value.includes("\n") || value.includes(":") || value.includes("{") || value.includes("}") || value.includes("[") || value.includes("]") || value.includes("#") || value.includes("*") || value.includes("&") || value.includes("!") || value.includes("|") || value.includes(">") || value.includes("`") || value.trim() === "" || /^[0-9]/.test(value) || // Starts with number
    /^true$|^false$|^yes$|^no$|^on$|^off$/i.test(value)) {
      if (value.includes("\n")) {
        let result = "|\n";
        const lines = value.split("\n");
        for (const line of lines) {
          result += `${indent}  ${line}
`;
        }
        return result.trimEnd();
      }
      return `"${escapeYamlString(value)}"`;
    }
    return value;
  }
  if (Array.isArray(value)) {
    if (value.length === 0) {
      return "[]";
    }
    let result = "\n";
    for (const item of value) {
      result += `${indent}- ${formatYamlValue(item, indentLevel + 1)}
`;
    }
    return result.trimEnd();
  }
  if (isPlainObject(value)) {
    const keys = Object.keys(value);
    if (keys.length === 0) {
      return "{}";
    }
    let result = "\n";
    for (const key of keys) {
      const formattedValue = formatYamlValue(value[key], indentLevel + 1);
      if (formattedValue.startsWith("\n")) {
        result += `${indent}${key}:${formattedValue}
`;
      } else {
        result += `${indent}${key}: ${formattedValue}
`;
      }
    }
    return result.trimEnd();
  }
  try {
    return JSON.stringify(value);
  } catch (error) {
    console.error("Error formatting YAML value:", error);
    return `"Error formatting value"`;
  }
}
function escapeYamlString(str) {
  return str.replace(/\\/g, "\\\\").replace(/"/g, '\\"').replace(/\t/g, "\\t").replace(/\r/g, "\\r");
}
function createYamlFrontmatter(data) {
  try {
    let frontmatter = "---\n";
    for (const [key, value] of Object.entries(data)) {
      const formattedValue = formatYamlValue(value);
      if (formattedValue.startsWith("\n")) {
        frontmatter += `${key}:${formattedValue}
`;
      } else {
        frontmatter += `${key}: ${formattedValue}
`;
      }
    }
    frontmatter += "---\n\n";
    return frontmatter;
  } catch (error) {
    console.error("Error creating YAML frontmatter:", error);
    new import_obsidian2.Notice("Error creating note frontmatter. Check console for details.");
    return '---\ntitle: "Error creating frontmatter"\n---\n\n';
  }
}

// src/main.ts
var RaindropTypes = {
  LINK: "link",
  ARTICLE: "article",
  IMAGE: "image",
  VIDEO: "video",
  DOCUMENT: "document",
  AUDIO: "audio"
};
var TagMatchTypes = {
  ALL: "all",
  ANY: "any"
};
var SystemCollections = {
  UNSORTED: -1,
  TRASH: -99
};
var FilterTypes = {
  ...RaindropTypes,
  ALL: "all"
};
var DEFAULT_SETTINGS = {
  raindropApiToken: "",
  defaultVaultLocation: "",
  fileNameTemplate: "{{title}}",
  showRibbonIcon: true,
  bannerFieldName: "banner"
};
var RaindropToObsidian = class extends import_obsidian3.Plugin {
  // Descriptive variable names with auxiliary verbs
  constructor(app, manifest) {
    super(app, manifest);
    // Property to store the ribbon icon element
    this.isRibbonShown = false;
    this.settings = { ...DEFAULT_SETTINGS };
    this.rateLimiter = createRateLimiter();
  }
  async onload() {
    await this.loadSettings();
    this.addCommand({
      id: "fetch-raindrops",
      name: "Fetch Raindrops",
      callback: async () => {
        new RaindropFetchModal(this.app, this).open();
      }
    });
    this.updateRibbonIcon();
    this.addSettingTab(new RaindropToObsidianSettingTab(this.app, this));
    console.log("Make It Rain plugin loaded!");
  }
  onunload() {
    var _a;
    (_a = this.ribbonIconEl) == null ? void 0 : _a.remove();
    console.log("Make It Rain plugin unloaded.");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  /**
   * Generates a file name based on the provided raindrop data and settings
   * @param raindrop - The raindrop data to use for file name generation
   * @param useRaindropTitleForFileName - Whether to use the raindrop title for the file name
   * @returns The generated file name
   */
  generateFileName(raindrop, useRaindropTitleForFileName) {
    var _a;
    const fileNameTemplate = useRaindropTitleForFileName ? this.settings.fileNameTemplate : "{{id}}";
    let fileName = fileNameTemplate;
    const replacePlaceholder = (placeholder, value) => {
      const safeValue = sanitizeFileName(value);
      const regex = new RegExp(`{{${placeholder}}}`, "gi");
      fileName = fileName.replace(regex, safeValue);
    };
    try {
      replacePlaceholder("title", raindrop.title || "Untitled");
      replacePlaceholder("id", (raindrop._id || "unknown_id").toString());
      replacePlaceholder("collectionTitle", ((_a = raindrop.collection) == null ? void 0 : _a.title) || "No Collection");
      const createdDate = raindrop.created ? new Date(raindrop.created) : null;
      let formattedDate = "no_date";
      if (createdDate && !isNaN(createdDate.getTime())) {
        formattedDate = createdDate.toISOString().split("T")[0];
      }
      replacePlaceholder("date", formattedDate);
    } catch (error) {
      let errorMsg = "template processing error";
      if (error instanceof Error) errorMsg = error.message;
      console.error("Error processing file name template:", errorMsg, error);
      new import_obsidian3.Notice("Error generating file name. Check console or template.");
      return "Error_Filename_" + Date.now();
    }
    let finalFileName = sanitizeFileName(fileName);
    if (!finalFileName.trim()) {
      return "Unnamed_Raindrop_" + (raindrop._id || Date.now());
    }
    return finalFileName;
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  sanitizeFileName(name) {
    return sanitizeFileName(name);
  }
  /**
   * Update the ribbon icon based on settings
   */
  updateRibbonIcon() {
    var _a;
    (_a = this.ribbonIconEl) == null ? void 0 : _a.remove();
    this.ribbonIconEl = void 0;
    if (this.settings.showRibbonIcon) {
      this.ribbonIconEl = this.addRibbonIcon(
        "cloud-download",
        // Obsidian icon ID for cloud download
        "Fetch Raindrops",
        // Tooltip text
        () => {
          new RaindropFetchModal(this.app, this).open();
        }
      );
    }
  }
  async fetchRaindrops(options) {
    var _a;
    const baseApiUrl = "https://api.raindrop.io/rest/v1";
    const fetchOptions = {
      method: "GET",
      headers: {
        "Authorization": `Bearer ${this.settings.raindropApiToken}`
      }
    };
    const loadingNotice = new import_obsidian3.Notice("Starting Raindrop fetch...", 0);
    try {
      let allData = [];
      const perPage = 50;
      if (!this.settings.raindropApiToken) {
        loadingNotice.hide();
        new import_obsidian3.Notice("Please configure your Raindrop.io API token in the plugin settings.", 1e4);
        return;
      }
      let resolvedCollectionIds = [];
      const collectionNameToIdMap = /* @__PURE__ */ new Map();
      const collectionIdToNameMap = /* @__PURE__ */ new Map();
      const collectionHierarchy = /* @__PURE__ */ new Map();
      let collectionsData = void 0;
      if (options.collections) {
        const collectionInputs = options.collections.split(",").map((input) => input.trim()).filter((input) => input !== "");
        loadingNotice.setMessage("Fetching user collections...");
        const rootCollectionsResponse = await fetchWithRetry(
          `${baseApiUrl}/collections`,
          fetchOptions,
          this.rateLimiter
        );
        const rootCollectionsData = rootCollectionsResponse;
        const nestedCollectionsResponse = await fetchWithRetry(
          `${baseApiUrl}/collections/childrens`,
          fetchOptions,
          this.rateLimiter
        );
        const nestedCollectionsData = nestedCollectionsResponse;
        let allCollections = [];
        if ((rootCollectionsData == null ? void 0 : rootCollectionsData.result) && (rootCollectionsData == null ? void 0 : rootCollectionsData.items)) {
          allCollections = allCollections.concat(rootCollectionsData.items);
        }
        if ((nestedCollectionsData == null ? void 0 : nestedCollectionsData.result) && (nestedCollectionsData == null ? void 0 : nestedCollectionsData.items)) {
          allCollections = allCollections.concat(nestedCollectionsData.items);
        }
        if (allCollections.length === 0) {
          console.error("API Error fetching collections: No collections returned from both endpoints.");
          loadingNotice.hide();
          new import_obsidian3.Notice("Error fetching user collections. Please check your API token and connection.", 1e4);
          return;
        }
        allCollections.forEach((col) => {
          var _a2;
          collectionNameToIdMap.set(col.title.toLowerCase(), col._id);
          collectionIdToNameMap.set(col._id, col.title);
          collectionHierarchy.set(col._id, { title: col.title, parentId: (_a2 = col.parent) == null ? void 0 : _a2.$id });
        });
        collectionsData = { result: true, items: allCollections };
        const unresolvedInputs = [];
        for (const input of collectionInputs) {
          const inputAsNumber = parseInt(input, 10);
          if (!isNaN(inputAsNumber)) {
            if (collectionIdToNameMap.has(inputAsNumber)) {
              resolvedCollectionIds.push(inputAsNumber);
            } else {
              unresolvedInputs.push(input);
              console.warn(`Could not find collection with ID: ${input}`);
            }
          } else {
            const resolvedId = collectionNameToIdMap.get(input.toLowerCase());
            if (resolvedId !== void 0) {
              resolvedCollectionIds.push(resolvedId);
            } else {
              unresolvedInputs.push(input);
              console.warn(`Could not resolve collection name: ${input}`);
            }
          }
        }
        if (unresolvedInputs.length > 0) {
          new import_obsidian3.Notice(`Could not find collections: ${unresolvedInputs.join(", ")}. Please check names or use IDs.`, 15e3);
        }
        if (resolvedCollectionIds.length === 0 && collectionInputs.length > 0) {
          loadingNotice.hide();
          new import_obsidian3.Notice("No valid collection IDs or names provided.", 5e3);
          return;
        }
        resolvedCollectionIds = Array.from(new Set(resolvedCollectionIds));
      } else {
        loadingNotice.setMessage("Fetching all collections...");
        const rootCollectionsResponse = await fetchWithRetry(
          `${baseApiUrl}/collections`,
          fetchOptions,
          this.rateLimiter
        );
        const rootCollectionsData = rootCollectionsResponse;
        const nestedCollectionsResponse = await fetchWithRetry(
          `${baseApiUrl}/collections/childrens`,
          fetchOptions,
          this.rateLimiter
        );
        const nestedCollectionsData = nestedCollectionsResponse;
        let allCollections = [];
        if ((rootCollectionsData == null ? void 0 : rootCollectionsData.result) && (rootCollectionsData == null ? void 0 : rootCollectionsData.items)) {
          allCollections = allCollections.concat(rootCollectionsData.items);
        }
        if ((nestedCollectionsData == null ? void 0 : nestedCollectionsData.result) && (nestedCollectionsData == null ? void 0 : nestedCollectionsData.items)) {
          allCollections = allCollections.concat(nestedCollectionsData.items);
        }
        if (allCollections.length === 0) {
          console.error("API Error fetching collections: No collections returned from both endpoints.");
          loadingNotice.hide();
          new import_obsidian3.Notice("Error fetching user collections. Please check your API token and connection.", 1e4);
          return;
        }
        allCollections.forEach((col) => {
          var _a2;
          collectionNameToIdMap.set(col.title.toLowerCase(), col._id);
          collectionIdToNameMap.set(col._id, col.title);
          collectionHierarchy.set(col._id, { title: col.title, parentId: (_a2 = col.parent) == null ? void 0 : _a2.$id });
        });
        collectionsData = { result: true, items: allCollections };
      }
      const searchParameterString = options.apiFilterTags.split(",").map((tag) => tag.trim()).filter((tag) => tag !== "").join(" ");
      let fetchMode = "all";
      if (resolvedCollectionIds.length > 0) {
        fetchMode = "collections";
      } else if (searchParameterString || options.tagMatchType === TagMatchTypes.ANY && options.apiFilterTags.length > 0) {
        fetchMode = "tags";
      }
      if (fetchMode === "collections") {
        for (const collectionId of resolvedCollectionIds) {
          let hasMore = true;
          let page = 0;
          const collectionApiBaseUrl = `${baseApiUrl}/raindrops/${collectionId}`;
          while (hasMore) {
            const params = new URLSearchParams({
              perpage: perPage.toString(),
              page: page.toString()
            });
            if (options.filterType && options.filterType !== "all") {
              params.append("type", options.filterType);
            }
            if (searchParameterString) {
              params.append("search", searchParameterString);
            }
            if (options.includeSubcollections) {
              params.append("nested", "true");
            }
            const currentApiUrl = `${collectionApiBaseUrl}?${params.toString()}`;
            console.log(`Requesting items from collection ID: ${collectionId}`, currentApiUrl);
            const collectionNameForNotice = collectionIdToNameMap.get(collectionId) || collectionId.toString();
            loadingNotice.setMessage(`Fetching from collection: ${collectionNameForNotice}, page ${page + 1}...`);
            const response = await fetchWithRetry(currentApiUrl, fetchOptions, this.rateLimiter);
            const data = response;
            if (!data.result) {
              console.error(`API Error for collection ${collectionId}:`, data);
              new import_obsidian3.Notice(`Error fetching collection: ${collectionNameForNotice}. Skipping.`, 7e3);
              hasMore = false;
              continue;
            }
            if (data == null ? void 0 : data.items) {
              allData = allData.concat(data.items);
              page++;
              hasMore = data.items.length === perPage;
              console.log(`Fetched ${data.items.length} items from collection ${collectionId}, page ${page}`);
              if (hasMore) {
                loadingNotice.setMessage(`Fetching from collection: ${collectionNameForNotice}, page ${page + 1}...`);
              }
            } else {
              console.warn(`Unexpected response for collection ${collectionId}. Stopping.`);
              hasMore = false;
            }
          }
        }
      } else if (fetchMode === "tags") {
        if (options.tagMatchType === TagMatchTypes.ANY && options.apiFilterTags.length > 0) {
          const uniqueItems = /* @__PURE__ */ new Map();
          const tagsArray = options.apiFilterTags.split(",").map((tag) => tag.trim()).filter((tag) => tag !== "");
          for (const tag of tagsArray) {
            let hasMore = true;
            let page = 0;
            while (hasMore) {
              const params = new URLSearchParams({
                perpage: perPage.toString(),
                page: page.toString(),
                search: `#${tag}`
                // Simple, reliable single-tag search
              });
              if (options.filterType && options.filterType !== "all") {
                params.append("type", options.filterType);
              }
              const currentApiUrl = `${baseApiUrl}/raindrops/0?${params.toString()}`;
              console.log(`Requesting items with tag: ${tag}`, currentApiUrl);
              loadingNotice.setMessage(`Fetching items with tag: ${tag}, page ${page + 1}...`);
              const response = await fetchWithRetry(this.app, currentApiUrl, fetchOptions, this.rateLimiter);
              const data = response;
              if (!data.result) {
                console.error(`API Error for tag ${tag}:`, data);
                continue;
              }
              console.log(`API Response for tag ${tag}:`, {
                result: data.result,
                itemCount: ((_a = data == null ? void 0 : data.items) == null ? void 0 : _a.length) || 0,
                totalCount: (data == null ? void 0 : data.count) || 0
              });
              if (data == null ? void 0 : data.items) {
                data.items.forEach((item) => {
                  if (!uniqueItems.has(item._id)) {
                    uniqueItems.set(item._id, item);
                  }
                });
                page++;
                hasMore = data.items.length === perPage;
                console.log(`Fetched ${data.items.length} items for tag ${tag}, page ${page}`);
                if (hasMore) {
                  loadingNotice.setMessage(`Fetching items with tag: ${tag}, page ${page + 1}...`);
                }
              } else {
                hasMore = false;
              }
            }
          }
          allData = Array.from(uniqueItems.values());
          console.log(`Total unique items found across all tags: ${allData.length}`);
        } else if (searchParameterString) {
          let hasMore = true;
          let page = 0;
          while (hasMore) {
            const params = new URLSearchParams({
              perpage: perPage.toString(),
              page: page.toString(),
              search: searchParameterString
              // This handles space-separated tags for AND logic
            });
            if (options.filterType && options.filterType !== "all") {
              params.append("type", options.filterType);
            }
            const currentApiUrl = `${baseApiUrl}/raindrops/0?${params.toString()}`;
            console.log(`Requesting items with tags: ${searchParameterString}`, currentApiUrl);
            loadingNotice.setMessage(`Fetching items with tags: ${searchParameterString}, page ${page + 1}...`);
            const response = await fetchWithRetry(currentApiUrl, fetchOptions, this.rateLimiter);
            const data = response;
            if (!data.result) {
              console.error("API Error for tag search:", data);
              throw new Error(`API Error: ${JSON.stringify(data)}`);
            }
            if (data == null ? void 0 : data.items) {
              allData = allData.concat(data.items);
              page++;
              hasMore = data.items.length === perPage;
              console.log(`Fetched ${data.items.length} items with tags, page ${page}`);
              if (hasMore) {
                loadingNotice.setMessage(`Fetching items with tags: ${searchParameterString}, page ${page + 1}...`);
              }
            } else {
              hasMore = false;
            }
          }
        }
      } else {
        let hasMore = true;
        let page = 0;
        while (hasMore) {
          const params = new URLSearchParams({ perpage: perPage.toString(), page: page.toString() });
          if (options.filterType && options.filterType !== "all") {
            params.append("type", options.filterType);
          }
          const currentApiUrl = `${baseApiUrl}/raindrops/0?${params.toString()}`;
          console.log("Requesting all items:", currentApiUrl);
          loadingNotice.setMessage(`Fetching all items, page ${page + 1}...`);
          const response = await fetchWithRetry(currentApiUrl, fetchOptions, this.rateLimiter);
          const data = response;
          if (!data.result) {
            console.error("API Error for all items fetch:", data);
            throw new Error(`API Error: ${JSON.stringify(data)}`);
          }
          if (data == null ? void 0 : data.items) {
            allData = allData.concat(data.items);
            page++;
            hasMore = data.items.length === perPage;
            console.log(`Fetched ${data.items.length} items, page ${page}`);
            if (hasMore) {
              loadingNotice.setMessage(`Fetching all items, page ${page + 1}...`);
            }
          } else {
            console.warn("Unexpected response for all items fetch. Stopping.");
            hasMore = false;
          }
        }
      }
      if (allData.length === 0) {
        if (resolvedCollectionIds.length > 0 || searchParameterString || options.tagMatchType === TagMatchTypes.ANY && options.apiFilterTags.length > 0) {
          loadingNotice.hide();
          new import_obsidian3.Notice("No raindrops found matching your criteria.", 5e3);
        } else {
          loadingNotice.hide();
          new import_obsidian3.Notice("No raindrops found in your account.", 5e3);
        }
      } else {
        loadingNotice.setMessage(`Found ${allData.length} raindrops. Processing...`);
        await this.processRaindrops(allData, options.vaultPath, options.appendTagsToNotes, options.useRaindropTitleForFileName, loadingNotice, options, collectionsData, resolvedCollectionIds, collectionIdToNameMap);
      }
    } catch (error) {
      loadingNotice.hide();
      let errorMessage = "An unknown error occurred during fetch";
      if (error instanceof Error) errorMessage = error.message;
      else if (typeof error === "string") errorMessage = error;
      new import_obsidian3.Notice(`Error fetching raindrops: ${errorMessage}`, 1e4);
      console.error("Error fetching Raindrop API:", error);
    }
  }
  async processRaindrops(raindrops, vaultPath, appendTagsToNotes, useRaindropTitleForFileName, loadingNotice, options, collectionsData, resolvedCollectionIds = [], collectionIdToNameMap = /* @__PURE__ */ new Map()) {
    var _a, _b, _c, _d;
    const { app } = this;
    const settingsFMTags = appendTagsToNotes.split(",").map((tag) => tag.trim()).filter((tag) => tag !== "");
    if (vaultPath === void 0) vaultPath = this.settings.defaultVaultLocation;
    const targetFolderPath = (_a = vaultPath == null ? void 0 : vaultPath.trim()) != null ? _a : "";
    const collectionHierarchy = /* @__PURE__ */ new Map();
    if (collectionsData == null ? void 0 : collectionsData.result) {
      collectionsData.items.forEach((col) => {
        var _a2;
        collectionHierarchy.set(col._id, { title: col.title, parentId: (_a2 = col.parent) == null ? void 0 : _a2.$id });
      });
    }
    const getAncestorIds = (collectionId) => {
      const ancestors = [];
      ancestors.push(collectionId);
      let currentId = collectionId;
      while (currentId !== void 0 && currentId !== 0 && currentId !== SystemCollections.UNSORTED && currentId !== SystemCollections.TRASH) {
        const collection = collectionHierarchy.get(currentId);
        if (!collection || collection.parentId === void 0) {
          break;
        }
        ancestors.push(collection.parentId);
        currentId = collection.parentId;
      }
      return ancestors;
    };
    const resolvedCollectionNames = /* @__PURE__ */ new Set();
    if (collectionIdToNameMap.size > 0) {
      resolvedCollectionIds.forEach((id) => {
        const name = collectionIdToNameMap.get(id);
        if (name) {
          resolvedCollectionNames.add(this.sanitizeFileName(name).toLowerCase());
        }
      });
    }
    if (targetFolderPath) {
      try {
        const folder = app.vault.getAbstractFileByPath(targetFolderPath);
        if (!folder) {
          console.log(`Creating base folder: ${targetFolderPath}`);
          await app.vault.createFolder(targetFolderPath);
        } else if (!folder.hasOwnProperty("children")) {
          throw new Error(`Path exists but is not a folder: ${targetFolderPath}`);
        }
      } catch (error) {
        let errorMsg = "folder creation failed";
        if (error instanceof Error) errorMsg = error.message;
        new import_obsidian3.Notice(`Failed to create/verify base folder: ${targetFolderPath}. Error: ${errorMsg}.`, 1e4);
        console.error("Error with folder operation:", error);
        loadingNotice.hide();
        return;
      }
    }
    let createdCount = 0;
    let skippedCount = 0;
    let errorCount = 0;
    let updatedCount = 0;
    const total = raindrops.length;
    let processed = 0;
    const raindropsByCollection = {};
    for (const raindrop of raindrops) {
      const collectionId = ((_c = (_b = raindrop.collection) == null ? void 0 : _b.$id) == null ? void 0 : _c.toString()) || "uncategorized";
      if (!raindropsByCollection[collectionId]) {
        raindropsByCollection[collectionId] = [];
      }
      raindropsByCollection[collectionId].push(raindrop);
    }
    for (const [collectionId, collectionRaindrops] of Object.entries(raindropsByCollection)) {
      let relativeFolderPathSegments = [];
      let collectionTitleForNotice = "Unknown Collection";
      const currentCollectionId = parseInt(collectionId, 10);
      if (!isNaN(currentCollectionId) && currentCollectionId > 0 && collectionHierarchy.size > 0) {
        const ancestorIds = getAncestorIds(currentCollectionId);
        let deepestSpecifiedAncestorId = void 0;
        if (resolvedCollectionIds.length === 0) {
          deepestSpecifiedAncestorId = void 0;
        } else if (resolvedCollectionIds.includes(currentCollectionId)) {
          deepestSpecifiedAncestorId = currentCollectionId;
        } else {
          for (const ancestorId of ancestorIds) {
            if (resolvedCollectionIds.includes(ancestorId)) {
              deepestSpecifiedAncestorId = ancestorId;
              break;
            }
          }
        }
        if (deepestSpecifiedAncestorId !== void 0 || resolvedCollectionIds.length === 0) {
          const pathSegments = [];
          let currentTraverseId = currentCollectionId;
          const tempSegments = [];
          while (currentTraverseId !== void 0 && currentTraverseId !== 0 && currentTraverseId !== -1 && currentTraverseId !== -99) {
            const collection = collectionHierarchy.get(currentTraverseId);
            if (!collection) break;
            const sanitizedTitle = this.sanitizeFileName(collection.title);
            if (sanitizedTitle) {
              tempSegments.unshift(sanitizedTitle);
            }
            if (resolvedCollectionIds.length > 0 && currentTraverseId === deepestSpecifiedAncestorId) {
              break;
            }
            currentTraverseId = collection.parentId;
          }
          relativeFolderPathSegments = tempSegments;
          collectionTitleForNotice = relativeFolderPathSegments.join("/");
        } else {
          console.warn(`Collection path did not contain a user-specified ancestor or was not the specified collection itself. Placing in Uncategorized: Collection ID ${currentCollectionId}`);
          relativeFolderPathSegments = ["Uncategorized"];
          collectionTitleForNotice = "Uncategorized";
        }
      } else if (currentCollectionId === -1 || currentCollectionId === 0) {
        relativeFolderPathSegments = [];
        collectionTitleForNotice = currentCollectionId === -1 ? "Unsorted" : "All Items";
      } else if (collectionId === "uncategorized") {
        relativeFolderPathSegments = ["Uncategorized"];
        collectionTitleForNotice = "Uncategorized";
      } else {
        relativeFolderPathSegments = [];
        collectionTitleForNotice = "Unknown Collection";
        console.warn(`Could not determine collection path for ID: ${collectionId}. Placing in target folder.`);
      }
      const fullDesiredFolderPath = relativeFolderPathSegments.length > 0 ? `${targetFolderPath}${targetFolderPath ? "/" : ""}${relativeFolderPathSegments.join("/")}` : targetFolderPath;
      let currentPath = targetFolderPath;
      const pathSegmentsToCreate = relativeFolderPathSegments;
      for (const segment of pathSegmentsToCreate) {
        if (!segment) continue;
        currentPath = currentPath ? `${currentPath}/${segment}` : segment;
        try {
          await createFolderStructure(app, currentPath);
        } catch (error) {
          let errorMsg = "folder creation failed";
          if (error instanceof Error) errorMsg = error.message;
          new import_obsidian3.Notice(`Failed to create/verify folder: ${currentPath}. Error: ${errorMsg}.`, 1e4);
          console.error("Error with folder operation:", error);
          break;
        }
      }
      const collectionFolderPath = currentPath;
      for (const raindrop of collectionRaindrops) {
        try {
          const generatedFilename = this.generateFileName(raindrop, useRaindropTitleForFileName);
          const filePath = `${collectionFolderPath}/${generatedFilename}.md`;
          const raindropTitle = raindrop.title || "Untitled";
          loadingNotice.setMessage(`Processing '${raindropTitle}' in '${collectionTitleForNotice}'... (${processed}/${total})`);
          const fileExists = await app.vault.adapter.exists(filePath);
          let processOutcome = "created";
          if (fileExists) {
            if (options.fetchOnlyNew) {
              console.log(`Skipping existing file (Fetch Only New enabled): ${filePath}`);
              processOutcome = "skipped";
            } else if (options.updateExisting) {
              console.log(`Checking existing file for update: ${filePath}`);
              let shouldUpdate = false;
              try {
                const existingFile = app.vault.getAbstractFileByPath(filePath);
                if (existingFile instanceof import_obsidian3.TFile) {
                  const existingContent = await app.vault.cachedRead(existingFile);
                  const match = existingContent.match(/^---\n([^\s\S]*?)\n---/);
                  if (match && match[1]) {
                    const frontmatterRaw = match[1];
                    const idMatch = frontmatterRaw.match(/^id:\s*(\d+)/m);
                    const lastUpdateMatch = frontmatterRaw.match(/^last_update:\s*(.*)/m);
                    const existingRaindropId = idMatch && idMatch[1] ? parseInt(idMatch[1], 10) : null;
                    const existingLastUpdate = lastUpdateMatch && lastUpdateMatch[1] ? new Date(lastUpdateMatch[1]) : null;
                    const fetchedLastUpdate = new Date(raindrop.lastUpdate);
                    if (existingRaindropId === raindrop._id) {
                      if (!existingLastUpdate || isNaN(existingLastUpdate.getTime()) || fetchedLastUpdate > existingLastUpdate) {
                        console.log(`Update needed for ${filePath}: Raindrop.io data is newer or existing timestamp invalid.`);
                        shouldUpdate = true;
                      } else {
                        console.log(`No update needed for ${filePath}: Raindrop.io data is not newer.`);
                      }
                    } else {
                      console.warn(`File exists with matching name but different Raindrop ID: ${filePath} (Existing ID: ${existingRaindropId}, Fetched ID: ${raindrop._id}). Skipping.`);
                    }
                  } else {
                    console.warn(`File exists but has no valid frontmatter or required fields: ${filePath}. Skipping.`);
                  }
                } else {
                  console.warn(`Path exists but is not a file: ${filePath}. Skipping.`);
                }
              } catch (readError) {
                console.error(`Error reading existing file ${filePath}:`, readError);
                processOutcome = "error";
              }
              if (shouldUpdate) {
                processOutcome = "updated";
              } else if (processOutcome !== "error") {
                processOutcome = "skipped";
              }
            } else {
              console.log(`Skipping existing file: ${filePath}`);
              processOutcome = "skipped";
            }
          }
          if (processOutcome === "created" || processOutcome === "updated") {
            const rdTitle = raindrop.title || "Untitled Raindrop";
            const rdNoteContent = raindrop.note || "";
            const rdExcerpt = raindrop.excerpt || "";
            const rdSourceUrl = raindrop.link;
            const rdCoverUrl = raindrop.cover || "";
            const frontmatterData = {
              // Basic metadata
              id: raindrop._id,
              title: rdTitle,
              source: rdSourceUrl,
              type: raindrop.type,
              created: raindrop.created,
              last_update: raindrop.lastUpdate
            };
            if (rdExcerpt) {
              frontmatterData.description = rdExcerpt;
            }
            let collectionInfo = { id: -1, title: "Unsorted" };
            if (((_d = raindrop.collection) == null ? void 0 : _d.$id) && collectionIdToNameMap.has(raindrop.collection.$id)) {
              const collectionId2 = raindrop.collection.$id;
              const collectionTitle = collectionIdToNameMap.get(collectionId2) || "Unknown";
              collectionInfo = {
                id: collectionId2,
                title: collectionTitle
              };
              if (collectionHierarchy.has(collectionId2)) {
                const cInfo = collectionHierarchy.get(collectionId2);
                if ((cInfo == null ? void 0 : cInfo.parentId) !== void 0) {
                  collectionInfo.parent_id = cInfo.parentId;
                }
              }
            }
            frontmatterData.collection = collectionInfo;
            let combinedFMTags = [...settingsFMTags];
            if (raindrop.tags && Array.isArray(raindrop.tags)) {
              raindrop.tags.forEach((tag) => {
                const trimmedTag = tag.trim();
                if (trimmedTag && !combinedFMTags.includes(trimmedTag)) {
                  combinedFMTags.push(trimmedTag);
                }
              });
            }
            const sanitizedTags = combinedFMTags.map(
              (tag) => tag.replace(/ /g, "_").replace(/[^\w\u00C0-\u00FF\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF\/-]+/g, "")
            ).filter((tag) => tag.length > 0);
            frontmatterData.tags = sanitizedTags;
            if (rdCoverUrl) {
              frontmatterData[this.settings.bannerFieldName] = rdCoverUrl;
            }
            let noteContent = "";
            if (rdCoverUrl) {
              const altText = this.sanitizeFileName(rdTitle === "Untitled Raindrop" ? "Cover Image" : rdTitle).replace(/\.md$/i, "");
              noteContent += `![${altText}](${rdCoverUrl})

`;
            }
            noteContent += `# ${rdTitle}

`;
            if (rdExcerpt && !rdExcerpt.includes("\n")) {
              noteContent += `## Description
${rdExcerpt}

`;
            }
            if (rdNoteContent) noteContent += `## Notes
${rdNoteContent}

`;
            if (raindrop.highlights && Array.isArray(raindrop.highlights) && raindrop.highlights.length > 0) {
              noteContent += "## Highlights\n";
              raindrop.highlights.forEach((highlight) => {
                if (highlight.text) {
                  noteContent += `- ${highlight.text.replace(/r\n|r|n/g, " ")}
`;
                  if (highlight.note) {
                    noteContent += `  *Note:* ${highlight.note.replace(/r\n|r|n/g, " ")}
`;
                  }
                }
              });
              noteContent += "\n";
            }
            const frontmatter = createYamlFrontmatter(frontmatterData);
            const fileContent = frontmatter + noteContent;
            await app.vault.create(filePath, fileContent);
            if (processOutcome === "created") {
              createdCount++;
            } else if (processOutcome === "updated") {
              updatedCount++;
            }
          } else if (processOutcome === "skipped") {
            skippedCount++;
          } else if (processOutcome === "error") {
            errorCount++;
          }
          processed++;
          const raindropTitleAfterProcessing = raindrop.title || "Untitled";
          let statusText = "";
          if (processOutcome === "created") statusText = "Created";
          else if (processOutcome === "updated") statusText = "Updated";
          else if (processOutcome === "skipped") statusText = "Skipped";
          else if (processOutcome === "error") statusText = "Error";
          loadingNotice.setMessage(`${statusText} '${raindropTitleAfterProcessing}' in '${collectionTitleForNotice}'... (${processed}/${total})`);
        } catch (error) {
          errorCount++;
          processed++;
          let processErrorMsg = "An unknown error occurred";
          if (error instanceof Error) processErrorMsg = error.message;
          else if (typeof error === "string") processErrorMsg = error;
          const raindropTitleForError = (raindrop == null ? void 0 : raindrop.title) || "an unknown raindrop";
          console.error("Error processing file:", processErrorMsg, error, raindrop);
          loadingNotice.setMessage(`Error processing '${raindropTitleForError}' in '${collectionTitleForNotice}'... (${processed}/${total})`);
        }
      }
    }
    loadingNotice.hide();
    let summary = `${createdCount} notes created.`;
    if (updatedCount > 0) summary += ` ${updatedCount} updated.`;
    if (skippedCount > 0) summary += ` ${skippedCount} skipped (already exist).`;
    if (errorCount > 0) summary += ` ${errorCount} errors.`;
    new import_obsidian3.Notice(summary, 7e3);
    console.log(`Raindrop processing complete. Created: ${createdCount}, Updated: ${updatedCount}, Skipped: ${skippedCount}, Errors: ${errorCount}`);
  }
  // The updateRibbonIcon method is already defined at line ~360
};
var RaindropFetchModal = class extends import_obsidian3.Modal {
  constructor(app, plugin) {
    super(app);
    this.collections = "";
    this.apiFilterTags = "";
    this.includeSubcollections = false;
    this.appendTagsToNotes = "";
    this.useRaindropTitleForFileName = true;
    this.tagMatchType = TagMatchTypes.ALL;
    this.filterType = FilterTypes.ALL;
    this.fetchOnlyNew = false;
    this.updateExisting = false;
    this.plugin = plugin;
    this.vaultPath = this.plugin.settings.defaultVaultLocation;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h2", { text: "Make It Rain Options" });
    contentEl.createEl("h3", { text: "Fetch Criteria" });
    new import_obsidian3.Setting(contentEl).setName("Collections (comma-separated names or IDs)").setDesc("Enter collection names or IDs, separated by commas. Leave blank to fetch from all collections (unless tags below are specified).").addText((text) => {
      text.setPlaceholder("Enter Collection ID or Name or leave blank for all").setValue(this.collections).onChange((value) => {
        this.collections = value;
      });
    });
    new import_obsidian3.Setting(contentEl).setName("Filter by Tags (comma-separated)").setDesc("Filter raindrops by tags.").addText((text) => {
      text.setPlaceholder("e.g., article, project-x").setValue(this.apiFilterTags).onChange((value) => {
        this.apiFilterTags = value;
      });
    });
    new import_obsidian3.Setting(contentEl).setName("Tag Match Type").setDesc("Should raindrops match ALL specified tags or ANY of them?").addDropdown((dropdown) => {
      dropdown.addOption("all", "Match ALL tags (AND)").addOption("any", "Match ANY tag (OR)").setValue(this.tagMatchType).onChange((value) => {
        this.tagMatchType = value;
      });
    });
    new import_obsidian3.Setting(contentEl).setName("Include Subcollections").setDesc("If filtering by Collection IDs or Names, also include items from their subcollections.").addToggle((toggle) => {
      toggle.setValue(this.includeSubcollections).onChange((value) => {
        this.includeSubcollections = value;
      });
    });
    new import_obsidian3.Setting(contentEl).setName("Filter by Type").setDesc("Select the type of raindrops to fetch.").addDropdown((dropdown) => {
      dropdown.addOption("all", "All Types").addOption("link", "Links").addOption("article", "Articles").addOption("image", "Images").addOption("video", "Videos").addOption("document", "Documents").addOption("audio", "Audio").setValue(this.filterType).onChange((value) => {
        this.filterType = value;
      });
    });
    contentEl.createEl("h3", { text: "Note Options" });
    new import_obsidian3.Setting(contentEl).setName("Vault Folder (Optional)").setDesc("Target folder for notes. Leave blank for vault root or default setting.").addText((text) => {
      text.setPlaceholder(this.plugin.settings.defaultVaultLocation || "Vault Root").setValue(this.vaultPath).onChange((value) => {
        this.vaultPath = value.trim();
      });
    });
    new import_obsidian3.Setting(contentEl).setName("Append Tags to Note Frontmatter (comma-separated)").setDesc("Additional tags to add to the YAML frontmatter of each created note.").addText((text) => {
      text.setPlaceholder("e.g., #imported/raindrop").setValue(this.appendTagsToNotes).onChange((value) => {
        this.appendTagsToNotes = value;
      });
    });
    new import_obsidian3.Setting(contentEl).setName("Use Raindrop Title for File Name").setDesc("Use title (via template) for filenames? If off, uses Raindrop ID.").addToggle((toggle) => {
      toggle.setValue(this.useRaindropTitleForFileName).onChange((value) => {
        this.useRaindropTitleForFileName = value;
      });
    });
    const fetchOnlyNewSetting = new import_obsidian3.Setting(contentEl).setName("Fetch only new items").setDesc("If the target folder is not empty, only fetch raindrops that have not been imported before.").addToggle((toggle) => {
      toggle.setValue(this.fetchOnlyNew).onChange((value) => {
        this.fetchOnlyNew = value;
      });
    });
    const updateExistingSetting = new import_obsidian3.Setting(contentEl).setName("Update existing notes").setDesc("If a note with the same name exists, update its content if the source raindrop has changed.").addToggle((toggle) => {
      toggle.setValue(this.updateExisting).onChange((value) => {
        this.updateExisting = value;
        fetchOnlyNewSetting.setDisabled(value);
        if (value) {
          this.fetchOnlyNew = false;
          fetchOnlyNewSetting.controlEl.querySelector('input[type="checkbox"]').checked = false;
        }
      });
    });
    new import_obsidian3.Setting(contentEl).addButton((btn) => {
      btn.setButtonText("Fetch Raindrops").setCta().onClick(async () => {
        const options = {
          vaultPath: this.vaultPath || void 0,
          collections: this.collections,
          apiFilterTags: this.apiFilterTags,
          includeSubcollections: this.includeSubcollections,
          appendTagsToNotes: this.appendTagsToNotes,
          useRaindropTitleForFileName: this.useRaindropTitleForFileName,
          tagMatchType: this.tagMatchType,
          filterType: this.filterType,
          fetchOnlyNew: this.fetchOnlyNew,
          updateExisting: this.updateExisting
        };
        this.close();
        await this.plugin.fetchRaindrops(options);
      });
    }).addButton((btn) => {
      btn.setButtonText("Cancel").onClick(() => {
        this.close();
      });
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
var RaindropToObsidianSettingTab = class extends import_obsidian3.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("img", { attr: { src: "https://i.ibb.co/HTx7TnbN/makeitrain.png", width: "750" } });
    containerEl.createEl("h2", { text: "Import your Raindrop.io bookmarks into your Obsidian vault with ease." });
    containerEl.createEl("p").createEl("a", { text: "Visit Raindrop.io website", href: "https://raindrop.io", attr: { target: "_blank", rel: "noopener noreferrer" } });
    containerEl.createEl("hr");
    containerEl.createEl("h3", { text: "API Configuration" });
    const apiDesc = containerEl.createDiv({ cls: "setting-item-description" });
    apiDesc.createSpan({ text: "You need to create a Test Token from your " });
    apiDesc.createEl("a", { text: "Raindrop.io Apps settings page", href: "https://app.raindrop.io/settings/integrations", attr: { target: "_blank", rel: "noopener noreferrer" } });
    apiDesc.createSpan({ text: "." });
    new import_obsidian3.Setting(containerEl).setName("Raindrop.io API Token").setDesc("You need to create a Test Token from your Raindrop.io Apps settings page (https://app.raindrop.io/settings/integrations).").addText((text) => {
      text.setPlaceholder("Enter your token").setValue(this.plugin.settings.raindropApiToken).onChange(async (value) => {
        this.plugin.settings.raindropApiToken = value;
        await this.plugin.saveSettings();
      });
    }).addButton((button) => {
      button.setButtonText("Verify Token").setCta().onClick(() => this.verifyApiToken());
    });
    containerEl.createEl("hr");
    containerEl.createEl("h3", { text: "General Settings" });
    new import_obsidian3.Setting(containerEl).setName("Show Ribbon Icon").setDesc("Toggle to show or hide the Make It Rain ribbon icon.").addToggle((toggle) => {
      toggle.setValue(this.plugin.settings.showRibbonIcon).onChange(async (value) => {
        this.plugin.settings.showRibbonIcon = value;
        await this.plugin.saveSettings();
        this.plugin.updateRibbonIcon();
      });
    });
    containerEl.createEl("hr");
    containerEl.createEl("h3", { text: "Note Storage & Naming" });
    new import_obsidian3.Setting(containerEl).setName("Default Vault Location for Notes").setDesc("Default folder to save notes if not specified in the fetch options modal. Leave blank for vault root.").addText((text) => {
      text.setPlaceholder(this.plugin.settings.defaultVaultLocation || "Vault Root").setValue(this.plugin.settings.defaultVaultLocation).onChange(async (value) => {
        this.plugin.settings.defaultVaultLocation = value.trim();
        await this.plugin.saveSettings();
      });
    });
    containerEl.createEl("p", { cls: "setting-item-description", text: 'Configure how filenames are generated when "Use Raindrop Title" is enabled in the fetch options modal. Uses Handlebars-like syntax.' });
    new import_obsidian3.Setting(containerEl).setName("File Name Template").setDesc("Placeholders: {{title}}, {{id}}, {{collectionTitle}}, {{date}} (YYYY-MM-DD).").addText((text) => {
      text.setPlaceholder("{{title}}").setValue(this.plugin.settings.fileNameTemplate).onChange(async (value) => {
        this.plugin.settings.fileNameTemplate = value;
        await this.plugin.saveSettings();
      });
    });
    new import_obsidian3.Setting(containerEl).setName("Banner Frontmatter Field Name").setDesc("Customize the frontmatter field name used for the banner image. Default: banner").addText((text) => {
      text.setPlaceholder("banner").setValue(this.plugin.settings.bannerFieldName).onChange(async (value) => {
        this.plugin.settings.bannerFieldName = value.trim();
        await this.plugin.saveSettings();
      });
    });
    containerEl.createEl("hr");
    const footer = containerEl.createDiv({ cls: "setting-footer" });
    footer.createEl("p", { text: "Need help configuring or using the plugin? Check the README." });
    footer.createEl("a", { text: "Plugin GitHub Repository", href: "https://github.com/frostmute/make-it-rain", attr: { target: "_blank", rel: "noopener noreferrer" } });
  }
  async verifyApiToken() {
    const { raindropApiToken } = this.plugin.settings;
    if (!raindropApiToken) {
      new import_obsidian3.Notice("Please enter an API token first.", 5e3);
      return;
    }
    new import_obsidian3.Notice("Verifying API token...", 3e3);
    const baseApiUrl = "https://api.raindrop.io/rest/v1";
    const fetchOptions = {
      headers: {
        "Authorization": `Bearer ${raindropApiToken}`,
        "Content-Type": "application/json"
      }
    };
    try {
      const response = await (0, import_obsidian4.request)({
        url: `${baseApiUrl}/user`,
        method: "GET",
        headers: fetchOptions.headers
      });
      let data;
      if (typeof response === "string") {
        data = JSON.parse(response);
      } else {
        data = response;
      }
      if (data.result) {
        new import_obsidian3.Notice("API Token is valid!", 5e3);
      } else {
        const errorMessage = data.message || data.error || "Invalid API token or connection issue.";
        new import_obsidian3.Notice(`API Token verification failed: ${errorMessage}`, 1e4);
        console.error("API Token verification failed:", data);
      }
    } catch (error) {
      let errorMsg = "An error occurred during token verification.";
      if (error instanceof Error) errorMsg = error.message;
      else if (typeof error === "string") errorMsg = error;
      new import_obsidian3.Notice(`API Token verification failed: ${errorMsg}`, 1e4);
      console.error("Error verifying API token:", error);
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL21haW4udHMiLCAiLi4vc3JjL3V0aWxzL2ZpbGVVdGlscy50cyIsICIuLi9zcmMvdXRpbHMvYXBpVXRpbHMudHMiLCAiLi4vc3JjL3V0aWxzL3lhbWxVdGlscy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBNYWtlIEl0IFJhaW46IFJhaW5kcm9wLmlvIEludGVncmF0aW9uIGZvciBPYnNpZGlhblxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBcbiAqIFRoaXMgcGx1Z2luIGFsbG93cyB1c2VycyB0byBmZXRjaCBib29rbWFya3MgZnJvbSBSYWluZHJvcC5pbyBhbmQgY3JlYXRlIE1hcmtkb3duIG5vdGVzIGZyb20gdGhlbS5cbiAqIFRoZSBjb2RlIGZvbGxvd3MgYSBtb2R1bGFyIGFyY2hpdGVjdHVyZSB3aXRoIHV0aWxpdHkgZnVuY3Rpb25zIHNlcGFyYXRlZCBpbnRvIGRlZGljYXRlZCBtb2R1bGVzXG4gKiB0byBwcm9tb3RlIGNvZGUgcmV1c2UgYW5kIG1haW50YWluYWJpbGl0eS5cbiAqIFxuICogQ29yZSBjb21wb25lbnRzOlxuICogLSBNYWluIHBsdWdpbiBjbGFzcyAoUmFpbmRyb3BUb09ic2lkaWFuKTogSGFuZGxlcyBwbHVnaW4gaW5pdGlhbGl6YXRpb24gYW5kIHNldHRpbmdzXG4gKiAtIE1vZGFsIFVJIChSYWluZHJvcEZldGNoTW9kYWwpOiBQcm92aWRlcyB1c2VyIGludGVyZmFjZSBmb3IgZmV0Y2hpbmcgcmFpbmRyb3BzXG4gKiAtIFNldHRpbmdzIHRhYiAoUmFpbmRyb3BTZXR0aW5nVGFiKTogTWFuYWdlcyBwbHVnaW4gY29uZmlndXJhdGlvblxuICogLSBVdGlsaXR5IG1vZHVsZXM6IFNlcGFyYXRlZCBpbnRvIGZpbGUgYW5kIEFQSSB1dGlsaXRpZXMgZm9yIGJldHRlciBvcmdhbml6YXRpb25cbiAqIFxuICogVGhlIHBsdWdpbiB1c2VzIGZ1bmN0aW9uYWwgcHJvZ3JhbW1pbmcgcGF0dGVybnMgd2hlcmUgYXBwcm9wcmlhdGUsIHdpdGggcHVyZSBmdW5jdGlvbnNcbiAqIGFuZCBpbW11dGFibGUgZGF0YSBzdHJ1Y3R1cmVzIHRvIGltcHJvdmUgY29kZSByZWxpYWJpbGl0eSBhbmQgdGVzdGFiaWxpdHkuXG4gKi9cblxuaW1wb3J0IHsgQXBwLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgTW9kYWwsIFRleHRDb21wb25lbnQsIEJ1dHRvbkNvbXBvbmVudCwgVG9nZ2xlQ29tcG9uZW50LCBQbHVnaW5NYW5pZmVzdCwgVEZpbGUsIFRBYnN0cmFjdEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyByZXF1ZXN0LCBSZXF1ZXN0VXJsUGFyYW0gfSBmcm9tICdvYnNpZGlhbic7XG5cbi8vIEltcG9ydCB1dGlsaXR5IGZ1bmN0aW9ucyBmcm9tIGNvbnNvbGlkYXRlZCBpbmRleFxuLy8gVGhlc2UgdXRpbGl0aWVzIGZvbGxvdyBmdW5jdGlvbmFsIHByb2dyYW1taW5nIHBhdHRlcm5zIGFuZCBoYW5kbGUgZmlsZSBvcGVyYXRpb25zIGFuZCBBUEkgaW50ZXJhY3Rpb25zXG5pbXBvcnQgeyBcbiAgICAvLyBGaWxlIHV0aWxpdGllc1xuICAgIHNhbml0aXplRmlsZU5hbWUsXG4gICAgZG9lc1BhdGhFeGlzdCxcbiAgICBpc1BhdGhBRm9sZGVyLFxuICAgIGNyZWF0ZUZvbGRlcixcbiAgICBjcmVhdGVGb2xkZXJTdHJ1Y3R1cmUsXG4gICAgXG4gICAgLy8gQVBJIHV0aWxpdGllc1xuICAgIFJhdGVMaW1pdGVyLFxuICAgIGNyZWF0ZVJhdGVMaW1pdGVyLFxuICAgIGNyZWF0ZUF1dGhlbnRpY2F0ZWRSZXF1ZXN0T3B0aW9ucyxcbiAgICBidWlsZENvbGxlY3Rpb25BcGlVcmwsXG4gICAgcGFyc2VBcGlSZXNwb25zZSxcbiAgICBoYW5kbGVSZXF1ZXN0RXJyb3IsXG4gICAgZmV0Y2hXaXRoUmV0cnksXG4gICAgZXh0cmFjdENvbGxlY3Rpb25EYXRhLFxuICAgIFxuICAgIC8vIFlBTUwgdXRpbGl0aWVzXG4gICAgY3JlYXRlWWFtbEZyb250bWF0dGVyLFxuICAgIGZvcm1hdFlhbWxWYWx1ZVxufSBmcm9tICcuL3V0aWxzJztcblxuXG4vLyBDb25zdGFudHMgZm9yIHR5cGUgdW5pb25zIC0gZm9sbG93aW5nIFJhaW5kcm9wLmlvIEFQSSB0eXBlc1xuY29uc3QgUmFpbmRyb3BUeXBlcyA9IHtcbiAgICBMSU5LOiAnbGluaycsXG4gICAgQVJUSUNMRTogJ2FydGljbGUnLFxuICAgIElNQUdFOiAnaW1hZ2UnLFxuICAgIFZJREVPOiAndmlkZW8nLFxuICAgIERPQ1VNRU5UOiAnZG9jdW1lbnQnLFxuICAgIEFVRElPOiAnYXVkaW8nXG59IGFzIGNvbnN0O1xuXG50eXBlIFJhaW5kcm9wVHlwZSA9IHR5cGVvZiBSYWluZHJvcFR5cGVzW2tleW9mIHR5cGVvZiBSYWluZHJvcFR5cGVzXTtcblxuY29uc3QgVGFnTWF0Y2hUeXBlcyA9IHtcbiAgICBBTEw6ICdhbGwnLFxuICAgIEFOWTogJ2FueSdcbn0gYXMgY29uc3Q7XG5cbnR5cGUgVGFnTWF0Y2hUeXBlID0gdHlwZW9mIFRhZ01hdGNoVHlwZXNba2V5b2YgdHlwZW9mIFRhZ01hdGNoVHlwZXNdO1xuXG4vLyBTeXN0ZW0gY29sbGVjdGlvbiBJRHMgZnJvbSBSYWluZHJvcC5pbyBBUEkgZG9jc1xuY29uc3QgU3lzdGVtQ29sbGVjdGlvbnMgPSB7XG4gICAgVU5TT1JURUQ6IC0xLFxuICAgIFRSQVNIOiAtOTlcbn0gYXMgY29uc3Q7XG5cbnR5cGUgU3lzdGVtQ29sbGVjdGlvbklkID0gdHlwZW9mIFN5c3RlbUNvbGxlY3Rpb25zW2tleW9mIHR5cGVvZiBTeXN0ZW1Db2xsZWN0aW9uc107XG5cbi8vIFJhaW5kcm9wLmlvIEFQSSBUeXBlcyAtIGZvbGxvd2luZyBvZmZpY2lhbCBkb2N1bWVudGF0aW9uIHN0cnVjdHVyZVxuaW50ZXJmYWNlIFJhaW5kcm9wSXRlbSB7XG4gICAgcmVhZG9ubHkgX2lkOiBudW1iZXI7XG4gICAgcmVhZG9ubHkgdGl0bGU6IHN0cmluZztcbiAgICByZWFkb25seSBleGNlcnB0Pzogc3RyaW5nO1xuICAgIHJlYWRvbmx5IG5vdGU/OiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgbGluazogc3RyaW5nO1xuICAgIHJlYWRvbmx5IGNvdmVyPzogc3RyaW5nO1xuICAgIC8vIFRpbWVzdGFtcHMgaW4gSVNPIDg2MDEgZm9ybWF0IGFzIHBlciBBUEkgZG9jc1xuICAgIHJlYWRvbmx5IGNyZWF0ZWQ6IHN0cmluZzsgLy8gWVlZWS1NTS1ERFRISDpNTTpTU1pcbiAgICByZWFkb25seSBsYXN0VXBkYXRlOiBzdHJpbmc7IC8vIFlZWVktTU0tRERUSEg6TU06U1NaXG4gICAgcmVhZG9ubHkgdGFncz86IHJlYWRvbmx5IHN0cmluZ1tdO1xuICAgIHJlYWRvbmx5IGNvbGxlY3Rpb24/OiB7XG4gICAgICAgIHJlYWRvbmx5ICRpZDogbnVtYmVyO1xuICAgICAgICByZWFkb25seSB0aXRsZTogc3RyaW5nO1xuICAgIH07XG4gICAgcmVhZG9ubHkgaGlnaGxpZ2h0cz86IFJlYWRvbmx5QXJyYXk8e1xuICAgICAgICByZWFkb25seSB0ZXh0OiBzdHJpbmc7XG4gICAgICAgIHJlYWRvbmx5IG5vdGU/OiBzdHJpbmc7XG4gICAgICAgIHJlYWRvbmx5IGNvbG9yPzogc3RyaW5nO1xuICAgICAgICByZWFkb25seSBjcmVhdGVkOiBzdHJpbmc7XG4gICAgfT47XG4gICAgcmVhZG9ubHkgdHlwZTogUmFpbmRyb3BUeXBlO1xuICAgIC8vIEFkZGl0aW9uYWwgZmllbGRzIHRoYXQgbWlnaHQgYmUgcmV0dXJuZWQgYnV0IG5vdCBkb2N1bWVudGVkXG4gICAgcmVhZG9ubHkgW2tleTogc3RyaW5nXTogYW55O1xufVxuXG5pbnRlcmZhY2UgUmFpbmRyb3BSZXNwb25zZSB7XG4gICAgcmVhZG9ubHkgcmVzdWx0OiBib29sZWFuO1xuICAgIHJlYWRvbmx5IGl0ZW1zOiByZWFkb25seSBSYWluZHJvcEl0ZW1bXTtcbiAgICByZWFkb25seSBjb3VudD86IG51bWJlcjtcbiAgICByZWFkb25seSBjb2xsZWN0aW9uSWQ/OiBudW1iZXI7XG59XG5cbi8vIEFkZCBhIGNvbnN0YW50IGZvciBmaWx0ZXIgdHlwZXMsIGV4dGVuZGluZyB0aGUgUmFpbmRyb3BUeXBlcyB3aXRoICdhbGwnIG9wdGlvblxuY29uc3QgRmlsdGVyVHlwZXMgPSB7XG4gICAgLi4uUmFpbmRyb3BUeXBlcyxcbiAgICBBTEw6ICdhbGwnXG59IGFzIGNvbnN0O1xuXG50eXBlIEZpbHRlclR5cGUgPSB0eXBlb2YgRmlsdGVyVHlwZXNba2V5b2YgdHlwZW9mIEZpbHRlclR5cGVzXTtcblxuaW50ZXJmYWNlIE1vZGFsRmV0Y2hPcHRpb25zIHtcbiAgICByZWFkb25seSB2YXVsdFBhdGg/OiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgY29sbGVjdGlvbnM6IHN0cmluZztcbiAgICByZWFkb25seSBhcGlGaWx0ZXJUYWdzOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgaW5jbHVkZVN1YmNvbGxlY3Rpb25zOiBib29sZWFuO1xuICAgIHJlYWRvbmx5IGFwcGVuZFRhZ3NUb05vdGVzOiBzdHJpbmc7XG4gICAgcmVhZG9ubHkgdXNlUmFpbmRyb3BUaXRsZUZvckZpbGVOYW1lOiBib29sZWFuO1xuICAgIHJlYWRvbmx5IHRhZ01hdGNoVHlwZTogVGFnTWF0Y2hUeXBlO1xuICAgIHJlYWRvbmx5IGZpbHRlclR5cGU/OiBGaWx0ZXJUeXBlO1xuICAgIHJlYWRvbmx5IGZldGNoT25seU5ldz86IGJvb2xlYW47XG4gICAgcmVhZG9ubHkgdXBkYXRlRXhpc3Rpbmc6IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBSYWluZHJvcFRvT2JzaWRpYW5TZXR0aW5ncyB7XG4gICAgcmFpbmRyb3BBcGlUb2tlbjogc3RyaW5nO1xuICAgIGRlZmF1bHRWYXVsdExvY2F0aW9uOiBzdHJpbmc7XG4gICAgZmlsZU5hbWVUZW1wbGF0ZTogc3RyaW5nO1xuICAgIHNob3dSaWJib25JY29uOiBib29sZWFuO1xuICAgIGJhbm5lckZpZWxkTmFtZTogc3RyaW5nO1xufVxuXG4vLyBBZGQgbmV3IGludGVyZmFjZSBmb3IgQ29sbGVjdGlvbiBpbmZvXG5pbnRlcmZhY2UgUmFpbmRyb3BDb2xsZWN0aW9uIHtcbiAgICByZWFkb25seSBfaWQ6IG51bWJlcjtcbiAgICByZWFkb25seSB0aXRsZTogc3RyaW5nO1xuICAgIHJlYWRvbmx5IHBhcmVudD86IHtcbiAgICAgICAgcmVhZG9ubHkgJGlkOiBudW1iZXI7XG4gICAgfTtcbiAgICByZWFkb25seSBhY2Nlc3M/OiB7XG4gICAgICAgIHJlYWRvbmx5IGxldmVsOiBudW1iZXI7XG4gICAgICAgIHJlYWRvbmx5IGRyYWdnYWJsZTogYm9vbGVhbjtcbiAgICB9O1xuICAgIHJlYWRvbmx5IGNvbG9yPzogc3RyaW5nOyAvLyBIRVggY29sb3JcbiAgICByZWFkb25seSBjb3VudD86IG51bWJlcjsgLy8gQ291bnQgb2YgcmFpbmRyb3BzXG4gICAgcmVhZG9ubHkgY292ZXI/OiByZWFkb25seSBzdHJpbmdbXTtcbiAgICByZWFkb25seSBjcmVhdGVkPzogc3RyaW5nOyAvLyBZWVlZLU1NLUREVEhIOk1NOlNTWlxuICAgIHJlYWRvbmx5IGV4cGFuZGVkPzogYm9vbGVhbjsgLy8gV2hldGhlciBzdWItY29sbGVjdGlvbnMgYXJlIGV4cGFuZGVkXG4gICAgcmVhZG9ubHkgbGFzdFVwZGF0ZT86IHN0cmluZzsgLy8gWVlZWS1NTS1ERFRISDpNTTpTU1pcbiAgICByZWFkb25seSBwdWJsaWM/OiBib29sZWFuOyAvLyBXaGV0aGVyIHB1YmxpY2x5IGFjY2Vzc2libGVcbiAgICByZWFkb25seSBzb3J0PzogbnVtYmVyOyAvLyBPcmRlciAoZGVzY2VuZGluZylcbiAgICByZWFkb25seSB2aWV3PzogJ2xpc3QnIHwgJ3NpbXBsZScgfCAnZ3JpZCcgfCAnbWFzb25yeSc7XG4gICAgLy8gQWRkaXRpb25hbCBmaWVsZHMgdGhhdCBtaWdodCBiZSByZXR1cm5lZCBidXQgbm90IGRvY3VtZW50ZWRcbiAgICByZWFkb25seSBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbmludGVyZmFjZSBDb2xsZWN0aW9uUmVzcG9uc2Uge1xuICAgIHJlYWRvbmx5IHJlc3VsdDogYm9vbGVhbjtcbiAgICByZWFkb25seSBpdGVtczogcmVhZG9ubHkgUmFpbmRyb3BDb2xsZWN0aW9uW107XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgdGhlIGZ1bGwgcGF0aCBzZWdtZW50cyBmcm9tIHRoZSByb290IGNvbGxlY3Rpb24gZG93biB0byB0aGUgZ2l2ZW4gSURcbmNvbnN0IGdldEZ1bGxQYXRoU2VnbWVudHMgPSAoY29sbGVjdGlvbklkOiBudW1iZXIsIGhpZXJhcmNoeTogTWFwPG51bWJlciwgeyB0aXRsZTogc3RyaW5nLCBwYXJlbnRJZD86IG51bWJlciB9PiwgaWRUb05hbWVNYXA6IE1hcDxudW1iZXIsIHN0cmluZz4pOiBzdHJpbmdbXSA9PiB7XG4gICAgY29uc3Qgc2VnbWVudHM6IHN0cmluZ1tdID0gW107XG4gICAgbGV0IGN1cnJlbnRJZDogbnVtYmVyIHwgdW5kZWZpbmVkID0gY29sbGVjdGlvbklkO1xuICAgIGNvbnN0IHBhdGhJZHM6IG51bWJlcltdID0gW107XG5cbiAgICAvLyBUcmF2ZXJzZSB1cHdhcmRzIGZyb20gdGhlIGN1cnJlbnQgSUQgdG8gY29sbGVjdCBhbGwgYW5jZXN0b3IgSURzXG4gICAgd2hpbGUgKGN1cnJlbnRJZCAhPT0gdW5kZWZpbmVkICYmIGN1cnJlbnRJZCAhPT0gMCAmJiBjdXJyZW50SWQgIT09IFN5c3RlbUNvbGxlY3Rpb25zLlVOU09SVEVEICYmIGN1cnJlbnRJZCAhPT0gU3lzdGVtQ29sbGVjdGlvbnMuVFJBU0gpIHtcbiAgICAgICAgIHBhdGhJZHMucHVzaChjdXJyZW50SWQpO1xuICAgICAgICAgY29uc3QgY29sbGVjdGlvbiA9IGhpZXJhcmNoeS5nZXQoY3VycmVudElkKTtcbiAgICAgICAgIGlmICghY29sbGVjdGlvbiB8fCBjb2xsZWN0aW9uLnBhcmVudElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgYnJlYWs7IC8vIFN0b3AgaWYgY29sbGVjdGlvbiBub3QgZm91bmQgb3Igbm8gcGFyZW50IGRlZmluZWRcbiAgICAgICAgIH1cbiAgICAgICAgIGN1cnJlbnRJZCA9IGNvbGxlY3Rpb24ucGFyZW50SWQ7XG4gICAgfVxuXG4gICAgLy8gUmV2ZXJzZSB0aGUgY29sbGVjdGVkIElEcyBhbmQgZmluZCB0aGVpciBuYW1lcyB0byBidWlsZCB0aGUgcGF0aCBmcm9tIHJvb3QgZG93blxuICAgIHBhdGhJZHMucmV2ZXJzZSgpO1xuXG4gICAgZm9yIChjb25zdCBpZCBvZiBwYXRoSWRzKSB7XG4gICAgICAgICBjb25zdCBuYW1lID0gaWRUb05hbWVNYXAuZ2V0KGlkKTtcbiAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICAgIC8vIFNhbml0aXplIHRoZSBuYW1lIGJlZm9yZSBhZGRpbmcgdG8gc2VnbWVudHNcbiAgICAgICAgICAgICAgY29uc3Qgc2FuaXRpemVkTmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcL1xcXFw6Kj9cIjw+fCMlJnt9XFwkXFwhXFwnQGArPV0vZywgJycpLnRyaW0oKTtcbiAgICAgICAgICAgICAgaWYoc2FuaXRpemVkTmFtZSkgc2VnbWVudHMucHVzaChzYW5pdGl6ZWROYW1lKTtcbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgLy8gSWYgbmFtZSBub3QgZm91bmQsIGFkZCBhIHBsYWNlaG9sZGVyIG9yIHNraXA/XG4gICAgICAgICAgICAgLy8gRm9yIG5vdywgbGV0J3MgYWRkIGEgcGxhY2Vob2xkZXIgdG8gaW5kaWNhdGUgdGhlIG1pc3Npbmcgc2VnbWVudFxuICAgICAgICAgICAgIHNlZ21lbnRzLnB1c2goYFVua25vd25fQ29sbGVjdGlvbl8ke2lkfWApO1xuICAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzZWdtZW50cztcbn07XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IFJhaW5kcm9wVG9PYnNpZGlhblNldHRpbmdzID0ge1xuICAgIHJhaW5kcm9wQXBpVG9rZW46ICcnLFxuICAgIGRlZmF1bHRWYXVsdExvY2F0aW9uOiAnJyxcbiAgICBmaWxlTmFtZVRlbXBsYXRlOiAne3t0aXRsZX19JyxcbiAgICBzaG93UmliYm9uSWNvbjogdHJ1ZSxcbiAgICBiYW5uZXJGaWVsZE5hbWU6ICdiYW5uZXInLFxufTtcblxuLy8gUmF0ZSBsaW1pdGluZyBhbmQgcmV0cnkgdXRpbGl0aWVzIGFyZSBub3cgaW1wb3J0ZWQgZnJvbSAnLi91dGlscy9hcGlVdGlscydcblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIG9wdGlvbnMgZm9yIEFQSSByZXF1ZXN0cyB3aXRoIHJldHJ5IGNhcGFiaWxpdHlcbiAqL1xuaW50ZXJmYWNlIEZldGNoV2l0aFJldHJ5T3B0aW9ucyB7XG4gICAgdXJsOiBzdHJpbmc7XG4gICAgcmVxdWVzdE9wdGlvbnM6IFJlcXVlc3RJbml0O1xuICAgIHJhdGVMaW1pdGVyOiBSYXRlTGltaXRlcjtcbiAgICBtYXhSZXRyaWVzPzogbnVtYmVyO1xuICAgIGRlbGF5QmV0d2VlblJldHJpZXM/OiBudW1iZXI7XG59XG5cbi8qKlxuLy8gQWxsIEFQSSB1dGlsaXR5IGZ1bmN0aW9ucyBtb3ZlZCB0byBhcGlVdGlscy50cyBhbmQgaW1wb3J0ZWQgdmlhIGluZGV4LnRzXG59XG5cbi8qKlxuICogVmFsaWRhdGVzIHRoZSBwYXJhbWV0ZXJzIGZvciB0aGUgZmV0Y2ggb3BlcmF0aW9uXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlRmV0Y2hQYXJhbWV0ZXJzKHVybDogc3RyaW5nLCBvcHRpb25zOiBSZXF1ZXN0SW5pdCk6IHZvaWQge1xuICAgIGNvbnN0IGlzVXJsVmFsaWQgPSB0eXBlb2YgdXJsID09PSAnc3RyaW5nJztcbiAgICBpZiAoIWlzVXJsVmFsaWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVUkwgbXVzdCBiZSBhIHN0cmluZycpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBhcmVPcHRpb25zVmFsaWQgPSBvcHRpb25zICYmIHR5cGVvZiBvcHRpb25zID09PSAnb2JqZWN0JztcbiAgICBpZiAoIWFyZU9wdGlvbnNWYWxpZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVlc3Qgb3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCcpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb2xsZWN0aW9uIEFQSSBpbnRlcmFjdGlvbiAtIGZ1bmN0aW9uYWwgYXBwcm9hY2hcbiAqL1xuXG4vLyBGdW5jdGlvbiBtb3ZlZCB0byBhcGlVdGlscy50cyBhbmQgaW1wb3J0ZWQgdmlhIGluZGV4LnRzXG5cbi8vIEZ1bmN0aW9uIG1vdmVkIHRvIGFwaVV0aWxzLnRzIGFuZCBpbXBvcnRlZCB2aWEgaW5kZXgudHNcblxuLy8gRnVuY3Rpb24gbW92ZWQgdG8gYXBpVXRpbHMudHMgYW5kIGltcG9ydGVkIHZpYSBpbmRleC50c1xuXG4vKipcbiAqIEZldGNoZXMgY29sbGVjdGlvbiBpbmZvcm1hdGlvbiB3aXRoIGVycm9yIGhhbmRsaW5nIGFuZCByYXRlIGxpbWl0aW5nXG4gKiBVc2VzIGZ1bmN0aW9uYWwgY29tcG9zaXRpb24gYnkgYnJlYWtpbmcgdGhlIHByb2Nlc3MgaW50byBzbWFsbGVyLCBmb2N1c2VkIG9wZXJhdGlvbnNcbiAqIEBwYXJhbSBhcHAgLSBUaGUgT2JzaWRpYW4gYXBwIGluc3RhbmNlXG4gKiBAcGFyYW0gY29sbGVjdGlvbklkIC0gVGhlIElEIG9mIHRoZSBjb2xsZWN0aW9uIHRvIGZldGNoXG4gKiBAcGFyYW0gYXBpVG9rZW4gLSBUaGUgQVBJIHRva2VuIGZvciBhdXRoZW50aWNhdGlvblxuICogQHBhcmFtIHJhdGVMaW1pdGVyIC0gUmF0ZSBsaW1pdGVyIHRvIHByZXZlbnQgQVBJIHRocm90dGxpbmdcbiAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIGNvbGxlY3Rpb24gZGF0YSBvciBudWxsIGlmIHVuYXZhaWxhYmxlXG4gKi9cbi8qKlxuICogRmV0Y2hlcyBjb2xsZWN0aW9uIGluZm9ybWF0aW9uIGZyb20gUmFpbmRyb3AuaW8gQVBJXG4gKiBVdGlsaXplcyB1dGlsaXR5IGZ1bmN0aW9ucyBmcm9tIGFwaVV0aWxzIG1vZHVsZSBmb3IgYmV0dGVyIG1vZHVsYXJpdHlcbiAqIEBwYXJhbSBhcHAgLSBPYnNpZGlhbiBhcHAgaW5zdGFuY2VcbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWQgLSBSYWluZHJvcCBjb2xsZWN0aW9uIElEXG4gKiBAcGFyYW0gYXBpVG9rZW4gLSBSYWluZHJvcCBBUEkgdG9rZW5cbiAqIEBwYXJhbSByYXRlTGltaXRlciAtIFJhdGUgbGltaXRlciBpbnN0YW5jZVxuICogQHJldHVybnMgQ29sbGVjdGlvbiBpbmZvcm1hdGlvbiBvciBudWxsIGlmIG5vdCBmb3VuZFxuICovXG5hc3luYyBmdW5jdGlvbiBmZXRjaENvbGxlY3Rpb25JbmZvKGFwcDogQXBwLCBjb2xsZWN0aW9uSWQ6IHN0cmluZywgYXBpVG9rZW46IHN0cmluZywgcmF0ZUxpbWl0ZXI6IFJhdGVMaW1pdGVyKTogUHJvbWlzZTxSYWluZHJvcENvbGxlY3Rpb24gfCBudWxsPiB7XG4gICAgY29uc3QgcmVxdWVzdE9wdGlvbnMgPSBjcmVhdGVBdXRoZW50aWNhdGVkUmVxdWVzdE9wdGlvbnMoYXBpVG9rZW4pO1xuICAgIGNvbnN0IGFwaVVybCA9IGJ1aWxkQ29sbGVjdGlvbkFwaVVybChjb2xsZWN0aW9uSWQpO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYXBpUmVzcG9uc2UgPSBhd2FpdCBmZXRjaFdpdGhSZXRyeShhcHAsIGFwaVVybCwgcmVxdWVzdE9wdGlvbnMsIHJhdGVMaW1pdGVyKTtcbiAgICAgICAgLy8gVXNlIHRoZSBpbXBvcnRlZCBleHRyYWN0Q29sbGVjdGlvbkRhdGEgZnVuY3Rpb24gZnJvbSB1dGlsc1xuICAgICAgICByZXR1cm4gZXh0cmFjdENvbGxlY3Rpb25EYXRhKGFwaVJlc3BvbnNlKSBhcyBSYWluZHJvcENvbGxlY3Rpb247XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gTm9uLWZhdGFsIGVycm9yIC0gd2UgY2FuIGNvbnRpbnVlIHdpdGhvdXQgY29sbGVjdGlvbiBpbmZvXG4gICAgICAgIC8vIFRoZSBpdGVtcyB3aWxsIGJlIHBsYWNlZCBpbiB0aGUgYmFzZSBmb2xkZXIgaW5zdGVhZFxuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICd1bmtub3duIGVycm9yJztcbiAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZmV0Y2hpbmcgY29sbGVjdGlvbiAke2NvbGxlY3Rpb25JZH06ICR7ZXJyb3JNZXNzYWdlfWApO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8vIEZ1bmN0aW9uIG1vdmVkIGluc2lkZSB0aGUgUmFpbmRyb3BUb09ic2lkaWFuIGNsYXNzXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFJhaW5kcm9wVG9PYnNpZGlhbiBleHRlbmRzIFBsdWdpbiB7XG4gIHNldHRpbmdzOiBSYWluZHJvcFRvT2JzaWRpYW5TZXR0aW5ncztcbiAgcHJpdmF0ZSByYXRlTGltaXRlcjogUmF0ZUxpbWl0ZXI7IC8vIFVzaW5nIHRoZSBmdW5jdGlvbmFsIGludGVyZmFjZSB0eXBlXG4gIHByaXZhdGUgcmliYm9uSWNvbkVsOiBIVE1MRWxlbWVudCB8IHVuZGVmaW5lZDsgLy8gUHJvcGVydHkgdG8gc3RvcmUgdGhlIHJpYmJvbiBpY29uIGVsZW1lbnRcbiAgcHJpdmF0ZSBpc1JpYmJvblNob3duOiBib29sZWFuID0gZmFsc2U7IC8vIERlc2NyaXB0aXZlIHZhcmlhYmxlIG5hbWVzIHdpdGggYXV4aWxpYXJ5IHZlcmJzXG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIG1hbmlmZXN0OiBQbHVnaW5NYW5pZmVzdCkge1xuICAgIHN1cGVyKGFwcCwgbWFuaWZlc3QpO1xuICAgIHRoaXMuc2V0dGluZ3MgPSB7IC4uLkRFRkFVTFRfU0VUVElOR1MgfTtcbiAgICB0aGlzLnJhdGVMaW1pdGVyID0gY3JlYXRlUmF0ZUxpbWl0ZXIoKTsgLy8gVXNpbmcgZmFjdG9yeSBmdW5jdGlvbiBpbnN0ZWFkIG9mIGNvbnN0cnVjdG9yXG4gIH1cblxuICBhc3luYyBvbmxvYWQoKSB7XG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XG4gICAgICBpZDogJ2ZldGNoLXJhaW5kcm9wcycsXG4gICAgICBuYW1lOiAnRmV0Y2ggUmFpbmRyb3BzJyxcbiAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIG5ldyBSYWluZHJvcEZldGNoTW9kYWwodGhpcy5hcHAsIHRoaXMpLm9wZW4oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFVwZGF0ZSByaWJib24gaWNvbiBiYXNlZCBvbiBzZXR0aW5nc1xuICAgIHRoaXMudXBkYXRlUmliYm9uSWNvbigpO1xuXG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBSYWluZHJvcFRvT2JzaWRpYW5TZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG4gICAgY29uc29sZS5sb2coJ01ha2UgSXQgUmFpbiBwbHVnaW4gbG9hZGVkIScpO1xuICB9XG5cbiAgb251bmxvYWQoKSB7XG4gICAgLy8gUmVtb3ZlIHJpYmJvbiBpY29uIHdoZW4gcGx1Z2luIGlzIHVubG9hZGVkXG4gICAgdGhpcy5yaWJib25JY29uRWw/LnJlbW92ZSgpO1xuICAgIGNvbnNvbGUubG9nKCdNYWtlIEl0IFJhaW4gcGx1Z2luIHVubG9hZGVkLicpO1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlcyBhIGZpbGUgbmFtZSBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgcmFpbmRyb3AgZGF0YSBhbmQgc2V0dGluZ3NcbiAgICogQHBhcmFtIHJhaW5kcm9wIC0gVGhlIHJhaW5kcm9wIGRhdGEgdG8gdXNlIGZvciBmaWxlIG5hbWUgZ2VuZXJhdGlvblxuICAgKiBAcGFyYW0gdXNlUmFpbmRyb3BUaXRsZUZvckZpbGVOYW1lIC0gV2hldGhlciB0byB1c2UgdGhlIHJhaW5kcm9wIHRpdGxlIGZvciB0aGUgZmlsZSBuYW1lXG4gICAqIEByZXR1cm5zIFRoZSBnZW5lcmF0ZWQgZmlsZSBuYW1lXG4gICAqL1xuICBnZW5lcmF0ZUZpbGVOYW1lKHJhaW5kcm9wOiBhbnksIHVzZVJhaW5kcm9wVGl0bGVGb3JGaWxlTmFtZTogYm9vbGVhbik6IHN0cmluZyB7XG4gICAgLy8gVXNlIHRoZSB0ZW1wbGF0ZSBmcm9tIHNldHRpbmdzIGlmIHRpdGxlIGlzIGVuYWJsZWQsIG90aGVyd2lzZSB1c2UgSURcbiAgICBjb25zdCBmaWxlTmFtZVRlbXBsYXRlID0gdXNlUmFpbmRyb3BUaXRsZUZvckZpbGVOYW1lID8gdGhpcy5zZXR0aW5ncy5maWxlTmFtZVRlbXBsYXRlIDogJ3t7aWR9fSc7XG4gICAgbGV0IGZpbGVOYW1lID0gZmlsZU5hbWVUZW1wbGF0ZTtcbiAgICBcbiAgICBjb25zdCByZXBsYWNlUGxhY2Vob2xkZXIgPSAocGxhY2Vob2xkZXI6IHN0cmluZywgdmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3Qgc2FmZVZhbHVlID0gc2FuaXRpemVGaWxlTmFtZSh2YWx1ZSk7XG4gICAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYHt7JHtwbGFjZWhvbGRlcn19fWAsICdnaScpO1xuICAgICAgZmlsZU5hbWUgPSBmaWxlTmFtZS5yZXBsYWNlKHJlZ2V4LCBzYWZlVmFsdWUpO1xuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgcmVwbGFjZVBsYWNlaG9sZGVyKCd0aXRsZScsIHJhaW5kcm9wLnRpdGxlIHx8ICdVbnRpdGxlZCcpO1xuICAgICAgcmVwbGFjZVBsYWNlaG9sZGVyKCdpZCcsIChyYWluZHJvcC5faWQgfHwgJ3Vua25vd25faWQnKS50b1N0cmluZygpKTsgLy8gVXNlIF9pZCBjb25zaXN0ZW50bHlcbiAgICAgIHJlcGxhY2VQbGFjZWhvbGRlcignY29sbGVjdGlvblRpdGxlJywgcmFpbmRyb3AuY29sbGVjdGlvbj8udGl0bGUgfHwgJ05vIENvbGxlY3Rpb24nKTtcblxuICAgICAgY29uc3QgY3JlYXRlZERhdGUgPSByYWluZHJvcC5jcmVhdGVkID8gbmV3IERhdGUocmFpbmRyb3AuY3JlYXRlZCkgOiBudWxsO1xuICAgICAgbGV0IGZvcm1hdHRlZERhdGUgPSAnbm9fZGF0ZSc7XG4gICAgICBpZiAoY3JlYXRlZERhdGUgJiYgIWlzTmFOKGNyZWF0ZWREYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgZm9ybWF0dGVkRGF0ZSA9IGNyZWF0ZWREYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcbiAgICAgIH1cbiAgICAgIHJlcGxhY2VQbGFjZWhvbGRlcignZGF0ZScsIGZvcm1hdHRlZERhdGUpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxldCBlcnJvck1zZyA9ICd0ZW1wbGF0ZSBwcm9jZXNzaW5nIGVycm9yJztcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSBlcnJvck1zZyA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcHJvY2Vzc2luZyBmaWxlIG5hbWUgdGVtcGxhdGU6XCIsIGVycm9yTXNnLCBlcnJvcik7XG4gICAgICBuZXcgTm90aWNlKFwiRXJyb3IgZ2VuZXJhdGluZyBmaWxlIG5hbWUuIENoZWNrIGNvbnNvbGUgb3IgdGVtcGxhdGUuXCIpO1xuICAgICAgcmV0dXJuIFwiRXJyb3JfRmlsZW5hbWVfXCIgKyBEYXRlLm5vdygpO1xuICAgIH1cblxuICAgIGxldCBmaW5hbEZpbGVOYW1lID0gc2FuaXRpemVGaWxlTmFtZShmaWxlTmFtZSk7XG4gICAgaWYgKCFmaW5hbEZpbGVOYW1lLnRyaW0oKSkge1xuICAgICAgcmV0dXJuIFwiVW5uYW1lZF9SYWluZHJvcF9cIiArIChyYWluZHJvcC5faWQgfHwgRGF0ZS5ub3coKSk7IC8vIFVzZSBfaWQgY29uc2lzdGVudGx5XG4gICAgfVxuICAgIHJldHVybiBmaW5hbEZpbGVOYW1lO1xuICB9XG5cbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gIH1cbiAgXG4gIHNhbml0aXplRmlsZU5hbWUobmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAvLyBVc2UgdGhlIGZ1bmN0aW9uYWwgdXRpbGl0eSBpbnN0ZWFkIG9mIGR1cGxpY2F0aW5nIHRoZSBsb2dpY1xuICAgIHJldHVybiBzYW5pdGl6ZUZpbGVOYW1lKG5hbWUpO1xuICB9XG4gIFxuICAvKipcbiAgICogVXBkYXRlIHRoZSByaWJib24gaWNvbiBiYXNlZCBvbiBzZXR0aW5nc1xuICAgKi9cbiAgdXBkYXRlUmliYm9uSWNvbigpOiB2b2lkIHtcbiAgICAvLyBSZW1vdmUgZXhpc3RpbmcgaWNvbiBpZiBpdCBleGlzdHNcbiAgICB0aGlzLnJpYmJvbkljb25FbD8ucmVtb3ZlKCk7XG4gICAgdGhpcy5yaWJib25JY29uRWwgPSB1bmRlZmluZWQ7IC8vIENsZWFyIHRoZSByZWZlcmVuY2VcblxuICAgIC8vIEFkZCBpY29uIGlmIHNldHRpbmcgaXMgZW5hYmxlZFxuICAgIGlmICh0aGlzLnNldHRpbmdzLnNob3dSaWJib25JY29uKSB7XG4gICAgICB0aGlzLnJpYmJvbkljb25FbCA9IHRoaXMuYWRkUmliYm9uSWNvbihcbiAgICAgICAgJ2Nsb3VkLWRvd25sb2FkJywgLy8gT2JzaWRpYW4gaWNvbiBJRCBmb3IgY2xvdWQgZG93bmxvYWRcbiAgICAgICAgJ0ZldGNoIFJhaW5kcm9wcycsIC8vIFRvb2x0aXAgdGV4dFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgLy8gQ2FsbGJhY2sgZnVuY3Rpb24gd2hlbiB0aGUgaWNvbiBpcyBjbGlja2VkXG4gICAgICAgICAgbmV3IFJhaW5kcm9wRmV0Y2hNb2RhbCh0aGlzLmFwcCwgdGhpcykub3BlbigpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZldGNoUmFpbmRyb3BzKG9wdGlvbnM6IE1vZGFsRmV0Y2hPcHRpb25zKSB7XG4gICAgY29uc3QgYmFzZUFwaVVybCA9ICdodHRwczovL2FwaS5yYWluZHJvcC5pby9yZXN0L3YxJztcbiAgICBjb25zdCBmZXRjaE9wdGlvbnM6IFJlcXVlc3RJbml0ID0ge1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHt0aGlzLnNldHRpbmdzLnJhaW5kcm9wQXBpVG9rZW59YFxuICAgICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGxvYWRpbmdOb3RpY2UgPSBuZXcgTm90aWNlKCdTdGFydGluZyBSYWluZHJvcCBmZXRjaC4uLicsIDApOyAvLyAwIGR1cmF0aW9uIG1ha2VzIGl0IHBlcnNpc3RlbnRcblxuICAgIHRyeSB7XG4gICAgICAgIGxldCBhbGxEYXRhOiBSYWluZHJvcEl0ZW1bXSA9IFtdO1xuICAgICAgICBjb25zdCBwZXJQYWdlID0gNTA7IC8vIE1heCBpdGVtcyBwZXIgcGFnZSBhbGxvd2VkIGJ5IFJhaW5kcm9wLmlvIEFQSVxuXG4gICAgICAgIC8vIEFkZCBlcnJvciBoYW5kbGluZyBmb3IgQVBJIHRva2VuXG4gICAgICAgIGlmICghdGhpcy5zZXR0aW5ncy5yYWluZHJvcEFwaVRva2VuKSB7XG4gICAgICAgICAgICBsb2FkaW5nTm90aWNlLmhpZGUoKTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoJ1BsZWFzZSBjb25maWd1cmUgeW91ciBSYWluZHJvcC5pbyBBUEkgdG9rZW4gaW4gdGhlIHBsdWdpbiBzZXR0aW5ncy4nLCAxMDAwMCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyAtLS0gUmVzb2x2ZSBDb2xsZWN0aW9uIE5hbWVzL0lEcyBhbmQgRmV0Y2ggSGllcmFyY2h5IC0tLVxuICAgICAgICBsZXQgcmVzb2x2ZWRDb2xsZWN0aW9uSWRzOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICBjb25zdCBjb2xsZWN0aW9uTmFtZVRvSWRNYXAgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgICAgICBjb25zdCBjb2xsZWN0aW9uSWRUb05hbWVNYXAgPSBuZXcgTWFwPG51bWJlciwgc3RyaW5nPigpO1xuICAgICAgICBjb25zdCBjb2xsZWN0aW9uSGllcmFyY2h5ID0gbmV3IE1hcDxudW1iZXIsIHsgdGl0bGU6IHN0cmluZywgcGFyZW50SWQ/OiBudW1iZXIgfT4oKTtcblxuICAgICAgICBsZXQgY29sbGVjdGlvbnNEYXRhOiBDb2xsZWN0aW9uUmVzcG9uc2UgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgLy8gQWx3YXlzIGZldGNoIGFsbCBjb2xsZWN0aW9ucyBpZiBvcHRpb25zLmNvbGxlY3Rpb25zIGlzIHByb3ZpZGVkIHRvIGJ1aWxkIGNvbXBsZXRlIGhpZXJhcmNoeVxuICAgICAgICBpZiAob3B0aW9ucy5jb2xsZWN0aW9ucykge1xuICAgICAgICAgICAgY29uc3QgY29sbGVjdGlvbklucHV0cyA9IG9wdGlvbnMuY29sbGVjdGlvbnMuc3BsaXQoJywnKS5tYXAoaW5wdXQgPT4gaW5wdXQudHJpbSgpKS5maWx0ZXIoaW5wdXQgPT4gaW5wdXQgIT09ICcnKTtcblxuICAgICAgICAgICAgbG9hZGluZ05vdGljZS5zZXRNZXNzYWdlKCdGZXRjaGluZyB1c2VyIGNvbGxlY3Rpb25zLi4uJyk7XG5cbiAgICAgICAgICAgIC8vIEZldGNoIHJvb3QgY29sbGVjdGlvbnNcbiAgICAgICAgICAgIGNvbnN0IHJvb3RDb2xsZWN0aW9uc1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2hXaXRoUmV0cnkoXG4gICAgICAgICAgICAgICAgYCR7YmFzZUFwaVVybH0vY29sbGVjdGlvbnNgLFxuICAgICAgICAgICAgICAgIGZldGNoT3B0aW9ucyxcbiAgICAgICAgICAgICAgICB0aGlzLnJhdGVMaW1pdGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3Qgcm9vdENvbGxlY3Rpb25zRGF0YSA9IHJvb3RDb2xsZWN0aW9uc1Jlc3BvbnNlIGFzIENvbGxlY3Rpb25SZXNwb25zZTtcblxuICAgICAgICAgICAgLy8gRmV0Y2ggbmVzdGVkIGNvbGxlY3Rpb25zXG4gICAgICAgICAgICBjb25zdCBuZXN0ZWRDb2xsZWN0aW9uc1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2hXaXRoUmV0cnkoXG4gICAgICAgICAgICAgICAgYCR7YmFzZUFwaVVybH0vY29sbGVjdGlvbnMvY2hpbGRyZW5zYCxcbiAgICAgICAgICAgICAgICBmZXRjaE9wdGlvbnMsXG4gICAgICAgICAgICAgICAgdGhpcy5yYXRlTGltaXRlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IG5lc3RlZENvbGxlY3Rpb25zRGF0YSA9IG5lc3RlZENvbGxlY3Rpb25zUmVzcG9uc2UgYXMgQ29sbGVjdGlvblJlc3BvbnNlO1xuXG4gICAgICAgICAgICAvLyBDb21iaW5lIHJvb3QgYW5kIG5lc3RlZCBjb2xsZWN0aW9uc1xuICAgICAgICAgICAgbGV0IGFsbENvbGxlY3Rpb25zOiBSYWluZHJvcENvbGxlY3Rpb25bXSA9IFtdO1xuICAgICAgICAgICAgaWYgKHJvb3RDb2xsZWN0aW9uc0RhdGE/LnJlc3VsdCAmJiByb290Q29sbGVjdGlvbnNEYXRhPy5pdGVtcykge1xuICAgICAgICAgICAgICAgIGFsbENvbGxlY3Rpb25zID0gYWxsQ29sbGVjdGlvbnMuY29uY2F0KHJvb3RDb2xsZWN0aW9uc0RhdGEuaXRlbXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5lc3RlZENvbGxlY3Rpb25zRGF0YT8ucmVzdWx0ICYmIG5lc3RlZENvbGxlY3Rpb25zRGF0YT8uaXRlbXMpIHtcbiAgICAgICAgICAgICAgICBhbGxDb2xsZWN0aW9ucyA9IGFsbENvbGxlY3Rpb25zLmNvbmNhdChuZXN0ZWRDb2xsZWN0aW9uc0RhdGEuaXRlbXMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBJZiBuZWl0aGVyIGNhbGwgd2FzIHN1Y2Nlc3NmdWwgb3Igbm8gY29sbGVjdGlvbnMgcmV0dXJuZWRcbiAgICAgICAgICAgIGlmIChhbGxDb2xsZWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQVBJIEVycm9yIGZldGNoaW5nIGNvbGxlY3Rpb25zOiBObyBjb2xsZWN0aW9ucyByZXR1cm5lZCBmcm9tIGJvdGggZW5kcG9pbnRzLicpO1xuICAgICAgICAgICAgICAgICBsb2FkaW5nTm90aWNlLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnRXJyb3IgZmV0Y2hpbmcgdXNlciBjb2xsZWN0aW9ucy4gUGxlYXNlIGNoZWNrIHlvdXIgQVBJIHRva2VuIGFuZCBjb25uZWN0aW9uLicsIDEwMDAwKTtcbiAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBTdG9wIHRoZSBmZXRjaCBwcm9jZXNzXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEJ1aWxkIHRoZSBoaWVyYXJjaHkgYW5kIG5hbWUvSUQgbWFwcyBmcm9tIGFsbCBjb2xsZWN0aW9uc1xuICAgICAgICAgICAgYWxsQ29sbGVjdGlvbnMuZm9yRWFjaChjb2wgPT4ge1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25OYW1lVG9JZE1hcC5zZXQoY29sLnRpdGxlLnRvTG93ZXJDYXNlKCksIGNvbC5faWQpO1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25JZFRvTmFtZU1hcC5zZXQoY29sLl9pZCwgY29sLnRpdGxlKTtcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uSGllcmFyY2h5LnNldChjb2wuX2lkLCB7IHRpdGxlOiBjb2wudGl0bGUsIHBhcmVudElkOiBjb2wucGFyZW50Py4kaWQgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICBjb2xsZWN0aW9uc0RhdGEgPSB7IHJlc3VsdDogdHJ1ZSwgaXRlbXM6IGFsbENvbGxlY3Rpb25zIH07IC8vIFN0b3JlIGNvbWJpbmVkIGRhdGFcblxuICAgICAgICAgICAgY29uc3QgdW5yZXNvbHZlZElucHV0czogc3RyaW5nW10gPSBbXTtcblxuICAgICAgICAgICAgLy8gUmVzb2x2ZSBpbnB1dCBuYW1lcy9JRHMgdG8gZ2V0IHJlc29sdmVkQ29sbGVjdGlvbklkc1xuICAgICAgICAgICAgZm9yIChjb25zdCBpbnB1dCBvZiBjb2xsZWN0aW9uSW5wdXRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5wdXRBc051bWJlciA9IHBhcnNlSW50KGlucHV0LCAxMCk7XG4gICAgICAgICAgICAgICAgaWYgKCFpc05hTihpbnB1dEFzTnVtYmVyKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBJbnB1dCBpcyBhIG51bWJlciwgdHJlYXQgYXMgSURcbiAgICAgICAgICAgICAgICAgICAgLy8gVmVyaWZ5IGlmIHRoaXMgSUQgZXhpc3RzIGluIHRoZSBmZXRjaGVkIGNvbGxlY3Rpb25zXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uSWRUb05hbWVNYXAuaGFzKGlucHV0QXNOdW1iZXIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWRDb2xsZWN0aW9uSWRzLnB1c2goaW5wdXRBc051bWJlcik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgdW5yZXNvbHZlZElucHV0cy5wdXNoKGlucHV0KTsgLy8gSUQgbm90IGZvdW5kIGluIGZldGNoZWQgY29sbGVjdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYENvdWxkIG5vdCBmaW5kIGNvbGxlY3Rpb24gd2l0aCBJRDogJHtpbnB1dH1gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElucHV0IGlzIHRleHQsIHRyZWF0IGFzIG5hbWVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzb2x2ZWRJZCA9IGNvbGxlY3Rpb25OYW1lVG9JZE1hcC5nZXQoaW5wdXQudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNvbHZlZElkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVkQ29sbGVjdGlvbklkcy5wdXNoKHJlc29sdmVkSWQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdW5yZXNvbHZlZElucHV0cy5wdXNoKGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgQ291bGQgbm90IHJlc29sdmUgY29sbGVjdGlvbiBuYW1lOiAke2lucHV0fWApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodW5yZXNvbHZlZElucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZShgQ291bGQgbm90IGZpbmQgY29sbGVjdGlvbnM6ICR7dW5yZXNvbHZlZElucHV0cy5qb2luKCcsICcpfS4gUGxlYXNlIGNoZWNrIG5hbWVzIG9yIHVzZSBJRHMuYCwgMTUwMDApO1xuICAgICAgICAgICAgICAgIC8vIERlY2lkZSB3aGV0aGVyIHRvIGNvbnRpbnVlIHdpdGggcmVzb2x2ZWQgSURzIG9yIHN0b3AuIEZvciBub3csIGNvbnRpbnVlLlxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgLy8gSWYgdXNlciBwcm92aWRlZCBpbnB1dCBidXQgbm9uZSBjb3VsZCBiZSByZXNvbHZlZFxuICAgICAgICAgICAgaWYgKHJlc29sdmVkQ29sbGVjdGlvbklkcy5sZW5ndGggPT09IDAgJiYgY29sbGVjdGlvbklucHV0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgIGxvYWRpbmdOb3RpY2UuaGlkZSgpO1xuICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdObyB2YWxpZCBjb2xsZWN0aW9uIElEcyBvciBuYW1lcyBwcm92aWRlZC4nLCA1MDAwKTtcbiAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBFbnN1cmUgdW5pcXVlIElEcyBpbiByZXNvbHZlZENvbGxlY3Rpb25JZHNcbiAgICAgICAgICAgIHJlc29sdmVkQ29sbGVjdGlvbklkcyA9IEFycmF5LmZyb20obmV3IFNldChyZXNvbHZlZENvbGxlY3Rpb25JZHMpKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgb3B0aW9ucy5jb2xsZWN0aW9ucyBpcyBlbXB0eSwgZmV0Y2ggZnJvbSBhbGwgY29sbGVjdGlvbnMgKGNvbGxlY3Rpb25JZCAwKVxuICAgICAgICAgICAgLy8gV2Ugc3RpbGwgbmVlZCB0byBmZXRjaCBjb2xsZWN0aW9uIGhpZXJhcmNoeSB0byBvcmdhbml6ZSBub3RlcyBwcm9wZXJseVxuICAgICAgICAgICAgbG9hZGluZ05vdGljZS5zZXRNZXNzYWdlKCdGZXRjaGluZyBhbGwgY29sbGVjdGlvbnMuLi4nKTtcblxuICAgICAgICAgICAgLy8gRmV0Y2ggcm9vdCBjb2xsZWN0aW9uc1xuICAgICAgICAgICAgY29uc3Qgcm9vdENvbGxlY3Rpb25zUmVzcG9uc2UgPSBhd2FpdCBmZXRjaFdpdGhSZXRyeShcbiAgICAgICAgICAgICAgICBgJHtiYXNlQXBpVXJsfS9jb2xsZWN0aW9uc2AsXG4gICAgICAgICAgICAgICAgZmV0Y2hPcHRpb25zLFxuICAgICAgICAgICAgICAgIHRoaXMucmF0ZUxpbWl0ZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCByb290Q29sbGVjdGlvbnNEYXRhID0gcm9vdENvbGxlY3Rpb25zUmVzcG9uc2UgYXMgQ29sbGVjdGlvblJlc3BvbnNlO1xuXG4gICAgICAgICAgICAvLyBGZXRjaCBuZXN0ZWQgY29sbGVjdGlvbnNcbiAgICAgICAgICAgIGNvbnN0IG5lc3RlZENvbGxlY3Rpb25zUmVzcG9uc2UgPSBhd2FpdCBmZXRjaFdpdGhSZXRyeShcbiAgICAgICAgICAgICAgICBgJHtiYXNlQXBpVXJsfS9jb2xsZWN0aW9ucy9jaGlsZHJlbnNgLFxuICAgICAgICAgICAgICAgIGZldGNoT3B0aW9ucyxcbiAgICAgICAgICAgICAgICB0aGlzLnJhdGVMaW1pdGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgbmVzdGVkQ29sbGVjdGlvbnNEYXRhID0gbmVzdGVkQ29sbGVjdGlvbnNSZXNwb25zZSBhcyBDb2xsZWN0aW9uUmVzcG9uc2U7XG5cbiAgICAgICAgICAgIC8vIENvbWJpbmUgcm9vdCBhbmQgbmVzdGVkIGNvbGxlY3Rpb25zXG4gICAgICAgICAgICBsZXQgYWxsQ29sbGVjdGlvbnM6IFJhaW5kcm9wQ29sbGVjdGlvbltdID0gW107XG4gICAgICAgICAgICBpZiAocm9vdENvbGxlY3Rpb25zRGF0YT8ucmVzdWx0ICYmIHJvb3RDb2xsZWN0aW9uc0RhdGE/Lml0ZW1zKSB7XG4gICAgICAgICAgICAgICAgYWxsQ29sbGVjdGlvbnMgPSBhbGxDb2xsZWN0aW9ucy5jb25jYXQocm9vdENvbGxlY3Rpb25zRGF0YS5pdGVtcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobmVzdGVkQ29sbGVjdGlvbnNEYXRhPy5yZXN1bHQgJiYgbmVzdGVkQ29sbGVjdGlvbnNEYXRhPy5pdGVtcykge1xuICAgICAgICAgICAgICAgIGFsbENvbGxlY3Rpb25zID0gYWxsQ29sbGVjdGlvbnMuY29uY2F0KG5lc3RlZENvbGxlY3Rpb25zRGF0YS5pdGVtcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhbGxDb2xsZWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBUEkgRXJyb3IgZmV0Y2hpbmcgY29sbGVjdGlvbnM6IE5vIGNvbGxlY3Rpb25zIHJldHVybmVkIGZyb20gYm90aCBlbmRwb2ludHMuJyk7XG4gICAgICAgICAgICAgICAgbG9hZGluZ05vdGljZS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgbmV3IE5vdGljZSgnRXJyb3IgZmV0Y2hpbmcgdXNlciBjb2xsZWN0aW9ucy4gUGxlYXNlIGNoZWNrIHlvdXIgQVBJIHRva2VuIGFuZCBjb25uZWN0aW9uLicsIDEwMDAwKTtcbiAgICAgICAgICAgICAgICByZXR1cm47IC8vIFN0b3AgdGhlIGZldGNoIHByb2Nlc3NcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQnVpbGQgdGhlIGhpZXJhcmNoeSBhbmQgbmFtZS9JRCBtYXBzIGZyb20gYWxsIGNvbGxlY3Rpb25zXG4gICAgICAgICAgICBhbGxDb2xsZWN0aW9ucy5mb3JFYWNoKGNvbCA9PiB7XG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbk5hbWVUb0lkTWFwLnNldChjb2wudGl0bGUudG9Mb3dlckNhc2UoKSwgY29sLl9pZCk7XG4gICAgICAgICAgICAgICAgY29sbGVjdGlvbklkVG9OYW1lTWFwLnNldChjb2wuX2lkLCBjb2wudGl0bGUpO1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25IaWVyYXJjaHkuc2V0KGNvbC5faWQsIHsgdGl0bGU6IGNvbC50aXRsZSwgcGFyZW50SWQ6IGNvbC5wYXJlbnQ/LiRpZCB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb2xsZWN0aW9uc0RhdGEgPSB7IHJlc3VsdDogdHJ1ZSwgaXRlbXM6IGFsbENvbGxlY3Rpb25zIH07XG4gICAgICAgIH1cbiAgICAgICAgLy8gLS0tIEVuZCBSZXNvbHZlIENvbGxlY3Rpb24gTmFtZXMvSURzIGFuZCBGZXRjaCBIaWVyYXJjaHkgLS0tXG5cbiAgICAgICAgY29uc3Qgc2VhcmNoUGFyYW1ldGVyU3RyaW5nID0gb3B0aW9ucy5hcGlGaWx0ZXJUYWdzLnNwbGl0KCcsJykubWFwKHRhZyA9PiB0YWcudHJpbSgpKS5maWx0ZXIodGFnID0+IHRhZyAhPT0gJycpLmpvaW4oJyAnKTsgLy8gU3BhY2Utc2VwYXJhdGVkIGZvciBBTkQgbG9naWNcblxuICAgICAgICBsZXQgZmV0Y2hNb2RlOiAnY29sbGVjdGlvbnMnIHwgJ3RhZ3MnIHwgJ2FsbCcgPSAnYWxsJztcblxuICAgICAgICAvLyBJZiB1c2VyIHNwZWNpZmllZCBjb2xsZWN0aW9ucyBPUiB0YWdzLCB3ZSB0cmVhdCBpdCBhcyBmaWx0ZXJlZCBmZXRjaFxuICAgICAgICAvLyBFdmVuIGlmIGNvbGxlY3Rpb25zIGZpZWxkIGlzIGVtcHR5LCBpZiB0YWdzIGFyZSBwcmVzZW50LCB3ZSBmZXRjaCB2aWEgdGFncyBlbmRwb2ludCAoY29sbGVjdGlvbklkIDApXG4gICAgICAgIGlmIChyZXNvbHZlZENvbGxlY3Rpb25JZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZmV0Y2hNb2RlID0gJ2NvbGxlY3Rpb25zJztcbiAgICAgICAgfSBlbHNlIGlmIChzZWFyY2hQYXJhbWV0ZXJTdHJpbmcgfHwgKG9wdGlvbnMudGFnTWF0Y2hUeXBlID09PSBUYWdNYXRjaFR5cGVzLkFOWSAmJiBvcHRpb25zLmFwaUZpbHRlclRhZ3MubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgICBmZXRjaE1vZGUgPSAndGFncyc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGZXRjaCByYWluZHJvcHMgYmFzZWQgb24gdGhlIGRldGVybWluZWQgbW9kZVxuXG4gICAgICAgIGlmIChmZXRjaE1vZGUgPT09ICdjb2xsZWN0aW9ucycpIHtcbiAgICAgICAgICAgIC8vIEZldGNoIGZyb20gc3BlY2lmaWVkIGNvbGxlY3Rpb24gSURzXG4gICAgICAgICAgICBmb3IgKGNvbnN0IGNvbGxlY3Rpb25JZCBvZiByZXNvbHZlZENvbGxlY3Rpb25JZHMpIHtcbiAgICAgICAgICAgICAgICBsZXQgaGFzTW9yZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgbGV0IHBhZ2UgPSAwO1xuXG4gICAgICAgICAgICAgICAgLy8gQ29uc3RydWN0IHRoZSBBUEkgVVJMIHdpdGggZmlsdGVyIHR5cGUgYW5kIHNlYXJjaCBpZiBzcGVjaWZpZWRcbiAgICAgICAgICAgICAgICBjb25zdCBjb2xsZWN0aW9uQXBpQmFzZVVybCA9IGAke2Jhc2VBcGlVcmx9L3JhaW5kcm9wcy8ke2NvbGxlY3Rpb25JZH1gO1xuXG4gICAgICAgICAgICAgICAgd2hpbGUgKGhhc01vcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJwYWdlOiBwZXJQYWdlLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBmaWx0ZXIgdHlwZSB0byBwYXJhbXMgaWYgbm90ICdhbGwnXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmZpbHRlclR5cGUgJiYgb3B0aW9ucy5maWx0ZXJUeXBlICE9PSAnYWxsJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmFwcGVuZCgndHlwZScsIG9wdGlvbnMuZmlsdGVyVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNlYXJjaCBwYXJhbWV0ZXIgaWYgaXQgZXhpc3RzIChmb3IgZmlsdGVyaW5nIHdpdGhpbiBhIGNvbGxlY3Rpb24pXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWFyY2hQYXJhbWV0ZXJTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy5hcHBlbmQoJ3NlYXJjaCcsIHNlYXJjaFBhcmFtZXRlclN0cmluZyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIG5lc3RlZCBwYXJhbWV0ZXIgaWYgaW5jbHVkZVN1YmNvbGxlY3Rpb25zIGlzIHRydWVcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuaW5jbHVkZVN1YmNvbGxlY3Rpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmFwcGVuZCgnbmVzdGVkJywgJ3RydWUnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRBcGlVcmwgPSBgJHtjb2xsZWN0aW9uQXBpQmFzZVVybH0/JHtwYXJhbXMudG9TdHJpbmcoKX1gO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgUmVxdWVzdGluZyBpdGVtcyBmcm9tIGNvbGxlY3Rpb24gSUQ6ICR7Y29sbGVjdGlvbklkfWAsIGN1cnJlbnRBcGlVcmwpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEdldCBjb2xsZWN0aW9uIG5hbWUgZm9yIG5vdGljZSBtZXNzYWdlIChvcHRpb25hbClcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sbGVjdGlvbk5hbWVGb3JOb3RpY2UgPSBjb2xsZWN0aW9uSWRUb05hbWVNYXAuZ2V0KGNvbGxlY3Rpb25JZCkgfHwgY29sbGVjdGlvbklkLnRvU3RyaW5nKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgbG9hZGluZ05vdGljZS5zZXRNZXNzYWdlKGBGZXRjaGluZyBmcm9tIGNvbGxlY3Rpb246ICR7Y29sbGVjdGlvbk5hbWVGb3JOb3RpY2V9LCBwYWdlICR7cGFnZSArIDF9Li4uYCk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaFdpdGhSZXRyeShjdXJyZW50QXBpVXJsLCBmZXRjaE9wdGlvbnMsIHRoaXMucmF0ZUxpbWl0ZXIpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UgYXMgUmFpbmRyb3BSZXNwb25zZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEucmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBBUEkgRXJyb3IgZm9yIGNvbGxlY3Rpb24gJHtjb2xsZWN0aW9uSWR9OmAsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShgRXJyb3IgZmV0Y2hpbmcgY29sbGVjdGlvbjogJHtjb2xsZWN0aW9uTmFtZUZvck5vdGljZX0uIFNraXBwaW5nLmAsIDcwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFzTW9yZSA9IGZhbHNlOyAvLyBTdG9wIGZldGNoaW5nIGZvciB0aGlzIGNvbGxlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOyAvLyBNb3ZlIHRvIHRoZSBuZXh0IHNwZWNpZmllZCBjb2xsZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YT8uaXRlbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbERhdGEgPSBhbGxEYXRhLmNvbmNhdChkYXRhLml0ZW1zKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2UrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc01vcmUgPSBkYXRhLml0ZW1zLmxlbmd0aCA9PT0gcGVyUGFnZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBGZXRjaGVkICR7ZGF0YS5pdGVtcy5sZW5ndGh9IGl0ZW1zIGZyb20gY29sbGVjdGlvbiAke2NvbGxlY3Rpb25JZH0sIHBhZ2UgJHtwYWdlfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc01vcmUpIHsgLy8gVXBkYXRlIG1lc3NhZ2Ugb25seSBpZiB0aGVyZSdzIG1vcmUgdG8gZmV0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ05vdGljZS5zZXRNZXNzYWdlKGBGZXRjaGluZyBmcm9tIGNvbGxlY3Rpb246ICR7Y29sbGVjdGlvbk5hbWVGb3JOb3RpY2V9LCBwYWdlICR7cGFnZSArIDF9Li4uYCk7IC8vIFVzZSBuYW1lIGluIG1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVW5leHBlY3RlZCByZXNwb25zZSBmb3IgY29sbGVjdGlvbiAke2NvbGxlY3Rpb25JZH0uIFN0b3BwaW5nLmApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFzTW9yZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZldGNoTW9kZSA9PT0gJ3RhZ3MnKSB7XG4gICAgICAgICAgICAvLyBGZXRjaCBiYXNlZCBvbiB0YWdzICh1c2VzIGNvbGxlY3Rpb25JZCAwIGVuZHBvaW50KVxuICAgICAgICAgICAgaWYgKG9wdGlvbnMudGFnTWF0Y2hUeXBlID09PSBUYWdNYXRjaFR5cGVzLkFOWSAmJiBvcHRpb25zLmFwaUZpbHRlclRhZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIC8vIEltcGxlbWVudGF0aW9uIG9mIE9SIGxvZ2ljIGZvciB0YWdzIChmZXRjaCBlYWNoIHRhZyBzZXBhcmF0ZWx5KVxuICAgICAgICAgICAgICAgIGNvbnN0IHVuaXF1ZUl0ZW1zID0gbmV3IE1hcDxudW1iZXIsIFJhaW5kcm9wSXRlbT4oKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHRhZ3NBcnJheSA9IG9wdGlvbnMuYXBpRmlsdGVyVGFncy5zcGxpdCgnLCcpLm1hcCh0YWcgPT4gdGFnLnRyaW0oKSkuZmlsdGVyKHRhZyA9PiB0YWcgIT09ICcnKTtcblxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdGFnIG9mIHRhZ3NBcnJheSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgaGFzTW9yZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGxldCBwYWdlID0gMDtcblxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaGFzTW9yZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVycGFnZTogcGVyUGFnZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2g6IGAjJHt0YWd9YCAvLyBTaW1wbGUsIHJlbGlhYmxlIHNpbmdsZS10YWcgc2VhcmNoXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBmaWx0ZXIgdHlwZSB0byBwYXJhbXMgaWYgbm90ICdhbGwnXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5maWx0ZXJUeXBlICYmIG9wdGlvbnMuZmlsdGVyVHlwZSAhPT0gJ2FsbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMuYXBwZW5kKCd0eXBlJywgb3B0aW9ucy5maWx0ZXJUeXBlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEFwaVVybCA9IGAke2Jhc2VBcGlVcmx9L3JhaW5kcm9wcy8wPyR7cGFyYW1zLnRvU3RyaW5nKCl9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBSZXF1ZXN0aW5nIGl0ZW1zIHdpdGggdGFnOiAke3RhZ31gLCBjdXJyZW50QXBpVXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdOb3RpY2Uuc2V0TWVzc2FnZShgRmV0Y2hpbmcgaXRlbXMgd2l0aCB0YWc6ICR7dGFnfSwgcGFnZSAke3BhZ2UgKyAxfS4uLmApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoV2l0aFJldHJ5KHRoaXMuYXBwLCBjdXJyZW50QXBpVXJsLCBmZXRjaE9wdGlvbnMsIHRoaXMucmF0ZUxpbWl0ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlIGFzIFJhaW5kcm9wUmVzcG9uc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGF0YS5yZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBBUEkgRXJyb3IgZm9yIHRhZyAke3RhZ306YCwgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyB0YWcgaWYgdGhlcmUncyBhbiBlcnJvciwgYnV0IGNvbnRpbnVlIHdpdGggb3RoZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBBUEkgUmVzcG9uc2UgZm9yIHRhZyAke3RhZ306YCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdDogZGF0YS5yZXN1bHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUNvdW50OiBkYXRhPy5pdGVtcz8ubGVuZ3RoIHx8IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxDb3VudDogZGF0YT8uY291bnQgfHwgMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhPy5pdGVtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIGl0ZW1zIGluIE1hcCB1c2luZyBfaWQgYXMga2V5IHRvIGF1dG9tYXRpY2FsbHkgaGFuZGxlIGR1cGxpY2F0ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLml0ZW1zLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdW5pcXVlSXRlbXMuaGFzKGl0ZW0uX2lkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlSXRlbXMuc2V0KGl0ZW0uX2lkLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFnZSsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc01vcmUgPSBkYXRhLml0ZW1zLmxlbmd0aCA9PT0gcGVyUGFnZTsgLy8gQ29udGludWUgaWYgd2UgZ290IGEgZnVsbCBwYWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEZldGNoZWQgJHtkYXRhLml0ZW1zLmxlbmd0aH0gaXRlbXMgZm9yIHRhZyAke3RhZ30sIHBhZ2UgJHtwYWdlfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNNb3JlKSB7IC8vIFVwZGF0ZSBtZXNzYWdlIG9ubHkgaWYgdGhlcmUncyBtb3JlIHRvIGZldGNoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nTm90aWNlLnNldE1lc3NhZ2UoYEZldGNoaW5nIGl0ZW1zIHdpdGggdGFnOiAke3RhZ30sIHBhZ2UgJHtwYWdlICsgMX0uLi5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc01vcmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdGhlIE1hcCB2YWx1ZXMgYmFjayB0byBhbiBhcnJheSBmb3IgcHJvY2Vzc2luZ1xuICAgICAgICAgICAgICAgIGFsbERhdGEgPSBBcnJheS5mcm9tKHVuaXF1ZUl0ZW1zLnZhbHVlcygpKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgVG90YWwgdW5pcXVlIGl0ZW1zIGZvdW5kIGFjcm9zcyBhbGwgdGFnczogJHthbGxEYXRhLmxlbmd0aH1gKTtcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChzZWFyY2hQYXJhbWV0ZXJTdHJpbmcpIHtcbiAgICAgICAgICAgICAgICAvLyBPcmlnaW5hbCBBTkQgbG9naWMgb3Igc2luZ2xlIHRhZyBzZWFyY2ggdXNpbmcgdGhlIHNpbXBsZSBzcGFjZS1zZXBhcmF0ZWQgZm9ybWF0XG4gICAgICAgICAgICAgICAgbGV0IGhhc01vcmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGxldCBwYWdlID0gMDtcblxuICAgICAgICAgICAgICAgIHdoaWxlIChoYXNNb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgcGVycGFnZTogcGVyUGFnZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFnZS50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2hQYXJhbWV0ZXJTdHJpbmcgLy8gVGhpcyBoYW5kbGVzIHNwYWNlLXNlcGFyYXRlZCB0YWdzIGZvciBBTkQgbG9naWNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGZpbHRlciB0eXBlIHRvIHBhcmFtcyBpZiBub3QgJ2FsbCdcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZmlsdGVyVHlwZSAmJiBvcHRpb25zLmZpbHRlclR5cGUgIT09ICdhbGwnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMuYXBwZW5kKCd0eXBlJywgb3B0aW9ucy5maWx0ZXJUeXBlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRBcGlVcmwgPSBgJHtiYXNlQXBpVXJsfS9yYWluZHJvcHMvMD8ke3BhcmFtcy50b1N0cmluZygpfWA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBSZXF1ZXN0aW5nIGl0ZW1zIHdpdGggdGFnczogJHtzZWFyY2hQYXJhbWV0ZXJTdHJpbmd9YCwgY3VycmVudEFwaVVybCk7XG4gICAgICAgICAgICAgICAgICAgICBsb2FkaW5nTm90aWNlLnNldE1lc3NhZ2UoYEZldGNoaW5nIGl0ZW1zIHdpdGggdGFnczogJHtzZWFyY2hQYXJhbWV0ZXJTdHJpbmd9LCBwYWdlICR7cGFnZSArIDF9Li4uYCk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaFdpdGhSZXRyeShjdXJyZW50QXBpVXJsLCBmZXRjaE9wdGlvbnMsIHRoaXMucmF0ZUxpbWl0ZXIpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzcG9uc2UgYXMgUmFpbmRyb3BSZXNwb25zZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGEucmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBUEkgRXJyb3IgZm9yIHRhZyBzZWFyY2g6JywgZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFQSSBFcnJvcjogJHtKU09OLnN0cmluZ2lmeShkYXRhKX1gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhPy5pdGVtcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEuY29uY2F0KGRhdGEuaXRlbXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFnZSsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFzTW9yZSA9IGRhdGEuaXRlbXMubGVuZ3RoID09PSBwZXJQYWdlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEZldGNoZWQgJHtkYXRhLml0ZW1zLmxlbmd0aH0gaXRlbXMgd2l0aCB0YWdzLCBwYWdlICR7cGFnZX1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzTW9yZSkgeyAvLyBVcGRhdGUgbWVzc2FnZSBvbmx5IGlmIHRoZXJlJ3MgbW9yZSB0byBmZXRjaFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdOb3RpY2Uuc2V0TWVzc2FnZShgRmV0Y2hpbmcgaXRlbXMgd2l0aCB0YWdzOiAke3NlYXJjaFBhcmFtZXRlclN0cmluZ30sIHBhZ2UgJHtwYWdlICsgMX0uLi5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc01vcmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEZldGNoIG1vZGUgaXMgJ2FsbCcgLSBmZXRjaCBhbGwgaXRlbXMgKGNvbGxlY3Rpb25JZCAwKVxuICAgICAgICAgICAgbGV0IGhhc01vcmUgPSB0cnVlO1xuICAgICAgICAgICAgbGV0IHBhZ2UgPSAwO1xuXG4gICAgICAgICAgICB3aGlsZSAoaGFzTW9yZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoeyBwZXJwYWdlOiBwZXJQYWdlLnRvU3RyaW5nKCksIHBhZ2U6IHBhZ2UudG9TdHJpbmcoKSB9KTtcblxuICAgICAgICAgICAgICAgIC8vIEFkZCBmaWx0ZXIgdHlwZSB0byBwYXJhbXMgaWYgbm90ICdhbGwnXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZmlsdGVyVHlwZSAmJiBvcHRpb25zLmZpbHRlclR5cGUgIT09ICdhbGwnKSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5hcHBlbmQoJ3R5cGUnLCBvcHRpb25zLmZpbHRlclR5cGUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRBcGlVcmwgPSBgJHtiYXNlQXBpVXJsfS9yYWluZHJvcHMvMD8ke3BhcmFtcy50b1N0cmluZygpfWA7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1JlcXVlc3RpbmcgYWxsIGl0ZW1zOicsIGN1cnJlbnRBcGlVcmwpO1xuICAgICAgICAgICAgICAgIGxvYWRpbmdOb3RpY2Uuc2V0TWVzc2FnZShgRmV0Y2hpbmcgYWxsIGl0ZW1zLCBwYWdlICR7cGFnZSArIDF9Li4uYCk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoV2l0aFJldHJ5KGN1cnJlbnRBcGlVcmwsIGZldGNoT3B0aW9ucywgdGhpcy5yYXRlTGltaXRlcik7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc3BvbnNlIGFzIFJhaW5kcm9wUmVzcG9uc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAoIWRhdGEucmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FQSSBFcnJvciBmb3IgYWxsIGl0ZW1zIGZldGNoOicsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFQSSBFcnJvcjogJHtKU09OLnN0cmluZ2lmeShkYXRhKX1gKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoZGF0YT8uaXRlbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgYWxsRGF0YSA9IGFsbERhdGEuY29uY2F0KGRhdGEuaXRlbXMpO1xuICAgICAgICAgICAgICAgICAgICBwYWdlKys7XG4gICAgICAgICAgICAgICAgICAgIGhhc01vcmUgPSBkYXRhLml0ZW1zLmxlbmd0aCA9PT0gcGVyUGFnZTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEZldGNoZWQgJHtkYXRhLml0ZW1zLmxlbmd0aH0gaXRlbXMsIHBhZ2UgJHtwYWdlfWApO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaGFzTW9yZSkgeyAvLyBVcGRhdGUgbWVzc2FnZSBvbmx5IGlmIHRoZXJlJ3MgbW9yZSB0byBmZXRjaFxuICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdOb3RpY2Uuc2V0TWVzc2FnZShgRmV0Y2hpbmcgYWxsIGl0ZW1zLCBwYWdlICR7cGFnZSArIDF9Li4uYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1VuZXhwZWN0ZWQgcmVzcG9uc2UgZm9yIGFsbCBpdGVtcyBmZXRjaC4gU3RvcHBpbmcuJyk7XG4gICAgICAgICAgICAgICAgICAgIGhhc01vcmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWxsRGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGlmIChyZXNvbHZlZENvbGxlY3Rpb25JZHMubGVuZ3RoID4gMCB8fCBzZWFyY2hQYXJhbWV0ZXJTdHJpbmcgfHwgKG9wdGlvbnMudGFnTWF0Y2hUeXBlID09PSBUYWdNYXRjaFR5cGVzLkFOWSAmJiBvcHRpb25zLmFwaUZpbHRlclRhZ3MubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nTm90aWNlLmhpZGUoKTsgLy8gRGlzbWlzcyBsb2FkaW5nIG5vdGljZVxuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ05vIHJhaW5kcm9wcyBmb3VuZCBtYXRjaGluZyB5b3VyIGNyaXRlcmlhLicsIDUwMDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2FkaW5nTm90aWNlLmhpZGUoKTsgLy8gRGlzbWlzcyBsb2FkaW5nIG5vdGljZVxuICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoJ05vIHJhaW5kcm9wcyBmb3VuZCBpbiB5b3VyIGFjY291bnQuJywgNTAwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2FkaW5nTm90aWNlLnNldE1lc3NhZ2UoYEZvdW5kICR7YWxsRGF0YS5sZW5ndGh9IHJhaW5kcm9wcy4gUHJvY2Vzc2luZy4uLmApOyAvLyBVcGRhdGUgbm90aWNlIG1lc3NhZ2VcbiAgICAgICAgICAgIC8vIFRoZSBsb2FkaW5nTm90aWNlIHdpbGwgYmUgaGlkZGVuIGluIHByb2Nlc3NSYWluZHJvcHNcbiAgICAgICAgICAgIC8vIFBhc3MgYWxsIG5lY2Vzc2FyeSBkYXRhIGluY2x1ZGluZyBjb2xsZWN0aW9uc0RhdGEsIHJlc29sdmVkQ29sbGVjdGlvbklkcywgYW5kIGNvbGxlY3Rpb25JZFRvTmFtZU1hcFxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzUmFpbmRyb3BzKGFsbERhdGEsIG9wdGlvbnMudmF1bHRQYXRoLCBvcHRpb25zLmFwcGVuZFRhZ3NUb05vdGVzLCBvcHRpb25zLnVzZVJhaW5kcm9wVGl0bGVGb3JGaWxlTmFtZSwgbG9hZGluZ05vdGljZSwgb3B0aW9ucywgY29sbGVjdGlvbnNEYXRhLCByZXNvbHZlZENvbGxlY3Rpb25JZHMsIGNvbGxlY3Rpb25JZFRvTmFtZU1hcCk7XG4gICAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxvYWRpbmdOb3RpY2UuaGlkZSgpOyAvLyBEaXNtaXNzIGxvYWRpbmcgbm90aWNlIG9uIGVycm9yXG4gICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSAnQW4gdW5rbm93biBlcnJvciBvY2N1cnJlZCBkdXJpbmcgZmV0Y2gnO1xuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGVycm9yID09PSAnc3RyaW5nJykgZXJyb3JNZXNzYWdlID0gZXJyb3I7XG4gICAgICAgIG5ldyBOb3RpY2UoYEVycm9yIGZldGNoaW5nIHJhaW5kcm9wczogJHtlcnJvck1lc3NhZ2V9YCwgMTAwMDApO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBSYWluZHJvcCBBUEk6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHByb2Nlc3NSYWluZHJvcHMocmFpbmRyb3BzOiBSYWluZHJvcEl0ZW1bXSwgdmF1bHRQYXRoOiBzdHJpbmcgfCB1bmRlZmluZWQsIGFwcGVuZFRhZ3NUb05vdGVzOiBzdHJpbmcsIHVzZVJhaW5kcm9wVGl0bGVGb3JGaWxlTmFtZTogYm9vbGVhbiwgbG9hZGluZ05vdGljZTogTm90aWNlLCBvcHRpb25zOiBNb2RhbEZldGNoT3B0aW9ucywgY29sbGVjdGlvbnNEYXRhPzogQ29sbGVjdGlvblJlc3BvbnNlLCByZXNvbHZlZENvbGxlY3Rpb25JZHM6IG51bWJlcltdID0gW10sIGNvbGxlY3Rpb25JZFRvTmFtZU1hcDogTWFwPG51bWJlciwgc3RyaW5nPiA9IG5ldyBNYXA8bnVtYmVyLCBzdHJpbmc+KCkpIHtcbiAgICBjb25zdCB7IGFwcCB9ID0gdGhpcztcbiAgICBjb25zdCBzZXR0aW5nc0ZNVGFncyA9IGFwcGVuZFRhZ3NUb05vdGVzLnNwbGl0KCcsJykubWFwKHRhZyA9PiB0YWcudHJpbSgpKS5maWx0ZXIodGFnID0+IHRhZyAhPT0gJycpO1xuXG4gICAgaWYgKHZhdWx0UGF0aCA9PT0gdW5kZWZpbmVkKSB2YXVsdFBhdGggPSB0aGlzLnNldHRpbmdzLmRlZmF1bHRWYXVsdExvY2F0aW9uO1xuICAgIGNvbnN0IHRhcmdldEZvbGRlclBhdGggPSB2YXVsdFBhdGg/LnRyaW0oKSA/PyBcIlwiO1xuXG4gICAgLy8gRGVjbGFyZSBhbmQgcG9wdWxhdGUgbWFwcyBhbmQgaGVscGVyIGZ1bmN0aW9uIHdpdGhpbiB0aGlzIHNjb3BlXG4gICAgY29uc3QgY29sbGVjdGlvbkhpZXJhcmNoeSA9IG5ldyBNYXA8bnVtYmVyLCB7IHRpdGxlOiBzdHJpbmcsIHBhcmVudElkPzogbnVtYmVyIH0+KCk7XG5cbiAgICAvLyBJZiBjb2xsZWN0aW9uc0RhdGEgd2FzIGZldGNoZWQgKG1lYW5pbmcgdXNlciBmaWx0ZXJlZCBieSBjb2xsZWN0aW9uKSwgYnVpbGQgdGhlIGhpZXJhcmNoeSBtYXBcbiAgICBpZiAoY29sbGVjdGlvbnNEYXRhPy5yZXN1bHQpIHtcbiAgICAgICAgY29sbGVjdGlvbnNEYXRhLml0ZW1zLmZvckVhY2goY29sID0+IHtcbiAgICAgICAgICAgIGNvbGxlY3Rpb25IaWVyYXJjaHkuc2V0KGNvbC5faWQsIHsgdGl0bGU6IGNvbC50aXRsZSwgcGFyZW50SWQ6IGNvbC5wYXJlbnQ/LiRpZCB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBhbmNlc3RvciBJRHMgZnJvbSBhIGdpdmVuIGNvbGxlY3Rpb24gSUQgdXAgdG8gdGhlIHJvb3RcbiAgICBjb25zdCBnZXRBbmNlc3RvcklkcyA9IChjb2xsZWN0aW9uSWQ6IG51bWJlcik6IG51bWJlcltdID0+IHtcbiAgICAgICAgY29uc3QgYW5jZXN0b3JzOiBudW1iZXJbXSA9IFtdO1xuICAgICAgICBcbiAgICAgICAgLy8gRmlyc3QgYWRkIHRoZSBzdGFydGluZyBjb2xsZWN0aW9uIElEIGl0c2VsZlxuICAgICAgICBhbmNlc3RvcnMucHVzaChjb2xsZWN0aW9uSWQpO1xuICAgICAgICBcbiAgICAgICAgbGV0IGN1cnJlbnRJZDogbnVtYmVyIHwgdW5kZWZpbmVkID0gY29sbGVjdGlvbklkO1xuXG4gICAgICAgIC8vIFRyYXZlcnNlIHVwd2FyZHMgdW50aWwgYSBzeXN0ZW0gY29sbGVjdGlvbiBvciB1bmtub3duIHBhcmVudCBpcyByZWFjaGVkXG4gICAgICAgIHdoaWxlIChjdXJyZW50SWQgIT09IHVuZGVmaW5lZCAmJiBjdXJyZW50SWQgIT09IDAgJiYgY3VycmVudElkICE9PSBTeXN0ZW1Db2xsZWN0aW9ucy5VTlNPUlRFRCAmJiBjdXJyZW50SWQgIT09IFN5c3RlbUNvbGxlY3Rpb25zLlRSQVNIKSB7XG4gICAgICAgICAgICBjb25zdCBjb2xsZWN0aW9uID0gY29sbGVjdGlvbkhpZXJhcmNoeS5nZXQoY3VycmVudElkKTtcbiAgICAgICAgICAgIGlmICghY29sbGVjdGlvbiB8fCBjb2xsZWN0aW9uLnBhcmVudElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAvLyBTdG9wIGlmIGNvbGxlY3Rpb24gbm90IGZvdW5kIGluIGhpZXJhcmNoeSBtYXAgb3Igbm8gcGFyZW50IGRlZmluZWRcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEFkZCB0aGUgcGFyZW50IElEIHRvIHRoZSBsaXN0XG4gICAgICAgICAgICBhbmNlc3RvcnMucHVzaChjb2xsZWN0aW9uLnBhcmVudElkKTtcbiAgICAgICAgICAgIC8vIE1vdmUgdXAgdG8gdGhlIHBhcmVudFxuICAgICAgICAgICAgY3VycmVudElkID0gY29sbGVjdGlvbi5wYXJlbnRJZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYW5jZXN0b3JzOyAvLyBSZXR1cm5zIHRoZSBjdXJyZW50IGNvbGxlY3Rpb24gSUQgYW5kIGFsbCBhbmNlc3RvcnMgdXAgdG8gdGhlIHJvb3RcbiAgICB9O1xuXG4gICAgLy8gQ29udmVydCByZXNvbHZlZENvbGxlY3Rpb25JZHMgdG8gYSBzZXQgb2YgU0FOSVRJWkVEIG5hbWVzIGZvciBlYXNpZXIgbG9va3VwIChvbmx5IG5lZWRlZCBpZiBmaWx0ZXJpbmcgYnkgbmFtZSlcbiAgICBjb25zdCByZXNvbHZlZENvbGxlY3Rpb25OYW1lcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgIC8vIE9ubHkgYnVpbGQgdGhpcyBzZXQgaWYgd2UgaGF2ZSBjb2xsZWN0aW9uIG5hbWVzIHJlc29sdmVkXG4gICAgaWYgKGNvbGxlY3Rpb25JZFRvTmFtZU1hcC5zaXplID4gMCkge1xuICAgICAgICByZXNvbHZlZENvbGxlY3Rpb25JZHMuZm9yRWFjaChpZCA9PiB7XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gY29sbGVjdGlvbklkVG9OYW1lTWFwLmdldChpZCk7XG4gICAgICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgICAgICAgIC8vIFNhbml0aXplIHRoZSBuYW1lIGJlZm9yZSBhZGRpbmcgdG8gdGhlIHNldCwgYW5kIGNvbnZlcnQgdG8gbG93ZXIgY2FzZVxuICAgICAgICAgICAgICAgIHJlc29sdmVkQ29sbGVjdGlvbk5hbWVzLmFkZCh0aGlzLnNhbml0aXplRmlsZU5hbWUobmFtZSkudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBiYXNlIGZvbGRlciBpZiBuZWVkZWRcbiAgICBpZiAodGFyZ2V0Rm9sZGVyUGF0aCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZm9sZGVyID0gYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aCh0YXJnZXRGb2xkZXJQYXRoKTtcbiAgICAgICAgICAgIGlmICghZm9sZGVyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYENyZWF0aW5nIGJhc2UgZm9sZGVyOiAke3RhcmdldEZvbGRlclBhdGh9YCk7XG4gICAgICAgICAgICAgICAgYXdhaXQgYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcih0YXJnZXRGb2xkZXJQYXRoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWZvbGRlci5oYXNPd25Qcm9wZXJ0eSgnY2hpbGRyZW4nKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgUGF0aCBleGlzdHMgYnV0IGlzIG5vdCBhIGZvbGRlcjogJHt0YXJnZXRGb2xkZXJQYXRofWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbGV0IGVycm9yTXNnID0gJ2ZvbGRlciBjcmVhdGlvbiBmYWlsZWQnO1xuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIGVycm9yTXNnID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgICAgIG5ldyBOb3RpY2UoYEZhaWxlZCB0byBjcmVhdGUvdmVyaWZ5IGJhc2UgZm9sZGVyOiAke3RhcmdldEZvbGRlclBhdGh9LiBFcnJvcjogJHtlcnJvck1zZ30uYCwgMTAwMDApO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHdpdGggZm9sZGVyIG9wZXJhdGlvbjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgbG9hZGluZ05vdGljZS5oaWRlKCk7IC8vIERpc21pc3Mgbm90aWNlIG9uIGNyaXRpY2FsIGVycm9yXG4gICAgICAgICAgICByZXR1cm47IC8vIFN0b3AgcHJvY2Vzc2luZyBpZiBiYXNlIGZvbGRlciBjYW5ub3QgYmUgY3JlYXRlZFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgbGV0IGNyZWF0ZWRDb3VudCA9IDA7XG4gICAgbGV0IHNraXBwZWRDb3VudCA9IDA7XG4gICAgbGV0IGVycm9yQ291bnQgPSAwO1xuICAgIGxldCB1cGRhdGVkQ291bnQgPSAwOyAvLyBDb3VudGVyIGZvciB1cGRhdGVkIG5vdGVzXG4gICAgY29uc3QgdG90YWwgPSByYWluZHJvcHMubGVuZ3RoO1xuICAgIGxldCBwcm9jZXNzZWQgPSAwO1xuXG4gICAgLy8gR3JvdXAgcmFpbmRyb3BzIGJ5IHRoZWlyIGRpcmVjdCBjb2xsZWN0aW9uIElEIChuZWVkZWQgZm9yIHBhdGggYnVpbGRpbmcpXG4gICAgY29uc3QgcmFpbmRyb3BzQnlDb2xsZWN0aW9uOiB7IFtrZXk6IHN0cmluZ106IFJhaW5kcm9wSXRlbVtdIH0gPSB7fTtcbiAgICBmb3IgKGNvbnN0IHJhaW5kcm9wIG9mIHJhaW5kcm9wcykge1xuICAgICAgICBjb25zdCBjb2xsZWN0aW9uSWQgPSByYWluZHJvcC5jb2xsZWN0aW9uPy4kaWQ/LnRvU3RyaW5nKCkgfHwgJ3VuY2F0ZWdvcml6ZWQnO1xuICAgICAgICBpZiAoIXJhaW5kcm9wc0J5Q29sbGVjdGlvbltjb2xsZWN0aW9uSWRdKSB7XG4gICAgICAgICAgICByYWluZHJvcHNCeUNvbGxlY3Rpb25bY29sbGVjdGlvbklkXSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJhaW5kcm9wc0J5Q29sbGVjdGlvbltjb2xsZWN0aW9uSWRdLnB1c2gocmFpbmRyb3ApO1xuICAgIH1cblxuICAgIC8vIFByb2Nlc3MgcmFpbmRyb3BzIGNvbGxlY3Rpb24gYnkgY29sbGVjdGlvblxuICAgIGZvciAoY29uc3QgW2NvbGxlY3Rpb25JZCwgY29sbGVjdGlvblJhaW5kcm9wc10gb2YgT2JqZWN0LmVudHJpZXMocmFpbmRyb3BzQnlDb2xsZWN0aW9uKSkge1xuXG4gICAgICAgIC8vIERldGVybWluZSB0aGUgZm9sZGVyIHBhdGggd2l0aGluIHRoZSB0YXJnZXQgZm9sZGVyXG4gICAgICAgIGxldCByZWxhdGl2ZUZvbGRlclBhdGhTZWdtZW50czogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgbGV0IGNvbGxlY3Rpb25UaXRsZUZvck5vdGljZSA9ICdVbmtub3duIENvbGxlY3Rpb24nOyAvLyBEZWNsYXJlIG9uY2UgaGVyZVxuXG4gICAgICAgIGNvbnN0IGN1cnJlbnRDb2xsZWN0aW9uSWQgPSBwYXJzZUludChjb2xsZWN0aW9uSWQsIDEwKTsgLy8gY29sbGVjdGlvbklkIGZyb20gT2JqZWN0LmVudHJpZXMgaXMgYSBzdHJpbmdcblxuICAgICAgICAvLyBPbmx5IGF0dGVtcHQgY29tcGxleCBwYXRoIGJ1aWxkaW5nIGlmIHdlIGhhdmUgaGllcmFyY2h5IGRhdGEgYW5kIGl0J3Mgbm90IGEgc3lzdGVtL3VuY2F0ZWdvcml6ZWQgY29sbGVjdGlvblxuICAgICAgICAvLyBOb3RlOiBXZSBzaG91bGQgc3RpbGwgYnVpbGQgaGllcmFyY2h5IGV2ZW4gd2hlbiBubyBzcGVjaWZpYyBjb2xsZWN0aW9ucyBhcmUgc2VsZWN0ZWRcbiAgICAgICAgaWYgKCFpc05hTihjdXJyZW50Q29sbGVjdGlvbklkKSAmJiBjdXJyZW50Q29sbGVjdGlvbklkID4gMCAmJiBjb2xsZWN0aW9uSGllcmFyY2h5LnNpemUgPiAwKSB7XG5cbiAgICAgICAgICAgICAvLyBGaW5kIHRoZSBkZWVwZXN0IHVzZXItc3BlY2lmaWVkIGFuY2VzdG9yIGluIHRoZSBjdXJyZW50IGNvbGxlY3Rpb24ncyBhbmNlc3RyeVxuICAgICAgICAgICAgIC8vIE5vdGU6IGdldEFuY2VzdG9ySWRzIG5vdyBpbmNsdWRlcyB0aGUgY3VycmVudCBjb2xsZWN0aW9uIElEIGFzIHRoZSBmaXJzdCBlbGVtZW50XG4gICAgICAgICAgICAgY29uc3QgYW5jZXN0b3JJZHMgPSBnZXRBbmNlc3RvcklkcyhjdXJyZW50Q29sbGVjdGlvbklkKTtcbiAgICAgICAgICAgICBsZXQgZGVlcGVzdFNwZWNpZmllZEFuY2VzdG9ySWQ6IG51bWJlciB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICBcbiAgICAgICAgICAgICAvLyBJZiBubyBzcGVjaWZpYyBjb2xsZWN0aW9ucyBhcmUgc2VsZWN0ZWQgKHJlc29sdmVkQ29sbGVjdGlvbklkcyBpcyBlbXB0eSksXG4gICAgICAgICAgICAgLy8gd2UgbmVlZCB0byBidWlsZCB0aGUgZnVsbCBwYXRoIGZyb20gdGhlIHJvb3RcbiAgICAgICAgICAgICBpZiAocmVzb2x2ZWRDb2xsZWN0aW9uSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAvLyBGb3Igbm8gZmlsdGVycywgd2UgZG9uJ3Qgc2V0IGEgZGVlcGVzdFNwZWNpZmllZEFuY2VzdG9ySWRcbiAgICAgICAgICAgICAgICAgLy8gVGhpcyB3aWxsIG1ha2UgdGhlIHRyYXZlcnNhbCBnbyBhbGwgdGhlIHdheSB0byB0aGUgcm9vdFxuICAgICAgICAgICAgICAgICBkZWVwZXN0U3BlY2lmaWVkQW5jZXN0b3JJZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgLy8gSWYgdGhlIGN1cnJlbnQgY29sbGVjdGlvbiBpdHNlbGYgaXMgYSB1c2VyLXNwZWNpZmllZCBjb2xsZWN0aW9uLCBwcmlvcml0aXplIGl0XG4gICAgICAgICAgICAgZWxzZSBpZiAocmVzb2x2ZWRDb2xsZWN0aW9uSWRzLmluY2x1ZGVzKGN1cnJlbnRDb2xsZWN0aW9uSWQpKSB7XG4gICAgICAgICAgICAgICAgIGRlZXBlc3RTcGVjaWZpZWRBbmNlc3RvcklkID0gY3VycmVudENvbGxlY3Rpb25JZDtcbiAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAvLyBDaGVjayBhbmNlc3RvcnMgZnJvbSBjbG9zZXN0IHRvIGZ1cnRoZXN0XG4gICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYW5jZXN0b3JJZCBvZiBhbmNlc3Rvcklkcykge1xuICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc29sdmVkQ29sbGVjdGlvbklkcy5pbmNsdWRlcyhhbmNlc3RvcklkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgIGRlZXBlc3RTcGVjaWZpZWRBbmNlc3RvcklkID0gYW5jZXN0b3JJZDsgLy8gRm91bmQgdGhlIGRlZXBlc3QgYW5jZXN0b3IgdGhhdCBpcyBzcGVjaWZpZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsgLy8gU3RvcCBhdCB0aGUgZGVlcGVzdCBzcGVjaWZpZWQgYW5jZXN0b3JcbiAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQnVpbGQgYSBwYXRoIGZvciB0aGlzIGNvbGxlY3Rpb25cbiAgICAgICAgICAgIC8vIEZvciBjb2xsZWN0aW9ucyB3aXRoIGEgc3BlY2lmaWVkIGFuY2VzdG9yIG9yIHdoZW4gbm8gZmlsdGVycyBhcmUgc2VsZWN0ZWRcbiAgICAgICAgICAgIGlmIChkZWVwZXN0U3BlY2lmaWVkQW5jZXN0b3JJZCAhPT0gdW5kZWZpbmVkIHx8IHJlc29sdmVkQ29sbGVjdGlvbklkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgIC8vIFJlY29uc3RydWN0IHRoZSBwYXRoIHNlZ21lbnRzIGZyb20gdGhlIGN1cnJlbnQgY29sbGVjdGlvbiB1cCB0byB0aGUgcm9vdFxuICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aFNlZ21lbnRzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRUcmF2ZXJzZUlkOiBudW1iZXIgfCB1bmRlZmluZWQgPSBjdXJyZW50Q29sbGVjdGlvbklkO1xuICAgICAgICAgICAgICAgICAgY29uc3QgdGVtcFNlZ21lbnRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgICAgICAgICAgICAgICAvLyBCdWlsZCB0aGUgZnVsbCBwYXRoIGZyb20gdGhlIGN1cnJlbnQgY29sbGVjdGlvbiB1cCB0byB0aGUgcm9vdFxuICAgICAgICAgICAgICAgICAgLy8gV2hlbiBubyBmaWx0ZXJzIGFyZSBzZWxlY3RlZCwgd2UnbGwgYnVpbGQgdGhlIGNvbXBsZXRlIGhpZXJhcmNoeVxuICAgICAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnRUcmF2ZXJzZUlkICE9PSB1bmRlZmluZWQgJiYgY3VycmVudFRyYXZlcnNlSWQgIT09IDAgJiYgY3VycmVudFRyYXZlcnNlSWQgIT09IC0xICYmIGN1cnJlbnRUcmF2ZXJzZUlkICE9PSAtOTkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sbGVjdGlvbiA9IGNvbGxlY3Rpb25IaWVyYXJjaHkuZ2V0KGN1cnJlbnRUcmF2ZXJzZUlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjb2xsZWN0aW9uKSBicmVhazsgLy8gU2hvdWxkIG5vdCBoYXBwZW5cbiAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgY3VycmVudCBjb2xsZWN0aW9uJ3MgdGl0bGUgdG8gdGhlIHBhdGggc2VnbWVudHNcbiAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FuaXRpemVkVGl0bGUgPSB0aGlzLnNhbml0aXplRmlsZU5hbWUoY29sbGVjdGlvbi50aXRsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgIGlmIChzYW5pdGl6ZWRUaXRsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcFNlZ21lbnRzLnVuc2hpZnQoc2FuaXRpemVkVGl0bGUpO1xuICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIGZpbHRlcnMgYXJlIHNlbGVjdGVkLCBzdG9wIGF0IHRoZSBzcGVjaWZpZWQgYW5jZXN0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgLy8gV2hlbiBubyBmaWx0ZXJzIGFyZSBzZWxlY3RlZCwgdGhpcyBjb25kaXRpb24gaXMgbmV2ZXIgdHJ1ZSAoZGVlcGVzdFNwZWNpZmllZEFuY2VzdG9ySWQgaXMgdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzb2x2ZWRDb2xsZWN0aW9uSWRzLmxlbmd0aCA+IDAgJiYgY3VycmVudFRyYXZlcnNlSWQgPT09IGRlZXBlc3RTcGVjaWZpZWRBbmNlc3RvcklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgLy8gTW92ZSB0byBwYXJlbnQgdG8gY29udGludWUgYnVpbGRpbmcgdGhlIHBhdGggdXB3YXJkc1xuICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VHJhdmVyc2VJZCA9IGNvbGxlY3Rpb24ucGFyZW50SWQ7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHJlbGF0aXZlRm9sZGVyUGF0aFNlZ21lbnRzID0gdGVtcFNlZ21lbnRzO1xuXG4gICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgbm90aWNlIHRpdGxlIHRvIHNob3cgcGF0aFxuICAgICAgICAgICAgICAgICAgY29sbGVjdGlvblRpdGxlRm9yTm90aWNlID0gcmVsYXRpdmVGb2xkZXJQYXRoU2VnbWVudHMuam9pbignLycpO1xuXG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAvLyBJZiBubyB1c2VyLXNwZWNpZmllZCBhbmNlc3RvciBpcyBmb3VuZCAoYW5kIGN1cnJlbnQgaXMgbm90IHNwZWNpZmllZCksXG4gICAgICAgICAgICAgICAgICAvLyBwbGFjZSBpdCB1bmRlciBhbiAnVW5jYXRlZ29yaXplZCcgZm9sZGVyIHdpdGhpbiB0aGUgdGFyZ2V0IGZvbGRlci5cbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgQ29sbGVjdGlvbiBwYXRoIGRpZCBub3QgY29udGFpbiBhIHVzZXItc3BlY2lmaWVkIGFuY2VzdG9yIG9yIHdhcyBub3QgdGhlIHNwZWNpZmllZCBjb2xsZWN0aW9uIGl0c2VsZi4gUGxhY2luZyBpbiBVbmNhdGVnb3JpemVkOiBDb2xsZWN0aW9uIElEICR7Y3VycmVudENvbGxlY3Rpb25JZH1gKTtcbiAgICAgICAgICAgICAgICAgIHJlbGF0aXZlRm9sZGVyUGF0aFNlZ21lbnRzID0gWydVbmNhdGVnb3JpemVkJ107XG4gICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uVGl0bGVGb3JOb3RpY2UgPSAnVW5jYXRlZ29yaXplZCc7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRDb2xsZWN0aW9uSWQgPT09IC0xIHx8IGN1cnJlbnRDb2xsZWN0aW9uSWQgPT09IDApIHtcbiAgICAgICAgICAgICAvLyBIYW5kbGUgVW5zb3J0ZWQgYW5kIEFsbCBDb2xsZWN0aW9ucyAoc2hvdWxkIHR5cGljYWxseSBnbyB0byB0YXJnZXRGb2xkZXJQYXRoIGRpcmVjdGx5KVxuICAgICAgICAgICAgIHJlbGF0aXZlRm9sZGVyUGF0aFNlZ21lbnRzID0gW107IC8vIE5vIHN1YmZvbGRlciBuZWVkZWQgcmVsYXRpdmUgdG8gdGFyZ2V0XG4gICAgICAgICAgICAgY29sbGVjdGlvblRpdGxlRm9yTm90aWNlID0gY3VycmVudENvbGxlY3Rpb25JZCA9PT0gLTEgPyAnVW5zb3J0ZWQnIDogJ0FsbCBJdGVtcyc7XG4gICAgICAgIH0gZWxzZSBpZiAoY29sbGVjdGlvbklkID09PSAndW5jYXRlZ29yaXplZCcpIHtcbiAgICAgICAgICAgICAvLyBIYW5kbGUgaXRlbXMgd2l0aG91dCBhIGNvbGxlY3Rpb24gSUQgZXhwbGljaXRseSBncm91cGVkIGFzICd1bmNhdGVnb3JpemVkJ1xuICAgICAgICAgICAgIHJlbGF0aXZlRm9sZGVyUGF0aFNlZ21lbnRzID0gWydVbmNhdGVnb3JpemVkJ107XG4gICAgICAgICAgICAgY29sbGVjdGlvblRpdGxlRm9yTm90aWNlID0gJ1VuY2F0ZWdvcml6ZWQnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgIC8vIEZhbGxiYWNrIGZvciBjYXNlcyB3aGVyZSBjb2xsZWN0aW9uSGllcmFyY2h5IGlzIG5vdCBhdmFpbGFibGUgKHVzZXIgZGlkbid0IGZpbHRlciBieSBjb2xsZWN0aW9uKVxuICAgICAgICAgICAgIC8vIG9yIG90aGVyIHVuZXhwZWN0ZWQgSURzLiBQbGFjZSBpbiB0YXJnZXQgZm9sZGVyLlxuICAgICAgICAgICAgIHJlbGF0aXZlRm9sZGVyUGF0aFNlZ21lbnRzID0gW107XG4gICAgICAgICAgICAgY29sbGVjdGlvblRpdGxlRm9yTm90aWNlID0gJ1Vua25vd24gQ29sbGVjdGlvbic7XG4gICAgICAgICAgICAgY29uc29sZS53YXJuKGBDb3VsZCBub3QgZGV0ZXJtaW5lIGNvbGxlY3Rpb24gcGF0aCBmb3IgSUQ6ICR7Y29sbGVjdGlvbklkfS4gUGxhY2luZyBpbiB0YXJnZXQgZm9sZGVyLmApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ29uc3RydWN0IHRoZSBmdWxsIGRlc2lyZWQgZm9sZGVyIHBhdGggd2l0aGluIHRoZSB2YXVsdCBieSBqb2luaW5nIHRhcmdldCBhbmQgcmVsYXRpdmUgc2VnbWVudHNcbiAgICAgICAgY29uc3QgZnVsbERlc2lyZWRGb2xkZXJQYXRoID0gcmVsYXRpdmVGb2xkZXJQYXRoU2VnbWVudHMubGVuZ3RoID4gMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGAke3RhcmdldEZvbGRlclBhdGh9JHt0YXJnZXRGb2xkZXJQYXRoID8gJy8nIDogJyd9JHtyZWxhdGl2ZUZvbGRlclBhdGhTZWdtZW50cy5qb2luKCcvJyl9YFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHRhcmdldEZvbGRlclBhdGg7IC8vIFVzZSB0YXJnZXRGb2xkZXJQYXRoIGRpcmVjdGx5IGlmIG5vIHJlbGF0aXZlIHNlZ21lbnRzXG5cbiAgICAgICAgLy8gTWFudWFsbHkgY3JlYXRlIHRoZSBmb2xkZXIgc3RydWN0dXJlIHN0ZXAgYnkgc3RlcFxuICAgICAgICAvLyBTdGFydCBmcm9tIHRoZSB0YXJnZXRGb2xkZXJQYXRoIGFuZCBjcmVhdGUgZWFjaCBzZWdtZW50IG9mIHRoZSByZWxhdGl2ZSBwYXRoXG4gICAgICAgIGxldCBjdXJyZW50UGF0aCA9IHRhcmdldEZvbGRlclBhdGg7XG4gICAgICAgIGNvbnN0IHBhdGhTZWdtZW50c1RvQ3JlYXRlID0gcmVsYXRpdmVGb2xkZXJQYXRoU2VnbWVudHM7XG5cbiAgICAgICAgZm9yIChjb25zdCBzZWdtZW50IG9mIHBhdGhTZWdtZW50c1RvQ3JlYXRlKSB7XG4gICAgICAgICAgICAgaWYgKCFzZWdtZW50KSBjb250aW51ZTsgLy8gU2tpcCBlbXB0eSBzZWdtZW50c1xuICAgICAgICAgICAgIGN1cnJlbnRQYXRoID0gY3VycmVudFBhdGggPyBgJHtjdXJyZW50UGF0aH0vJHtzZWdtZW50fWAgOiBzZWdtZW50OyAvLyBCdWlsZCB0aGUgcGF0aCBzZWdtZW50IGJ5IHNlZ21lbnRcbiAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgLy8gY3JlYXRlRm9sZGVyU3RydWN0dXJlIG5vdyBoYW5kbGVzIGZ1bGwgcGF0aHMgYW5kIGNoZWNrcyBleGlzdGVuY2VcbiAgICAgICAgICAgICAgICAgIGF3YWl0IGNyZWF0ZUZvbGRlclN0cnVjdHVyZShhcHAsIGN1cnJlbnRQYXRoKTtcbiAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgbGV0IGVycm9yTXNnID0gJ2ZvbGRlciBjcmVhdGlvbiBmYWlsZWQnO1xuICAgICAgICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIGVycm9yTXNnID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYEZhaWxlZCB0byBjcmVhdGUvdmVyaWZ5IGZvbGRlcjogJHtjdXJyZW50UGF0aH0uIEVycm9yOiAke2Vycm9yTXNnfS5gLCAxMDAwMCk7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igd2l0aCBmb2xkZXIgb3BlcmF0aW9uOlwiLCBlcnJvcik7XG4gICAgICAgICAgICAgICAgICAvLyBTdG9wIGNyZWF0aW5nIGRlZXBlciBsZXZlbHMgZm9yIHRoaXMgcGF0aCBvbiBlcnJvclxuICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIEV4aXQgdGhlIGZvbGRlciBjcmVhdGlvbiBsb29wXG4gICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBmaW5hbCBjdXJyZW50UGF0aCBpcyB0aGUgcGF0aCB0byB0aGUgZGVlcGVzdCBzdWNjZXNzZnVsbHkgY3JlYXRlZCBmb2xkZXIgZm9yIHRoaXMgY29sbGVjdGlvbiBncm91cFxuICAgICAgICBjb25zdCBjb2xsZWN0aW9uRm9sZGVyUGF0aCA9IGN1cnJlbnRQYXRoOyAvLyBVc2UgdGhpcyBwYXRoIGZvciBzYXZpbmcgbm90ZXNcblxuICAgICAgICAvLyBQcm9jZXNzIHJhaW5kcm9wcyBpbiB0aGlzIGNvbGxlY3Rpb24gZ3JvdXBcbiAgICAgICAgZm9yIChjb25zdCByYWluZHJvcCBvZiBjb2xsZWN0aW9uUmFpbmRyb3BzKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGdlbmVyYXRlZEZpbGVuYW1lID0gdGhpcy5nZW5lcmF0ZUZpbGVOYW1lKHJhaW5kcm9wLCB1c2VSYWluZHJvcFRpdGxlRm9yRmlsZU5hbWUpO1xuICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgZGV0ZXJtaW5lZCBjb2xsZWN0aW9uRm9sZGVyUGF0aCBmb3IgdGhlIGZpbGUgcGF0aFxuICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYCR7Y29sbGVjdGlvbkZvbGRlclBhdGh9LyR7Z2VuZXJhdGVkRmlsZW5hbWV9Lm1kYDtcblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBsb2FkaW5nIG5vdGljZSB3aXRoIGN1cnJlbnQgcHJvY2Vzc2luZyBpdGVtXG4gICAgICAgICAgICAgICAgY29uc3QgcmFpbmRyb3BUaXRsZSA9IHJhaW5kcm9wLnRpdGxlIHx8ICdVbnRpdGxlZCc7XG4gICAgICAgICAgICAgICAgbG9hZGluZ05vdGljZS5zZXRNZXNzYWdlKGBQcm9jZXNzaW5nICcke3JhaW5kcm9wVGl0bGV9JyBpbiAnJHtjb2xsZWN0aW9uVGl0bGVGb3JOb3RpY2V9Jy4uLiAoJHtwcm9jZXNzZWR9LyR7dG90YWx9KWApO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZUV4aXN0cyA9IGF3YWl0IGFwcC52YXVsdC5hZGFwdGVyLmV4aXN0cyhmaWxlUGF0aCk7XG4gICAgICAgICAgICAgICAgbGV0IHByb2Nlc3NPdXRjb21lID0gJ2NyZWF0ZWQnOyAvLyAnY3JlYXRlZCcsICd1cGRhdGVkJywgJ3NraXBwZWQnLCAnZXJyb3InXG5cbiAgICAgICAgICAgICAgICBpZiAoZmlsZUV4aXN0cykge1xuICAgICAgICAgICAgICAgICAgICAvLyBJZiBmaWxlIGV4aXN0cywgY2hlY2sgdXBkYXRlIGNvbmRpdGlvbnMgYmFzZWQgb24gb3B0aW9uc1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5mZXRjaE9ubHlOZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBTa2lwcGluZyBleGlzdGluZyBmaWxlIChGZXRjaCBPbmx5IE5ldyBlbmFibGVkKTogJHtmaWxlUGF0aH1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NPdXRjb21lID0gJ3NraXBwZWQnO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMudXBkYXRlRXhpc3RpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSBVcGRhdGUgRXhpc3RpbmcgTG9naWMgLS0tXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgQ2hlY2tpbmcgZXhpc3RpbmcgZmlsZSBmb3IgdXBkYXRlOiAke2ZpbGVQYXRofWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHNob3VsZFVwZGF0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0ZpbGUgPSBhcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGZpbGVQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdGaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdDb250ZW50ID0gYXdhaXQgYXBwLnZhdWx0LmNhY2hlZFJlYWQoZXhpc3RpbmdGaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBleGlzdGluZ0NvbnRlbnQubWF0Y2goL14tLS1cXG4oW15cXHNcXFNdKj8pXFxuLS0tLyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnJvbnRtYXR0ZXJSYXcgPSBtYXRjaFsxXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzaW5nIHJlZ2V4IHRvIGZpbmQgdGhlIElEIGFuZCBsYXN0X3VwZGF0ZSBmaWVsZHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkTWF0Y2ggPSBmcm9udG1hdHRlclJhdy5tYXRjaCgvXmlkOlxccyooXFxkKykvbSk7IC8vICdtJyBmbGFnIGZvciBtdWx0aWxpbmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RVcGRhdGVNYXRjaCA9IGZyb250bWF0dGVyUmF3Lm1hdGNoKC9ebGFzdF91cGRhdGU6XFxzKiguKikvbSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nUmFpbmRyb3BJZCA9IGlkTWF0Y2ggJiYgaWRNYXRjaFsxXSA/IHBhcnNlSW50KGlkTWF0Y2hbMV0sIDEwKSA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ0xhc3RVcGRhdGUgPSBsYXN0VXBkYXRlTWF0Y2ggJiYgbGFzdFVwZGF0ZU1hdGNoWzFdID8gbmV3IERhdGUobGFzdFVwZGF0ZU1hdGNoWzFdKSA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmZXRjaGVkTGFzdFVwZGF0ZSA9IG5ldyBEYXRlKHJhaW5kcm9wLmxhc3RVcGRhdGUpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBpdCdzIHRoZSBzYW1lIHJhaW5kcm9wIGFuZCBpZiBmZXRjaGVkIGRhdGEgaXMgbmV3ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ1JhaW5kcm9wSWQgPT09IHJhaW5kcm9wLl9pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbXBhcmUgdGltZXN0YW1wcy4gQWxzbyB1cGRhdGUgaWYgZXhpc3RpbmcgdGltZXN0YW1wIGlzIGludmFsaWQgb3IgbWlzc2luZy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWV4aXN0aW5nTGFzdFVwZGF0ZSB8fCBpc05hTihleGlzdGluZ0xhc3RVcGRhdGUuZ2V0VGltZSgpKSB8fCBmZXRjaGVkTGFzdFVwZGF0ZSA+IGV4aXN0aW5nTGFzdFVwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgVXBkYXRlIG5lZWRlZCBmb3IgJHtmaWxlUGF0aH06IFJhaW5kcm9wLmlvIGRhdGEgaXMgbmV3ZXIgb3IgZXhpc3RpbmcgdGltZXN0YW1wIGludmFsaWQuYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYE5vIHVwZGF0ZSBuZWVkZWQgZm9yICR7ZmlsZVBhdGh9OiBSYWluZHJvcC5pbyBkYXRhIGlzIG5vdCBuZXdlci5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB3aWxsIGJlIGhhbmRsZWQgYXMgc2tpcHBlZCBiZWxvd1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpbGUgZXhpc3RzIGJ1dCBkb2Vzbid0IG1hdGNoIHRoaXMgcmFpbmRyb3AgSUQgLSB0cmVhdCBhcyBza2lwcGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgRmlsZSBleGlzdHMgd2l0aCBtYXRjaGluZyBuYW1lIGJ1dCBkaWZmZXJlbnQgUmFpbmRyb3AgSUQ6ICR7ZmlsZVBhdGh9IChFeGlzdGluZyBJRDogJHtleGlzdGluZ1JhaW5kcm9wSWR9LCBGZXRjaGVkIElEOiAke3JhaW5kcm9wLl9pZH0pLiBTa2lwcGluZy5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB3aWxsIGJlIGhhbmRsZWQgYXMgc2tpcHBlZCBiZWxvd1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmlsZSBleGlzdHMgYnV0IG5vIHZhbGlkIGZyb250bWF0dGVyIGZvdW5kIG9yIG1pc3NpbmcgSUQvbGFzdF91cGRhdGUgLSB0cmVhdCBhcyBza2lwcGVkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYEZpbGUgZXhpc3RzIGJ1dCBoYXMgbm8gdmFsaWQgZnJvbnRtYXR0ZXIgb3IgcmVxdWlyZWQgZmllbGRzOiAke2ZpbGVQYXRofS4gU2tpcHBpbmcuYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIHdpbGwgYmUgaGFuZGxlZCBhcyBza2lwcGVkIGJlbG93XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUGF0aCBleGlzdHMgYnV0IGlzIG5vdCBhIGZpbGUgKGUuZy4sIGEgZm9sZGVyKSAtIHRyZWF0IGFzIHNraXBwZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgUGF0aCBleGlzdHMgYnV0IGlzIG5vdCBhIGZpbGU6ICR7ZmlsZVBhdGh9LiBTa2lwcGluZy5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgd2lsbCBiZSBoYW5kbGVkIGFzIHNraXBwZWQgYmVsb3dcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChyZWFkRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciByZWFkaW5nIGV4aXN0aW5nIGZpbGUgJHtmaWxlUGF0aH06YCwgcmVhZEVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzT3V0Y29tZSA9ICdlcnJvcic7IC8vIENvdW50IGFzIGVycm9yIGlmIHJlYWRpbmcgZmFpbHNcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3VsZFVwZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NPdXRjb21lID0gJ3VwZGF0ZWQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9jZXNzT3V0Y29tZSAhPT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHVwZGF0ZSB3YXMgbm90IG5lZWRlZCBhbmQgbm8gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIHJlYWQvY2hlY2tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzT3V0Y29tZSA9ICdza2lwcGVkJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHNob3VsZFVwZGF0ZSBpcyB0cnVlLCBmbG93IGNvbnRpbnVlcyBiZWxvdyB0byBnZW5lcmF0ZSBjb250ZW50IGFuZCBvdmVyd3JpdGVcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmlsZSBleGlzdHMsIG5laXRoZXIgZmV0Y2hPbmx5TmV3IG5vciB1cGRhdGVFeGlzdGluZyBpcyB0cnVlIC0gc2tpcFxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgU2tpcHBpbmcgZXhpc3RpbmcgZmlsZTogJHtmaWxlUGF0aH1gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NPdXRjb21lID0gJ3NraXBwZWQnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIC0tLSBFbmQgRXhpc3RpbmcgRmlsZSBIYW5kbGluZyAtLS1cblxuICAgICAgICAgICAgICAgIC8vIElmIG91dGNvbWUgaXMgbm90IHNraXBwZWQgb3IgZXJyb3IgKG1lYW5pbmcgaXQncyBhIG5ldyBmaWxlIG9yIG5lZWRzIHVwZGF0ZSlcbiAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc091dGNvbWUgPT09ICdjcmVhdGVkJyB8fCBwcm9jZXNzT3V0Y29tZSA9PT0gJ3VwZGF0ZWQnKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmRUaXRsZSA9IHJhaW5kcm9wLnRpdGxlIHx8ICdVbnRpdGxlZCBSYWluZHJvcCc7XG4gICAgICAgICAgICAgICAgY29uc3QgcmROb3RlQ29udGVudCA9IHJhaW5kcm9wLm5vdGUgfHwgJyc7XG4gICAgICAgICAgICAgICAgY29uc3QgcmRFeGNlcnB0ID0gcmFpbmRyb3AuZXhjZXJwdCB8fCAnJztcbiAgICAgICAgICAgICAgICBjb25zdCByZFNvdXJjZVVybCA9IHJhaW5kcm9wLmxpbms7XG4gICAgICAgICAgICAgICAgY29uc3QgcmRDb3ZlclVybCA9IHJhaW5kcm9wLmNvdmVyIHx8ICcnO1xuXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgZnJvbnRtYXR0ZXIgb2JqZWN0IHdpdGggYWxsIHJhaW5kcm9wIG1ldGFkYXRhXG4gICAgICAgICAgICAgICAgY29uc3QgZnJvbnRtYXR0ZXJEYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge1xuICAgICAgICAgICAgICAgICAgICAvLyBCYXNpYyBtZXRhZGF0YVxuICAgICAgICAgICAgICAgICAgICBpZDogcmFpbmRyb3AuX2lkLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogcmRUaXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc291cmNlOiByZFNvdXJjZVVybCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogcmFpbmRyb3AudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZDogcmFpbmRyb3AuY3JlYXRlZCxcbiAgICAgICAgICAgICAgICAgICAgbGFzdF91cGRhdGU6IHJhaW5kcm9wLmxhc3RVcGRhdGVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEFkZCBkZXNjcmlwdGlvbiBpZiBwcmVzZW50XG4gICAgICAgICAgICAgICAgaWYgKHJkRXhjZXJwdCkge1xuICAgICAgICAgICAgICAgICAgICBmcm9udG1hdHRlckRhdGEuZGVzY3JpcHRpb24gPSByZEV4Y2VycHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEFsd2F5cyBzZXQgY29sbGVjdGlvbiBpbmZvLCBkZWZhdWx0aW5nIHRvIFVuc29ydGVkIGlmIG1pc3NpbmdcbiAgICAgICAgICAgICAgICBsZXQgY29sbGVjdGlvbkluZm8gPSB7IGlkOiAtMSwgdGl0bGU6ICdVbnNvcnRlZCcgfTtcbiAgICAgICAgICAgICAgICBpZiAocmFpbmRyb3AuY29sbGVjdGlvbj8uJGlkICYmIGNvbGxlY3Rpb25JZFRvTmFtZU1hcC5oYXMocmFpbmRyb3AuY29sbGVjdGlvbi4kaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbGxlY3Rpb25JZCA9IHJhaW5kcm9wLmNvbGxlY3Rpb24uJGlkO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2xsZWN0aW9uVGl0bGUgPSBjb2xsZWN0aW9uSWRUb05hbWVNYXAuZ2V0KGNvbGxlY3Rpb25JZCkgfHwgJ1Vua25vd24nO1xuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uSW5mbyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBjb2xsZWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogY29sbGVjdGlvblRpdGxlXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2xsZWN0aW9uSGllcmFyY2h5Lmhhcyhjb2xsZWN0aW9uSWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjSW5mbyA9IGNvbGxlY3Rpb25IaWVyYXJjaHkuZ2V0KGNvbGxlY3Rpb25JZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY0luZm8/LnBhcmVudElkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uSW5mby5wYXJlbnRfaWQgPSBjSW5mby5wYXJlbnRJZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmcm9udG1hdHRlckRhdGEuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb25JbmZvO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgYW5kIGFkZCB0YWdzXG4gICAgICAgICAgICAgICAgbGV0IGNvbWJpbmVkRk1UYWdzOiBzdHJpbmdbXSA9IFsuLi5zZXR0aW5nc0ZNVGFnc107XG4gICAgICAgICAgICAgICAgaWYgKHJhaW5kcm9wLnRhZ3MgJiYgQXJyYXkuaXNBcnJheShyYWluZHJvcC50YWdzKSkge1xuICAgICAgICAgICAgICAgICAgICByYWluZHJvcC50YWdzLmZvckVhY2goKHRhZzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmltbWVkVGFnID0gdGFnLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmltbWVkVGFnICYmICFjb21iaW5lZEZNVGFncy5pbmNsdWRlcyh0cmltbWVkVGFnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbWJpbmVkRk1UYWdzLnB1c2godHJpbW1lZFRhZyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBTYW5pdGl6ZSBhbGwgdGFncyBmb3IgWUFNTCBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICAgICAgY29uc3Qgc2FuaXRpemVkVGFncyA9IGNvbWJpbmVkRk1UYWdzLm1hcCh0YWcgPT4gXG4gICAgICAgICAgICAgICAgICAgIHRhZy5yZXBsYWNlKC8gL2csIFwiX1wiKVxuICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW15cXHdcXHUwMEMwLVxcdTAwRkZcXHUwMTAwLVxcdTAxN0ZcXHUwMTgwLVxcdTAyNEZcXHUxRTAwLVxcdTFFRkZcXC8tXSsvZywgJycpXG4gICAgICAgICAgICAgICAgKS5maWx0ZXIodGFnID0+IHRhZy5sZW5ndGggPiAwKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBmcm9udG1hdHRlckRhdGEudGFncyA9IHNhbml0aXplZFRhZ3M7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gQWRkIGJhbm5lci9jb3ZlciBpbWFnZSBpZiBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICBpZiAocmRDb3ZlclVybCkge1xuICAgICAgICAgICAgICAgICAgICBmcm9udG1hdHRlckRhdGFbdGhpcy5zZXR0aW5ncy5iYW5uZXJGaWVsZE5hbWVdID0gcmRDb3ZlclVybDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgdGhlIG5vdGUgY29udGVudCAoc2VwYXJhdGUgZnJvbSBmcm9udG1hdHRlcilcbiAgICAgICAgICAgICAgICBsZXQgbm90ZUNvbnRlbnQgPSAnJztcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBBZGQgY292ZXIgaW1hZ2UgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgaWYgKHJkQ292ZXJVcmwpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWx0VGV4dCA9IHRoaXMuc2FuaXRpemVGaWxlTmFtZShyZFRpdGxlID09PSAnVW50aXRsZWQgUmFpbmRyb3AnID8gJ0NvdmVyIEltYWdlJyA6IHJkVGl0bGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvXFwubWQkL2ksICcnKTtcbiAgICAgICAgICAgICAgICAgICAgbm90ZUNvbnRlbnQgKz0gYCFbJHthbHRUZXh0fV0oJHtyZENvdmVyVXJsfSlcXG5cXG5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBub3RlQ29udGVudCArPSBgIyAke3JkVGl0bGV9XFxuXFxuYDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBBZGQgZGVzY3JpcHRpb24gaWYgcHJlc2VudCAob3V0c2lkZSBmcm9udG1hdHRlcilcbiAgICAgICAgICAgICAgICBpZiAocmRFeGNlcnB0ICYmICFyZEV4Y2VycHQuaW5jbHVkZXMoJ1xcbicpKSB7IC8vIE9ubHkgYWRkIGFzIGJvZHkgaWYgbm90IG11bHRpbGluZSAoYWxyZWFkeSBpbiBmcm9udG1hdHRlcilcbiAgICAgICAgICAgICAgICAgICAgIG5vdGVDb250ZW50ICs9IGAjIyBEZXNjcmlwdGlvblxcbiR7cmRFeGNlcnB0fVxcblxcbmA7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHJkTm90ZUNvbnRlbnQpIG5vdGVDb250ZW50ICs9IGAjIyBOb3Rlc1xcbiR7cmROb3RlQ29udGVudH1cXG5cXG5gO1xuXG4gICAgICAgICAgICAgICAgaWYgKHJhaW5kcm9wLmhpZ2hsaWdodHMgJiYgQXJyYXkuaXNBcnJheShyYWluZHJvcC5oaWdobGlnaHRzKSAmJiByYWluZHJvcC5oaWdobGlnaHRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbm90ZUNvbnRlbnQgKz0gJyMjIEhpZ2hsaWdodHNcXG4nO1xuICAgICAgICAgICAgICAgICAgICByYWluZHJvcC5oaWdobGlnaHRzLmZvckVhY2goKGhpZ2hsaWdodCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpZ2hsaWdodC50ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm90ZUNvbnRlbnQgKz0gYC0gJHtoaWdobGlnaHQudGV4dC5yZXBsYWNlKC9yXFxufHJ8bi9nLCAnICcpfVxcbmA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhpZ2hsaWdodC5ub3RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vdGVDb250ZW50ICs9IGAgICpOb3RlOiogJHtoaWdobGlnaHQubm90ZS5yZXBsYWNlKC9yXFxufHJ8bi9nLCAnICcpfVxcbmA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgbm90ZUNvbnRlbnQgKz0gJ1xcbic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEdlbmVyYXRlIHByb3Blcmx5IGZvcm1hdHRlZCBhbmQgZXNjYXBlZCBZQU1MIGZyb250bWF0dGVyXG4gICAgICAgICAgICAgICAgY29uc3QgZnJvbnRtYXR0ZXIgPSBjcmVhdGVZYW1sRnJvbnRtYXR0ZXIoZnJvbnRtYXR0ZXJEYXRhKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBDb21iaW5lIGZyb250bWF0dGVyIGFuZCBub3RlIGNvbnRlbnRcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlQ29udGVudCA9IGZyb250bWF0dGVyICsgbm90ZUNvbnRlbnQ7XG5cbiAgICAgICAgICAgICAgICBhd2FpdCBhcHAudmF1bHQuY3JlYXRlKGZpbGVQYXRoLCBmaWxlQ29udGVudCk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gSW5jcmVtZW50IGFwcHJvcHJpYXRlIGNvdW50ZXIgYmFzZWQgb24gb3V0Y29tZVxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc091dGNvbWUgPT09ICdjcmVhdGVkJykge1xuICAgICAgICAgICAgICAgIGNyZWF0ZWRDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByb2Nlc3NPdXRjb21lID09PSAndXBkYXRlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9jZXNzT3V0Y29tZSA9PT0gJ3NraXBwZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHNraXBwZWRDb3VudCsrO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvY2Vzc091dGNvbWUgPT09ICdlcnJvcicpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JDb3VudCsrOyAvLyBDb3VudCBhcyBlcnJvciBpZiBwcm9jZXNzaW5nIGZhaWxlZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwcm9jZXNzZWQrKztcblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBsb2FkaW5nIG5vdGljZSBhZnRlciBwcm9jZXNzaW5nIChjcmVhdGUsIHVwZGF0ZSwgb3Igc2tpcClcbiAgICAgICAgICAgICAgICBjb25zdCByYWluZHJvcFRpdGxlQWZ0ZXJQcm9jZXNzaW5nID0gcmFpbmRyb3AudGl0bGUgfHwgJ1VudGl0bGVkJzsgLy8gUmUtZ2V0IHRpdGxlXG4gICAgICAgICAgICAgICAgbGV0IHN0YXR1c1RleHQgPSAnJztcbiAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc091dGNvbWUgPT09ICdjcmVhdGVkJykgc3RhdHVzVGV4dCA9ICdDcmVhdGVkJztcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChwcm9jZXNzT3V0Y29tZSA9PT0gJ3VwZGF0ZWQnKSBzdGF0dXNUZXh0ID0gJ1VwZGF0ZWQnO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHByb2Nlc3NPdXRjb21lID09PSAnc2tpcHBlZCcpIHN0YXR1c1RleHQgPSAnU2tpcHBlZCc7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocHJvY2Vzc091dGNvbWUgPT09ICdlcnJvcicpIHN0YXR1c1RleHQgPSAnRXJyb3InO1xuXG4gICAgICAgICAgICAgICAgbG9hZGluZ05vdGljZS5zZXRNZXNzYWdlKGAke3N0YXR1c1RleHR9ICcke3JhaW5kcm9wVGl0bGVBZnRlclByb2Nlc3Npbmd9JyBpbiAnJHtjb2xsZWN0aW9uVGl0bGVGb3JOb3RpY2V9Jy4uLiAoJHtwcm9jZXNzZWR9LyR7dG90YWx9KWApO1xuXG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGVycm9yQ291bnQrKztcbiAgICAgICAgICAgICAgICBwcm9jZXNzZWQrKztcbiAgICAgICAgICAgICAgICBsZXQgcHJvY2Vzc0Vycm9yTXNnID0gJ0FuIHVua25vd24gZXJyb3Igb2NjdXJyZWQnO1xuICAgICAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSBwcm9jZXNzRXJyb3JNc2cgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBlcnJvciA9PT0gJ3N0cmluZycpIHByb2Nlc3NFcnJvck1zZyA9IGVycm9yO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgcmFpbmRyb3BUaXRsZUZvckVycm9yID0gcmFpbmRyb3A/LnRpdGxlIHx8ICdhbiB1bmtub3duIHJhaW5kcm9wJztcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIGZpbGU6JywgcHJvY2Vzc0Vycm9yTXNnLCBlcnJvciwgcmFpbmRyb3ApO1xuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBsb2FkaW5nIG5vdGljZSBvbiBlcnJvclxuICAgICAgICAgICAgICAgIGxvYWRpbmdOb3RpY2Uuc2V0TWVzc2FnZShgRXJyb3IgcHJvY2Vzc2luZyAnJHtyYWluZHJvcFRpdGxlRm9yRXJyb3J9JyBpbiAnJHtjb2xsZWN0aW9uVGl0bGVGb3JOb3RpY2V9Jy4uLiAoJHtwcm9jZXNzZWR9LyR7dG90YWx9KWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgbG9hZGluZ05vdGljZS5oaWRlKCk7IC8vIERpc21pc3MgbG9hZGluZyBub3RpY2UgYWZ0ZXIgcHJvY2Vzc2luZ1xuXG4gICAgbGV0IHN1bW1hcnkgPSBgJHtjcmVhdGVkQ291bnR9IG5vdGVzIGNyZWF0ZWQuYDtcbiAgICBpZiAodXBkYXRlZENvdW50ID4gMCkgc3VtbWFyeSArPSBgICR7dXBkYXRlZENvdW50fSB1cGRhdGVkLmA7XG4gICAgaWYgKHNraXBwZWRDb3VudCA+IDApIHN1bW1hcnkgKz0gYCAke3NraXBwZWRDb3VudH0gc2tpcHBlZCAoYWxyZWFkeSBleGlzdCkuYDtcbiAgICBpZiAoZXJyb3JDb3VudCA+IDApIHN1bW1hcnkgKz0gYCAke2Vycm9yQ291bnR9IGVycm9ycy5gO1xuICAgIG5ldyBOb3RpY2Uoc3VtbWFyeSwgNzAwMCk7XG4gICAgY29uc29sZS5sb2coYFJhaW5kcm9wIHByb2Nlc3NpbmcgY29tcGxldGUuIENyZWF0ZWQ6ICR7Y3JlYXRlZENvdW50fSwgVXBkYXRlZDogJHt1cGRhdGVkQ291bnR9LCBTa2lwcGVkOiAke3NraXBwZWRDb3VudH0sIEVycm9yczogJHtlcnJvckNvdW50fWApO1xuICB9XG5cbiAgLy8gVGhlIHVwZGF0ZVJpYmJvbkljb24gbWV0aG9kIGlzIGFscmVhZHkgZGVmaW5lZCBhdCBsaW5lIH4zNjBcbn1cblxuY2xhc3MgUmFpbmRyb3BGZXRjaE1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBwbHVnaW46IFJhaW5kcm9wVG9PYnNpZGlhbjtcbiAgdmF1bHRQYXRoOiBzdHJpbmc7XG4gIGNvbGxlY3Rpb25zOiBzdHJpbmcgPSAnJztcbiAgYXBpRmlsdGVyVGFnczogc3RyaW5nID0gJyc7XG4gIGluY2x1ZGVTdWJjb2xsZWN0aW9uczogYm9vbGVhbiA9IGZhbHNlO1xuICBhcHBlbmRUYWdzVG9Ob3Rlczogc3RyaW5nID0gJyc7XG4gIHVzZVJhaW5kcm9wVGl0bGVGb3JGaWxlTmFtZTogYm9vbGVhbiA9IHRydWU7XG4gIHRhZ01hdGNoVHlwZTogVGFnTWF0Y2hUeXBlID0gVGFnTWF0Y2hUeXBlcy5BTEw7XG4gIGZpbHRlclR5cGU6IEZpbHRlclR5cGUgPSBGaWx0ZXJUeXBlcy5BTEw7XG4gIGZldGNoT25seU5ldzogYm9vbGVhbiA9IGZhbHNlO1xuICB1cGRhdGVFeGlzdGluZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFJhaW5kcm9wVG9PYnNpZGlhbikge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy52YXVsdFBhdGggPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWZhdWx0VmF1bHRMb2NhdGlvbjsgLy8gSW5pdGlhbGl6ZSB3aXRoIGRlZmF1bHQgc2V0dGluZ1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdNYWtlIEl0IFJhaW4gT3B0aW9ucycgfSk7XG5cbiAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnRmV0Y2ggQ3JpdGVyaWEnIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgLnNldE5hbWUoJ0NvbGxlY3Rpb25zIChjb21tYS1zZXBhcmF0ZWQgbmFtZXMgb3IgSURzKScpXG4gICAgICAuc2V0RGVzYygnRW50ZXIgY29sbGVjdGlvbiBuYW1lcyBvciBJRHMsIHNlcGFyYXRlZCBieSBjb21tYXMuIExlYXZlIGJsYW5rIHRvIGZldGNoIGZyb20gYWxsIGNvbGxlY3Rpb25zICh1bmxlc3MgdGFncyBiZWxvdyBhcmUgc3BlY2lmaWVkKS4nKVxuICAgICAgLmFkZFRleHQoKHRleHQ6IFRleHRDb21wb25lbnQpID0+IHtcbiAgICAgICAgdGV4dC5zZXRQbGFjZWhvbGRlcignRW50ZXIgQ29sbGVjdGlvbiBJRCBvciBOYW1lIG9yIGxlYXZlIGJsYW5rIGZvciBhbGwnKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLmNvbGxlY3Rpb25zKVxuICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWU6IHN0cmluZykgPT4geyB0aGlzLmNvbGxlY3Rpb25zID0gdmFsdWU7IH0pO1xuICAgICAgfSk7XG4gICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgLnNldE5hbWUoJ0ZpbHRlciBieSBUYWdzIChjb21tYS1zZXBhcmF0ZWQpJylcbiAgICAgIC5zZXREZXNjKCdGaWx0ZXIgcmFpbmRyb3BzIGJ5IHRhZ3MuJylcbiAgICAgIC5hZGRUZXh0KCh0ZXh0OiBUZXh0Q29tcG9uZW50KSA9PiB7XG4gICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoJ2UuZy4sIGFydGljbGUsIHByb2plY3QteCcpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuYXBpRmlsdGVyVGFncylcbiAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlOiBzdHJpbmcpID0+IHsgdGhpcy5hcGlGaWx0ZXJUYWdzID0gdmFsdWU7IH0pO1xuICAgICAgfSk7XG4gICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgLnNldE5hbWUoJ1RhZyBNYXRjaCBUeXBlJylcbiAgICAgIC5zZXREZXNjKCdTaG91bGQgcmFpbmRyb3BzIG1hdGNoIEFMTCBzcGVjaWZpZWQgdGFncyBvciBBTlkgb2YgdGhlbT8nKVxuICAgICAgLmFkZERyb3Bkb3duKChkcm9wZG93bikgPT4ge1xuICAgICAgICBkcm9wZG93blxuICAgICAgICAgIC5hZGRPcHRpb24oJ2FsbCcsICdNYXRjaCBBTEwgdGFncyAoQU5EKScpXG4gICAgICAgICAgLmFkZE9wdGlvbignYW55JywgJ01hdGNoIEFOWSB0YWcgKE9SKScpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMudGFnTWF0Y2hUeXBlKVxuICAgICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRhZ01hdGNoVHlwZSA9IHZhbHVlIGFzICdhbGwnIHwgJ2FueSc7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAuc2V0TmFtZSgnSW5jbHVkZSBTdWJjb2xsZWN0aW9ucycpXG4gICAgICAuc2V0RGVzYygnSWYgZmlsdGVyaW5nIGJ5IENvbGxlY3Rpb24gSURzIG9yIE5hbWVzLCBhbHNvIGluY2x1ZGUgaXRlbXMgZnJvbSB0aGVpciBzdWJjb2xsZWN0aW9ucy4nKVxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlOiBUb2dnbGVDb21wb25lbnQpID0+IHtcbiAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHRoaXMuaW5jbHVkZVN1YmNvbGxlY3Rpb25zKVxuICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWU6IGJvb2xlYW4pID0+IHsgdGhpcy5pbmNsdWRlU3ViY29sbGVjdGlvbnMgPSB2YWx1ZTsgfSk7XG4gICAgICB9KTtcblxuICAgIC8vIEFkZCB0eXBlIGZpbHRlciBkcm9wZG93blxuICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgIC5zZXROYW1lKCdGaWx0ZXIgYnkgVHlwZScpXG4gICAgICAuc2V0RGVzYygnU2VsZWN0IHRoZSB0eXBlIG9mIHJhaW5kcm9wcyB0byBmZXRjaC4nKVxuICAgICAgLmFkZERyb3Bkb3duKChkcm9wZG93bikgPT4ge1xuICAgICAgICBkcm9wZG93blxuICAgICAgICAgIC5hZGRPcHRpb24oJ2FsbCcsICdBbGwgVHlwZXMnKVxuICAgICAgICAgIC5hZGRPcHRpb24oJ2xpbmsnLCAnTGlua3MnKVxuICAgICAgICAgIC5hZGRPcHRpb24oJ2FydGljbGUnLCAnQXJ0aWNsZXMnKVxuICAgICAgICAgIC5hZGRPcHRpb24oJ2ltYWdlJywgJ0ltYWdlcycpXG4gICAgICAgICAgLmFkZE9wdGlvbigndmlkZW8nLCAnVmlkZW9zJylcbiAgICAgICAgICAuYWRkT3B0aW9uKCdkb2N1bWVudCcsICdEb2N1bWVudHMnKVxuICAgICAgICAgIC5hZGRPcHRpb24oJ2F1ZGlvJywgJ0F1ZGlvJylcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5maWx0ZXJUeXBlKVxuICAgICAgICAgIC5vbkNoYW5nZSh2YWx1ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZpbHRlclR5cGUgPSB2YWx1ZSBhcyAnbGluaycgfCAnYXJ0aWNsZScgfCAnaW1hZ2UnIHwgJ3ZpZGVvJyB8ICdkb2N1bWVudCcgfCAnYXVkaW8nIHwgJ2FsbCc7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDMnLCB7IHRleHQ6ICdOb3RlIE9wdGlvbnMnIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgLnNldE5hbWUoJ1ZhdWx0IEZvbGRlciAoT3B0aW9uYWwpJylcbiAgICAgIC5zZXREZXNjKCdUYXJnZXQgZm9sZGVyIGZvciBub3Rlcy4gTGVhdmUgYmxhbmsgZm9yIHZhdWx0IHJvb3Qgb3IgZGVmYXVsdCBzZXR0aW5nLicpXG4gICAgICAuYWRkVGV4dCgodGV4dDogVGV4dENvbXBvbmVudCkgPT4ge1xuICAgICAgICB0ZXh0LnNldFBsYWNlaG9sZGVyKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlZmF1bHRWYXVsdExvY2F0aW9uIHx8ICdWYXVsdCBSb290JylcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy52YXVsdFBhdGgpXG4gICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZTogc3RyaW5nKSA9PiB7IHRoaXMudmF1bHRQYXRoID0gdmFsdWUudHJpbSgpOyB9KTtcbiAgICAgIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgLnNldE5hbWUoJ0FwcGVuZCBUYWdzIHRvIE5vdGUgRnJvbnRtYXR0ZXIgKGNvbW1hLXNlcGFyYXRlZCknKVxuICAgICAgLnNldERlc2MoJ0FkZGl0aW9uYWwgdGFncyB0byBhZGQgdG8gdGhlIFlBTUwgZnJvbnRtYXR0ZXIgb2YgZWFjaCBjcmVhdGVkIG5vdGUuJylcbiAgICAgIC5hZGRUZXh0KCh0ZXh0OiBUZXh0Q29tcG9uZW50KSA9PiB7XG4gICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoJ2UuZy4sICNpbXBvcnRlZC9yYWluZHJvcCcpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMuYXBwZW5kVGFnc1RvTm90ZXMpXG4gICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZTogc3RyaW5nKSA9PiB7IHRoaXMuYXBwZW5kVGFnc1RvTm90ZXMgPSB2YWx1ZTsgfSk7XG4gICAgICB9KTtcbiAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAuc2V0TmFtZSgnVXNlIFJhaW5kcm9wIFRpdGxlIGZvciBGaWxlIE5hbWUnKVxuICAgICAgLnNldERlc2MoJ1VzZSB0aXRsZSAodmlhIHRlbXBsYXRlKSBmb3IgZmlsZW5hbWVzPyBJZiBvZmYsIHVzZXMgUmFpbmRyb3AgSUQuJylcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZTogVG9nZ2xlQ29tcG9uZW50KSA9PiB7XG4gICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnVzZVJhaW5kcm9wVGl0bGVGb3JGaWxlTmFtZSlcbiAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlOiBib29sZWFuKSA9PiB7IHRoaXMudXNlUmFpbmRyb3BUaXRsZUZvckZpbGVOYW1lID0gdmFsdWU7IH0pO1xuICAgICAgfSk7XG5cbiAgICAvLyBBZGQgZmV0Y2ggb25seSBuZXcgdG9nZ2xlIHRvIG1vZGFsXG4gICAgY29uc3QgZmV0Y2hPbmx5TmV3U2V0dGluZyA9IG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgIC5zZXROYW1lKCdGZXRjaCBvbmx5IG5ldyBpdGVtcycpXG4gICAgICAuc2V0RGVzYygnSWYgdGhlIHRhcmdldCBmb2xkZXIgaXMgbm90IGVtcHR5LCBvbmx5IGZldGNoIHJhaW5kcm9wcyB0aGF0IGhhdmUgbm90IGJlZW4gaW1wb3J0ZWQgYmVmb3JlLicpXG4gICAgICAuYWRkVG9nZ2xlKCh0b2dnbGU6IFRvZ2dsZUNvbXBvbmVudCkgPT4ge1xuICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy5mZXRjaE9ubHlOZXcpXG4gICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZTogYm9vbGVhbikgPT4geyB0aGlzLmZldGNoT25seU5ldyA9IHZhbHVlOyB9KTtcbiAgICAgIH0pO1xuXG4gICAgLy8gQWRkIHVwZGF0ZSBleGlzdGluZyB0b2dnbGUgdG8gbW9kYWxcbiAgICBjb25zdCB1cGRhdGVFeGlzdGluZ1NldHRpbmcgPSBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAuc2V0TmFtZSgnVXBkYXRlIGV4aXN0aW5nIG5vdGVzJylcbiAgICAgIC5zZXREZXNjKCdJZiBhIG5vdGUgd2l0aCB0aGUgc2FtZSBuYW1lIGV4aXN0cywgdXBkYXRlIGl0cyBjb250ZW50IGlmIHRoZSBzb3VyY2UgcmFpbmRyb3AgaGFzIGNoYW5nZWQuJylcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZTogVG9nZ2xlQ29tcG9uZW50KSA9PiB7XG4gICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnVwZGF0ZUV4aXN0aW5nKVxuICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRXhpc3RpbmcgPSB2YWx1ZTtcbiAgICAgICAgICAgIC8vIERpc2FibGUgRmV0Y2ggb25seSBuZXcgdG9nZ2xlIGlmIFVwZGF0ZSBleGlzdGluZyBpcyBlbmFibGVkXG4gICAgICAgICAgICBmZXRjaE9ubHlOZXdTZXR0aW5nLnNldERpc2FibGVkKHZhbHVlKTtcbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAvLyBJZiBVcGRhdGUgZXhpc3RpbmcgaXMgZW5hYmxlZCwgZW5zdXJlIEZldGNoIG9ubHkgbmV3IGlzIGZhbHNlIGFuZCB1cGRhdGUgaXRzIHRvZ2dsZVxuICAgICAgICAgICAgICB0aGlzLmZldGNoT25seU5ldyA9IGZhbHNlO1xuICAgICAgICAgICAgICAoZmV0Y2hPbmx5TmV3U2V0dGluZy5jb250cm9sRWwucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJykgYXMgSFRNTElucHV0RWxlbWVudCkhLmNoZWNrZWQgPSBmYWxzZTsgLy8gVXBkYXRlIHRoZSB2aXN1YWwgc3RhdGVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgLmFkZEJ1dHRvbigoYnRuOiBCdXR0b25Db21wb25lbnQpID0+IHtcbiAgICAgICAgYnRuLnNldEJ1dHRvblRleHQoJ0ZldGNoIFJhaW5kcm9wcycpXG4gICAgICAgICAgLnNldEN0YSgpXG4gICAgICAgICAgLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uczogTW9kYWxGZXRjaE9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgIHZhdWx0UGF0aDogdGhpcy52YXVsdFBhdGggfHwgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICBjb2xsZWN0aW9uczogdGhpcy5jb2xsZWN0aW9ucyxcbiAgICAgICAgICAgICAgYXBpRmlsdGVyVGFnczogdGhpcy5hcGlGaWx0ZXJUYWdzLFxuICAgICAgICAgICAgICBpbmNsdWRlU3ViY29sbGVjdGlvbnM6IHRoaXMuaW5jbHVkZVN1YmNvbGxlY3Rpb25zLFxuICAgICAgICAgICAgICBhcHBlbmRUYWdzVG9Ob3RlczogdGhpcy5hcHBlbmRUYWdzVG9Ob3RlcyxcbiAgICAgICAgICAgICAgdXNlUmFpbmRyb3BUaXRsZUZvckZpbGVOYW1lOiB0aGlzLnVzZVJhaW5kcm9wVGl0bGVGb3JGaWxlTmFtZSxcbiAgICAgICAgICAgICAgdGFnTWF0Y2hUeXBlOiB0aGlzLnRhZ01hdGNoVHlwZSxcbiAgICAgICAgICAgICAgZmlsdGVyVHlwZTogdGhpcy5maWx0ZXJUeXBlLFxuICAgICAgICAgICAgICBmZXRjaE9ubHlOZXc6IHRoaXMuZmV0Y2hPbmx5TmV3LFxuICAgICAgICAgICAgICB1cGRhdGVFeGlzdGluZzogdGhpcy51cGRhdGVFeGlzdGluZyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5mZXRjaFJhaW5kcm9wcyhvcHRpb25zKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAuYWRkQnV0dG9uKChidG46IEJ1dHRvbkNvbXBvbmVudCkgPT4ge1xuICAgICAgICBidG4uc2V0QnV0dG9uVGV4dCgnQ2FuY2VsJylcbiAgICAgICAgLm9uQ2xpY2soKCkgPT4geyB0aGlzLmNsb3NlKCk7IH0pO1xuICAgICAgfSk7XG4gIH1cbiAgb25DbG9zZSgpIHsgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7IGNvbnRlbnRFbC5lbXB0eSgpOyB9XG59XG5cbmNsYXNzIFJhaW5kcm9wVG9PYnNpZGlhblNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgcGx1Z2luOiBSYWluZHJvcFRvT2JzaWRpYW47XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogUmFpbmRyb3BUb09ic2lkaWFuKSB7XG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICB9XG5cbiAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaW1nJywgeyBhdHRyOiB7IHNyYzogXCJodHRwczovL2kuaWJiLmNvL0hUeDdUbmJOL21ha2VpdHJhaW4ucG5nXCIsIHdpZHRoOiBcIjc1MFwiIH0gfSk7XG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnSW1wb3J0IHlvdXIgUmFpbmRyb3AuaW8gYm9va21hcmtzIGludG8geW91ciBPYnNpZGlhbiB2YXVsdCB3aXRoIGVhc2UuJyB9KTtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgncCcpLmNyZWF0ZUVsKCdhJywgeyB0ZXh0OiAnVmlzaXQgUmFpbmRyb3AuaW8gd2Vic2l0ZScsIGhyZWY6ICdodHRwczovL3JhaW5kcm9wLmlvJywgYXR0cjogeyB0YXJnZXQ6ICdfYmxhbmsnLCByZWw6ICdub29wZW5lciBub3JlZmVycmVyJyB9IH0pO1xuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdocicpO1xuXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnQVBJIENvbmZpZ3VyYXRpb24nIH0pO1xuICAgIGNvbnN0IGFwaURlc2MgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoeyBjbHM6ICdzZXR0aW5nLWl0ZW0tZGVzY3JpcHRpb24nIH0pO1xuICAgIGFwaURlc2MuY3JlYXRlU3Bhbih7IHRleHQ6ICdZb3UgbmVlZCB0byBjcmVhdGUgYSBUZXN0IFRva2VuIGZyb20geW91ciAnfSk7XG4gICAgYXBpRGVzYy5jcmVhdGVFbCgnYScsIHsgdGV4dDogJ1JhaW5kcm9wLmlvIEFwcHMgc2V0dGluZ3MgcGFnZScsIGhyZWY6ICdodHRwczovL2FwcC5yYWluZHJvcC5pby9zZXR0aW5ncy9pbnRlZ3JhdGlvbnMnLCBhdHRyOiB7IHRhcmdldDogJ19ibGFuaycsIHJlbDogJ25vb3BlbmVyIG5vcmVmZXJyZXInIH0gfSk7XG4gICAgYXBpRGVzYy5jcmVhdGVTcGFuKHsgdGV4dDogJy4nfSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKCdSYWluZHJvcC5pbyBBUEkgVG9rZW4nKVxuICAgICAgLnNldERlc2MoJ1lvdSBuZWVkIHRvIGNyZWF0ZSBhIFRlc3QgVG9rZW4gZnJvbSB5b3VyIFJhaW5kcm9wLmlvIEFwcHMgc2V0dGluZ3MgcGFnZSAoaHR0cHM6Ly9hcHAucmFpbmRyb3AuaW8vc2V0dGluZ3MvaW50ZWdyYXRpb25zKS4nKVxuICAgICAgLmFkZFRleHQoKHRleHQ6IFRleHRDb21wb25lbnQpID0+IHtcbiAgICAgICAgdGV4dC5zZXRQbGFjZWhvbGRlcignRW50ZXIgeW91ciB0b2tlbicpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnJhaW5kcm9wQXBpVG9rZW4pXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yYWluZHJvcEFwaVRva2VuID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAuYWRkQnV0dG9uKChidXR0b246IEJ1dHRvbkNvbXBvbmVudCkgPT4ge1xuICAgICAgICBidXR0b24uc2V0QnV0dG9uVGV4dCgnVmVyaWZ5IFRva2VuJylcbiAgICAgICAgICAuc2V0Q3RhKClcbiAgICAgICAgICAub25DbGljaygoKSA9PiB0aGlzLnZlcmlmeUFwaVRva2VuKCkpO1xuICAgICAgfSk7XG5cbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaHInKTtcblxuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ0dlbmVyYWwgU2V0dGluZ3MnIH0pO1xuXG4gICAgLy8gQWRkIHNldHRpbmcgZm9yIHJpYmJvbiBpY29uIHZpc2liaWxpdHlcbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKCdTaG93IFJpYmJvbiBJY29uJylcbiAgICAgIC5zZXREZXNjKCdUb2dnbGUgdG8gc2hvdyBvciBoaWRlIHRoZSBNYWtlIEl0IFJhaW4gcmliYm9uIGljb24uJylcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZTogVG9nZ2xlQ29tcG9uZW50KSA9PiB7XG4gICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5zaG93UmliYm9uSWNvbilcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zaG93UmliYm9uSWNvbiA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAvLyBVcGRhdGUgcmliYm9uIGljb24gZGlzcGxheSBpbW1lZGlhdGVseVxuICAgICAgICAgICAgdGhpcy5wbHVnaW4udXBkYXRlUmliYm9uSWNvbigpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICBjb250YWluZXJFbC5jcmVhdGVFbCgnaHInKTtcblxuICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMycsIHsgdGV4dDogJ05vdGUgU3RvcmFnZSAmIE5hbWluZycgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKCdEZWZhdWx0IFZhdWx0IExvY2F0aW9uIGZvciBOb3RlcycpXG4gICAgICAuc2V0RGVzYygnRGVmYXVsdCBmb2xkZXIgdG8gc2F2ZSBub3RlcyBpZiBub3Qgc3BlY2lmaWVkIGluIHRoZSBmZXRjaCBvcHRpb25zIG1vZGFsLiBMZWF2ZSBibGFuayBmb3IgdmF1bHQgcm9vdC4nKVxuICAgICAgLmFkZFRleHQoKHRleHQ6IFRleHRDb21wb25lbnQpID0+IHtcbiAgICAgICAgdGV4dC5zZXRQbGFjZWhvbGRlcih0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWZhdWx0VmF1bHRMb2NhdGlvbiB8fCAnVmF1bHQgUm9vdCcpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlZmF1bHRWYXVsdExvY2F0aW9uKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVmYXVsdFZhdWx0TG9jYXRpb24gPSB2YWx1ZS50cmltKCk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdwJywgeyBjbHM6ICdzZXR0aW5nLWl0ZW0tZGVzY3JpcHRpb24nLCB0ZXh0OiAnQ29uZmlndXJlIGhvdyBmaWxlbmFtZXMgYXJlIGdlbmVyYXRlZCB3aGVuIFwiVXNlIFJhaW5kcm9wIFRpdGxlXCIgaXMgZW5hYmxlZCBpbiB0aGUgZmV0Y2ggb3B0aW9ucyBtb2RhbC4gVXNlcyBIYW5kbGViYXJzLWxpa2Ugc3ludGF4LicgfSk7XG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnRmlsZSBOYW1lIFRlbXBsYXRlJylcbiAgICAgIC5zZXREZXNjKCdQbGFjZWhvbGRlcnM6IHt7dGl0bGV9fSwge3tpZH19LCB7e2NvbGxlY3Rpb25UaXRsZX19LCB7e2RhdGV9fSAoWVlZWS1NTS1ERCkuJylcbiAgICAgIC5hZGRUZXh0KCh0ZXh0OiBUZXh0Q29tcG9uZW50KSA9PiB7XG4gICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoJ3t7dGl0bGV9fScpXG4gICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZmlsZU5hbWVUZW1wbGF0ZSlcbiAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5maWxlTmFtZVRlbXBsYXRlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgLy8gQWRkIHNldHRpbmcgZm9yIGN1c3RvbSBiYW5uZXIgZnJvbnRtYXR0ZXIgZmllbGQgbmFtZVxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ0Jhbm5lciBGcm9udG1hdHRlciBGaWVsZCBOYW1lJylcbiAgICAgIC5zZXREZXNjKCdDdXN0b21pemUgdGhlIGZyb250bWF0dGVyIGZpZWxkIG5hbWUgdXNlZCBmb3IgdGhlIGJhbm5lciBpbWFnZS4gRGVmYXVsdDogYmFubmVyJylcbiAgICAgIC5hZGRUZXh0KCh0ZXh0OiBUZXh0Q29tcG9uZW50KSA9PiB7XG4gICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoJ2Jhbm5lcicpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmJhbm5lckZpZWxkTmFtZSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmJhbm5lckZpZWxkTmFtZSA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2hyJyk7XG5cbiAgICAgY29uc3QgZm9vdGVyID0gY29udGFpbmVyRWwuY3JlYXRlRGl2KHsgY2xzOiAnc2V0dGluZy1mb290ZXInIH0pO1xuICAgICBmb290ZXIuY3JlYXRlRWwoJ3AnLCB7IHRleHQ6ICdOZWVkIGhlbHAgY29uZmlndXJpbmcgb3IgdXNpbmcgdGhlIHBsdWdpbj8gQ2hlY2sgdGhlIFJFQURNRS4nIH0pO1xuICAgICBmb290ZXIuY3JlYXRlRWwoJ2EnLCB7IHRleHQ6ICdQbHVnaW4gR2l0SHViIFJlcG9zaXRvcnknLCBocmVmOiAnaHR0cHM6Ly9naXRodWIuY29tL2Zyb3N0bXV0ZS9tYWtlLWl0LXJhaW4nLCBhdHRyOiB7IHRhcmdldDogJ19ibGFuaycsIHJlbDogJ25vb3BlbmVyIG5vcmVmZXJyZXInIH0gfSk7XG4gIH1cblxuICBhc3luYyB2ZXJpZnlBcGlUb2tlbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB7IHJhaW5kcm9wQXBpVG9rZW4gfSA9IHRoaXMucGx1Z2luLnNldHRpbmdzO1xuXG4gICAgaWYgKCFyYWluZHJvcEFwaVRva2VuKSB7XG4gICAgICBuZXcgTm90aWNlKCdQbGVhc2UgZW50ZXIgYW4gQVBJIHRva2VuIGZpcnN0LicsIDUwMDApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIG5ldyBOb3RpY2UoJ1ZlcmlmeWluZyBBUEkgdG9rZW4uLi4nLCAzMDAwKTtcblxuICAgIGNvbnN0IGJhc2VBcGlVcmwgPSAnaHR0cHM6Ly9hcGkucmFpbmRyb3AuaW8vcmVzdC92MSc7XG4gICAgY29uc3QgZmV0Y2hPcHRpb25zOiBSZXF1ZXN0SW5pdCA9IHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7cmFpbmRyb3BBcGlUb2tlbn1gLFxuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICB9XG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBVc2UgYSBzaW1wbGUgZW5kcG9pbnQgdG8gdGVzdCB0aGUgdG9rZW4sIGUuZy4sIGZldGNoaW5nIHVzZXIgaW5mb1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHtcbiAgICAgICAgdXJsOiBgJHtiYXNlQXBpVXJsfS91c2VyYCxcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczogZmV0Y2hPcHRpb25zLmhlYWRlcnMgYXMgUmVjb3JkPHN0cmluZywgc3RyaW5nPlxuICAgICAgfSk7XG5cbiAgICAgIGxldCBkYXRhO1xuICAgICAgaWYgKHR5cGVvZiByZXNwb25zZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGF0YSA9IHJlc3BvbnNlO1xuICAgICAgfVxuXG4gICAgICBpZiAoZGF0YS5yZXN1bHQpIHtcbiAgICAgICAgbmV3IE5vdGljZSgnQVBJIFRva2VuIGlzIHZhbGlkIScsIDUwMDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSGFuZGxlIHNwZWNpZmljIEFQSSBlcnJvciBtZXNzYWdlcyBpZiBhdmFpbGFibGVcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZGF0YS5tZXNzYWdlIHx8IGRhdGEuZXJyb3IgfHwgJ0ludmFsaWQgQVBJIHRva2VuIG9yIGNvbm5lY3Rpb24gaXNzdWUuJztcbiAgICAgICAgbmV3IE5vdGljZShgQVBJIFRva2VuIHZlcmlmaWNhdGlvbiBmYWlsZWQ6ICR7ZXJyb3JNZXNzYWdlfWAsIDEwMDAwKTtcbiAgICAgICAgY29uc29sZS5lcnJvcignQVBJIFRva2VuIHZlcmlmaWNhdGlvbiBmYWlsZWQ6JywgZGF0YSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxldCBlcnJvck1zZyA9ICdBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgdG9rZW4gdmVyaWZpY2F0aW9uLic7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikgZXJyb3JNc2cgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgZWxzZSBpZiAodHlwZW9mIGVycm9yID09PSAnc3RyaW5nJykgZXJyb3JNc2cgPSBlcnJvcjtcbiAgICAgIG5ldyBOb3RpY2UoYEFQSSBUb2tlbiB2ZXJpZmljYXRpb24gZmFpbGVkOiAke2Vycm9yTXNnfWAsIDEwMDAwKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHZlcmlmeWluZyBBUEkgdG9rZW46JywgZXJyb3IpO1xuICAgIH1cbiAgfVxufVxuXG4iLCAiaW1wb3J0IHsgQXBwIH0gZnJvbSAnb2JzaWRpYW4nO1xuXG4vKipcbiAqIEZpbGUgVXRpbGl0aWVzIGZvciBNYWtlIEl0IFJhaW5cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBmaWxlIGFuZCBmb2xkZXIgbWFuaXB1bGF0aW9uIHV0aWxpdGllcyBkZXNpZ25lZCBmb3IgT2JzaWRpYW4ncyB2YXVsdCBzeXN0ZW0uXG4gKiBUaGVzZSBmdW5jdGlvbnMgaW1wbGVtZW50IGEgZnVuY3Rpb25hbCBwcm9ncmFtbWluZyBhcHByb2FjaCBhbmQgaGFuZGxlIGNvbW1vbiBvcGVyYXRpb25zIGxpa2U6XG4gKiAtIENoZWNraW5nIGlmIGZpbGVzL2ZvbGRlcnMgZXhpc3RcbiAqIC0gQ3JlYXRpbmcgZm9sZGVycyBhbmQgZm9sZGVyIHN0cnVjdHVyZXNcbiAqIC0gU2FuaXRpemluZyBmaWxlIG5hbWVzIGZvciBjb21wYXRpYmlsaXR5XG4gKiBcbiAqIEFsbCBmdW5jdGlvbnMgYXJlIGRlc2lnbmVkIHRvIGJlIHB1cmUgYW5kIHByZWRpY3RhYmxlLCB3aXRoIGNsZWFyIGVycm9yIGhhbmRsaW5nIGFuZCBkZXNjcmlwdGl2ZSBcbiAqIG5hbWVzIHRoYXQgZm9sbG93IHRoZSB2ZXJiLW5vdW4gcGF0dGVybiBmb3IgYmV0dGVyIHJlYWRhYmlsaXR5LlxuICovXG5cbi8qKlxuICogQ2hlY2tzIGlmIGEgcGF0aCBleGlzdHMgaW4gdGhlIE9ic2lkaWFuIHZhdWx0XG4gKiBcbiAqIEBwYXJhbSBhcHAgLSBUaGUgT2JzaWRpYW4gQXBwIGluc3RhbmNlXG4gKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIGNoZWNrIChjYW4gYmUgYSBmaWxlIG9yIGZvbGRlcilcbiAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRydWUgaWYgdGhlIHBhdGggZXhpc3RzLCBmYWxzZSBvdGhlcndpc2VcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpZiAoYXdhaXQgZG9lc1BhdGhFeGlzdChhcHAsIFwiTm90ZXMvUmFpbmRyb3BzXCIpKSB7XG4gKiAgIC8vIFBhdGggZXhpc3RzLCBwcm9jZWVkLi4uXG4gKiB9XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRvZXNQYXRoRXhpc3QoYXBwOiBBcHAsIHBhdGg6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiBhcHAudmF1bHQuYWRhcHRlci5leGlzdHMocGF0aCk7XG59XG5cbi8qKlxuICogQ2hlY2tzIGlmIGEgcGF0aCBpcyBhIGZvbGRlciBpbiB0aGUgT2JzaWRpYW4gdmF1bHRcbiAqIEBwYXJhbSBhcHAgLSBUaGUgT2JzaWRpYW4gQXBwIGluc3RhbmNlXG4gKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIGNoZWNrXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBwYXRoIGlzIGEgZm9sZGVyLCBmYWxzZSBvdGhlcndpc2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzUGF0aEFGb2xkZXIoYXBwOiBBcHAsIHBhdGg6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHN0YXQgPSBhd2FpdCBhcHAudmF1bHQuYWRhcHRlci5zdGF0KHBhdGgpO1xuICAgIHJldHVybiBzdGF0Py50eXBlID09PSAnZm9sZGVyJztcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgZm9sZGVyIGlmIGl0IGRvZXNuJ3QgZXhpc3QgYWxyZWFkeVxuICogQHBhcmFtIGFwcCAtIFRoZSBPYnNpZGlhbiBBcHAgaW5zdGFuY2VcbiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggd2hlcmUgdG8gY3JlYXRlIHRoZSBmb2xkZXJcbiAqIEByZXR1cm5zIFRydWUgaWYgZm9sZGVyIHdhcyBjcmVhdGVkIG9yIGFscmVhZHkgZXhpc3RzLCB0aHJvd3MgZXJyb3Igb3RoZXJ3aXNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVGb2xkZXIoYXBwOiBBcHAsIHBhdGg6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGRvZXNGb2xkZXJFeGlzdCA9IGF3YWl0IGRvZXNQYXRoRXhpc3QoYXBwLCBwYXRoKTtcbiAgICBcbiAgICBpZiAoZG9lc0ZvbGRlckV4aXN0KSB7XG4gICAgICAgIGNvbnN0IGlzRm9sZGVyID0gYXdhaXQgaXNQYXRoQUZvbGRlcihhcHAsIHBhdGgpO1xuICAgICAgICBpZiAoaXNGb2xkZXIpIHJldHVybiB0cnVlO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFBhdGggZXhpc3RzIGJ1dCBpcyBub3QgYSBmb2xkZXI6ICR7cGF0aH1gKTtcbiAgICB9XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgYXBwLnZhdWx0LmNyZWF0ZUZvbGRlcihwYXRoKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBjcmVhdGUgZm9sZGVyIGF0ICR7cGF0aH06ICR7ZXJyb3JNZXNzYWdlfWApO1xuICAgIH1cbn1cblxuLyoqXG4gKiBTYW5pdGl6ZXMgYSBmaWxlIG5hbWUgYnkgcmVtb3ZpbmcgaW52YWxpZCBjaGFyYWN0ZXJzXG4gKiBAcGFyYW0gZmlsZU5hbWUgLSBUaGUgcmF3IGZpbGUgbmFtZSB0byBzYW5pdGl6ZVxuICogQHJldHVybnMgQSBzYW5pdGl6ZWQgZmlsZSBuYW1lIHNhZmUgZm9yIGZpbGUgc3lzdGVtc1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2FuaXRpemVGaWxlTmFtZShmaWxlTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBpbnZhbGlkQ2hhcnMgPSAvWy9cXFxcOio/XCI8PnwjJSZ7fSQhQCdgKz1dL2c7XG4gICAgY29uc3QgcmVwbGFjZW1lbnQgPSAnJztcbiAgICBcbiAgICAvLyBVc2UgbWVhbmluZ2Z1bCB2YXJpYWJsZSBuYW1lcyB3aXRoIGF1eGlsaWFyeSB2ZXJic1xuICAgIGNvbnN0IGlzU3RyaW5nRW1wdHkgPSAhZmlsZU5hbWUgfHwgZmlsZU5hbWUudHJpbSgpID09PSAnJztcbiAgICBpZiAoaXNTdHJpbmdFbXB0eSkgcmV0dXJuIFwiVW5uYW1lZF9SYWluZHJvcFwiO1xuICAgIFxuICAgIGNvbnN0IHNhbml0aXplZE5hbWUgPSBmaWxlTmFtZS5yZXBsYWNlKGludmFsaWRDaGFycywgcmVwbGFjZW1lbnQpLnRyaW0oKTtcbiAgICBjb25zdCBpc1Nhbml0aXplZEVtcHR5ID0gIXNhbml0aXplZE5hbWU7XG4gICAgXG4gICAgLy8gRW5mb3JjZSBtYXhpbXVtIGxlbmd0aCB0byBhdm9pZCBvdmVybHkgbG9uZyBmaWxlIG5hbWVzXG4gICAgY29uc3QgbWF4TGVuZ3RoID0gMjAwO1xuICAgIHJldHVybiAoaXNTYW5pdGl6ZWRFbXB0eSA/IFwiVW5uYW1lZF9SYWluZHJvcFwiIDogc2FuaXRpemVkTmFtZSkuc3Vic3RyaW5nKDAsIG1heExlbmd0aCk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIGZvbGRlciBzdHJ1Y3R1cmUgcmVjdXJzaXZlbHksIGNyZWF0aW5nIHBhcmVudCBmb2xkZXJzIGFzIG5lZWRlZFxuICogQHBhcmFtIGFwcCAtIFRoZSBPYnNpZGlhbiBBcHAgaW5zdGFuY2VcbiAqIEBwYXJhbSBmdWxsUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gY3JlYXRlXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBmb2xkZXIgc3RydWN0dXJlIHdhcyBjcmVhdGVkIHN1Y2Nlc3NmdWxseVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlRm9sZGVyU3RydWN0dXJlKGFwcDogQXBwLCBmdWxsUGF0aDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgaWYgKCFmdWxsUGF0aCB8fCBmdWxsUGF0aCA9PT0gJy8nKSByZXR1cm4gdHJ1ZTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBkb2VzRXhpc3QgPSBhd2FpdCBkb2VzUGF0aEV4aXN0KGFwcCwgZnVsbFBhdGgpO1xuICAgICAgICBpZiAoZG9lc0V4aXN0KSB7XG4gICAgICAgICAgICBjb25zdCBpc0ZvbGRlciA9IGF3YWl0IGlzUGF0aEFGb2xkZXIoYXBwLCBmdWxsUGF0aCk7XG4gICAgICAgICAgICBpZiAoaXNGb2xkZXIpIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQYXRoIGV4aXN0cyBidXQgaXMgbm90IGEgZm9sZGVyOiAke2Z1bGxQYXRofWApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgcGFyZW50IGRpcmVjdG9yeSBmaXJzdFxuICAgICAgICBjb25zdCBsYXN0U2xhc2hJbmRleCA9IGZ1bGxQYXRoLmxhc3RJbmRleE9mKCcvJyk7XG4gICAgICAgIGlmIChsYXN0U2xhc2hJbmRleCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IHBhcmVudFBhdGggPSBmdWxsUGF0aC5zdWJzdHJpbmcoMCwgbGFzdFNsYXNoSW5kZXgpO1xuICAgICAgICAgICAgYXdhaXQgY3JlYXRlRm9sZGVyU3RydWN0dXJlKGFwcCwgcGFyZW50UGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIE5vdyBjcmVhdGUgdGhpcyBmb2xkZXJcbiAgICAgICAgYXdhaXQgY3JlYXRlRm9sZGVyKGFwcCwgZnVsbFBhdGgpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcik7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZS92ZXJpZnkgZm9sZGVyOiAke2Z1bGxQYXRofS4gRXJyb3I6ICR7ZXJyb3JNZXNzYWdlfS5gKTtcbiAgICB9XG59XG4iLCAiaW1wb3J0IHsgQXBwLCByZXF1ZXN0IH0gZnJvbSAnb2JzaWRpYW4nO1xuXG4vKipcbiAqIEFQSSBVdGlsaXRpZXMgZm9yIE1ha2UgSXQgUmFpblxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBcbiAqIFRoaXMgbW9kdWxlIHByb3ZpZGVzIHV0aWxpdGllcyBmb3IgaW50ZXJhY3Rpbmcgd2l0aCB0aGUgUmFpbmRyb3AuaW8gQVBJLCBmb2N1c2luZyBvbjpcbiAqIC0gUmF0ZSBsaW1pdGluZyB0byByZXNwZWN0IEFQSSB1c2FnZSBjb25zdHJhaW50c1xuICogLSBBdXRoZW50aWNhdGlvbiBhbmQgcmVxdWVzdCBoYW5kbGluZ1xuICogLSBFcnJvciBoYW5kbGluZyBhbmQgcmV0cnkgbG9naWNcbiAqIC0gUmVzcG9uc2UgcGFyc2luZyBhbmQgZGF0YSBleHRyYWN0aW9uXG4gKiBcbiAqIFRoZXNlIHV0aWxpdGllcyBmb2xsb3cgZnVuY3Rpb25hbCBwcm9ncmFtbWluZyBwcmluY2lwbGVzLCB1c2luZyBjbG9zdXJlcyBmb3Igc3RhdGUgbWFuYWdlbWVudFxuICogYW5kIHB1cmUgZnVuY3Rpb25zIGZvciBkYXRhIHRyYW5zZm9ybWF0aW9uLiBFYWNoIGZ1bmN0aW9uIGlzIGRlc2lnbmVkIHRvIGhhbmRsZSBhIHNwZWNpZmljXG4gKiBjb25jZXJuLCBwcm9tb3Rpbmcgc2VwYXJhdGlvbiBvZiByZXNwb25zaWJpbGl0aWVzIGFuZCBjb2RlIHJldXNhYmlsaXR5LlxuICogXG4gKiBUaGUgQVBJIHV0aWxpdGllcyBhcmUgcGFydGljdWxhcmx5IGltcG9ydGFudCBmb3IgZW5zdXJpbmcgcmVsaWFibGUgY29tbXVuaWNhdGlvbiB3aXRoXG4gKiBSYWluZHJvcC5pbydzIHNlcnZlcnMsIGV2ZW4gaW4gY2FzZXMgb2YgdGVtcG9yYXJ5IG5ldHdvcmsgaXNzdWVzIG9yIHJhdGUgbGltaXRpbmcuXG4gKi9cblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIHJhdGUgbGltaXRlciBmdW5jdGlvbmFsaXR5XG4gKiBcbiAqIFByb3ZpZGVzIG1ldGhvZHMgdG8gbWFuYWdlIEFQSSByZXF1ZXN0IHBhY2luZyB0byBhdm9pZCBoaXR0aW5nIHJhdGUgbGltaXRzLlxuICogSW1wbGVtZW50ZWQgdXNpbmcgYSBmdW5jdGlvbmFsIGNsb3N1cmUgcGF0dGVybiB0byBtYWludGFpbiBpbnRlcm5hbCBzdGF0ZS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSYXRlTGltaXRlciB7XG4gICAgY2hlY2tMaW1pdDogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgICByZXNldENvdW50ZXI6ICgpID0+IHZvaWQ7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIHJhdGUgbGltaXRlciB0aGF0IG1hbmFnZXMgQVBJIHJlcXVlc3QgcGFjaW5nXG4gKiBVc2VzIGEgZnVuY3Rpb25hbCBjbG9zdXJlIGFwcHJvYWNoIHRvIG1haW50YWluIHN0YXRlXG4gKiBcbiAqIEBwYXJhbSBtYXhSZXF1ZXN0c1Blck1pbnV0ZSAtIE1heGltdW0gbnVtYmVyIG9mIHJlcXVlc3RzIGFsbG93ZWQgcGVyIG1pbnV0ZVxuICogQHBhcmFtIGRlbGF5QmV0d2VlblJlcXVlc3RzIC0gTWlsbGlzZWNvbmRzIHRvIHdhaXQgYmV0d2VlbiByZXF1ZXN0c1xuICogQHJldHVybnMgQSByYXRlIGxpbWl0ZXIgb2JqZWN0IHdpdGggbWV0aG9kcyB0byBjaGVjayBsaW1pdHMgYW5kIHJlc2V0IGNvdW50ZXJzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSYXRlTGltaXRlcihtYXhSZXF1ZXN0c1Blck1pbnV0ZSA9IDYwLCBkZWxheUJldHdlZW5SZXF1ZXN0cyA9IDMwMCk6IFJhdGVMaW1pdGVyIHtcbiAgICBsZXQgcmVxdWVzdENvdW50ID0gMDtcbiAgICBsZXQgcmVzZXRUaW1lID0gRGF0ZS5ub3coKSArIDYwMDAwOyAvLyAxIG1pbnV0ZSB3aW5kb3dcbiAgICBcbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgd2UncmUgd2l0aGluIHJhdGUgbGltaXRzIGFuZCBoYW5kbGVzIGRlbGF5cyBpZiBuZWVkZWRcbiAgICAgKi9cbiAgICBjb25zdCBjaGVja0xpbWl0ID0gYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBcbiAgICAgICAgLy8gUmVzZXQgY291bnRlciBpZiB3ZSdyZSBpbiBhIG5ldyB0aW1lIHdpbmRvd1xuICAgICAgICBpZiAobm93ID4gcmVzZXRUaW1lKSB7XG4gICAgICAgICAgICByZXNldFRpbWUgPSBub3cgKyA2MDAwMDtcbiAgICAgICAgICAgIHJlcXVlc3RDb3VudCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIElmIHdlJ3ZlIGhpdCB0aGUgcmF0ZSBsaW1pdCwgd2FpdCBmb3IgdGhlIHJlc2V0XG4gICAgICAgIGlmIChyZXF1ZXN0Q291bnQgPj0gbWF4UmVxdWVzdHNQZXJNaW51dGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHdhaXRUaW1lID0gcmVzZXRUaW1lIC0gbm93O1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFJhdGUgbGltaXQgcmVhY2hlZC4gV2FpdGluZyAke3dhaXRUaW1lfW1zIGJlZm9yZSBuZXh0IHJlcXVlc3QuYCk7XG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgd2FpdFRpbWUpKTtcbiAgICAgICAgICAgIC8vIFJlc2V0IGFmdGVyIHdhaXRpbmdcbiAgICAgICAgICAgIHJlc2V0VGltZSA9IERhdGUubm93KCkgKyA2MDAwMDtcbiAgICAgICAgICAgIHJlcXVlc3RDb3VudCA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBTdGFuZGFyZCBkZWxheSBiZXR3ZWVuIHJlcXVlc3RzIHRvIGJlIHBvbGl0ZSB0byB0aGUgQVBJXG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXlCZXR3ZWVuUmVxdWVzdHMpKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gSW5jcmVtZW50IGNvdW50ZXIgYWZ0ZXIgbWFraW5nIGEgcmVxdWVzdFxuICAgICAgICByZXF1ZXN0Q291bnQrKztcbiAgICB9O1xuICAgIFxuICAgIC8qKlxuICAgICAqIFJlc2V0cyB0aGUgY291bnRlciB3aGVuIGhpdHRpbmcgYSByYXRlIGxpbWl0XG4gICAgICovXG4gICAgY29uc3QgcmVzZXRDb3VudGVyID0gKCk6IHZvaWQgPT4ge1xuICAgICAgICByZXNldFRpbWUgPSBEYXRlLm5vdygpICsgNjAwMDA7XG4gICAgICAgIHJlcXVlc3RDb3VudCA9IDA7XG4gICAgICAgIGNvbnNvbGUubG9nKCdSYXRlIGxpbWl0ZXIgY291bnRlciByZXNldC4nKTtcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiB7IGNoZWNrTGltaXQsIHJlc2V0Q291bnRlciB9O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYXV0aGVudGljYXRlZCByZXF1ZXN0IG9wdGlvbnMgZm9yIFJhaW5kcm9wLmlvIEFQSVxuICogXG4gKiBAcGFyYW0gYXBpVG9rZW4gLSBUaGUgUmFpbmRyb3AuaW8gQVBJIHRva2VuXG4gKiBAcmV0dXJucyBSZXF1ZXN0IG9wdGlvbnMgd2l0aCBwcm9wZXIgaGVhZGVyc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQXV0aGVudGljYXRlZFJlcXVlc3RPcHRpb25zKGFwaVRva2VuOiBzdHJpbmcpOiBSZXF1ZXN0SW5pdCB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7YXBpVG9rZW59YCxcbiAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8qKlxuICogQnVpbGRzIGEgVVJMIGZvciB0aGUgUmFpbmRyb3AuaW8gY29sbGVjdGlvbiBBUElcbiAqIFxuICogQHBhcmFtIGNvbGxlY3Rpb25JZCAtIFRoZSBJRCBvZiB0aGUgY29sbGVjdGlvbiB0byBmZXRjaFxuICogQHJldHVybnMgVGhlIGZ1bGwgQVBJIFVSTCBmb3IgdGhlIGNvbGxlY3Rpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQ29sbGVjdGlvbkFwaVVybChjb2xsZWN0aW9uSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBodHRwczovL2FwaS5yYWluZHJvcC5pby9yZXN0L3YxL2NvbGxlY3Rpb24vJHtjb2xsZWN0aW9uSWR9YDtcbn1cblxuLyoqXG4gKiBQYXJzZXMgdGhlIEFQSSByZXNwb25zZSBiYXNlZCBvbiBpdHMgdHlwZVxuICogXG4gKiBAcGFyYW0gcmVzcG9uc2UgLSBUaGUgcmVzcG9uc2UgZnJvbSB0aGUgQVBJXG4gKiBAcmV0dXJucyBQYXJzZWQgSlNPTiBkYXRhXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUFwaVJlc3BvbnNlKHJlc3BvbnNlOiBzdHJpbmcgfCBvYmplY3QpOiBhbnkge1xuICAgIGlmICh0eXBlb2YgcmVzcG9uc2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG4vKipcbiAqIEhhbmRsZXMgcmVxdWVzdCBlcnJvcnMsIGVzcGVjaWFsbHkgZm9yIHJhdGUgbGltaXRpbmdcbiAqIFxuICogQHBhcmFtIGVycm9yIC0gVGhlIGVycm9yIHRoYXQgb2NjdXJyZWRcbiAqIEBwYXJhbSByYXRlTGltaXRlciAtIFRoZSByYXRlIGxpbWl0ZXIgaW5zdGFuY2VcbiAqIEBwYXJhbSBhdHRlbXB0TnVtYmVyIC0gQ3VycmVudCBhdHRlbXB0IG51bWJlclxuICogQHBhcmFtIG1heFJldHJpZXMgLSBNYXhpbXVtIG51bWJlciBvZiByZXRyaWVzXG4gKiBAcGFyYW0gZGVsYXlCZXR3ZWVuUmV0cmllcyAtIERlbGF5IGJldHdlZW4gcmV0cnkgYXR0ZW1wdHNcbiAqIEByZXR1cm5zIFRydWUgaWYgZXJyb3Igd2FzIGhhbmRsZWQgYW5kIHJldHJ5IHNob3VsZCBoYXBwZW4sIGZhbHNlIG90aGVyd2lzZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlUmVxdWVzdEVycm9yKFxuICAgIGVycm9yOiBhbnksIFxuICAgIHJhdGVMaW1pdGVyOiBSYXRlTGltaXRlciwgXG4gICAgYXR0ZW1wdE51bWJlcjogbnVtYmVyLCBcbiAgICBtYXhSZXRyaWVzOiBudW1iZXIsXG4gICAgZGVsYXlCZXR3ZWVuUmV0cmllczogbnVtYmVyXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBpc0xhc3RBdHRlbXB0ID0gYXR0ZW1wdE51bWJlciA+PSBtYXhSZXRyaWVzIC0gMTtcbiAgICBcbiAgICAvLyBIYW5kbGUgcmF0ZSBsaW1pdGluZyAoSFRUUCA0MjkpXG4gICAgaWYgKGVycm9yLnN0YXR1cyA9PT0gNDI5IHx8IChlcnJvci5tZXNzYWdlICYmIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ3JhdGUgbGltaXQnKSkpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1JhdGUgbGltaXQgaGl0LCByZXNldHRpbmcgY291bnRlciBhbmQgd2FpdGluZy4uLicpO1xuICAgICAgICByYXRlTGltaXRlci5yZXNldENvdW50ZXIoKTtcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIGRlbGF5QmV0d2VlblJldHJpZXMgKiAyKSk7IC8vIExvbmdlciB3YWl0IGZvciByYXRlIGxpbWl0c1xuICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gV2UgaGFuZGxlZCB0aGUgZXJyb3IsIGNvbnRpbnVlIHdpdGggcmV0cnlcbiAgICB9XG4gICAgXG4gICAgLy8gRm9yIG90aGVyIGVycm9ycywgbG9nIGFuZCBwb3NzaWJseSByZXRyeVxuICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGluIEFQSSByZXF1ZXN0IChhdHRlbXB0ICR7YXR0ZW1wdE51bWJlciArIDF9LyR7bWF4UmV0cmllc30pOmAsIGVycm9yKTtcbiAgICBcbiAgICBpZiAoIWlzTGFzdEF0dGVtcHQpIHtcbiAgICAgICAgLy8gV2FpdCBhbmQgcmV0cnkgZm9yIG5vbi1yYXRlIGxpbWl0IGVycm9yc1xuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZGVsYXlCZXR3ZWVuUmV0cmllcykpO1xuICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gQ29udGludWUgd2l0aCByZXRyeVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmFsc2U7IC8vIERvbid0IHJldHJ5IGlmIGl0J3MgdGhlIGxhc3QgYXR0ZW1wdFxufVxuXG4vKipcbiAqIEZldGNoZXMgZGF0YSBmcm9tIGFuIEFQSSB3aXRoIHJldHJ5IGxvZ2ljIGFuZCByYXRlIGxpbWl0aW5nXG4gKiBTdXBwb3J0cyB0d28gY2FsbCBwYXR0ZXJucyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eTpcbiAqIDEuIChhcHAsIHVybCwgcmVxdWVzdE9wdGlvbnMsIHJhdGVMaW1pdGVyLCBtYXhSZXRyaWVzPywgZGVsYXlCZXR3ZWVuUmV0cmllcz8pXG4gKiAyLiAodXJsLCByZXF1ZXN0T3B0aW9ucywgcmF0ZUxpbWl0ZXIsIG1heFJldHJpZXM/KVxuICogXG4gKiBAcGFyYW0gYXBwT3JVcmwgLSBFaXRoZXIgYW4gQXBwIGluc3RhbmNlIG9yIHRoZSBVUkwgc3RyaW5nXG4gKiBAcGFyYW0gdXJsT3JPcHRpb25zIC0gRWl0aGVyIHRoZSBVUkwgc3RyaW5nIG9yIHJlcXVlc3Qgb3B0aW9uc1xuICogQHBhcmFtIG9wdGlvbnNPclJhdGVMaW1pdGVyIC0gRWl0aGVyIHJlcXVlc3Qgb3B0aW9ucyBvciByYXRlIGxpbWl0ZXJcbiAqIEBwYXJhbSByYXRlTGltaXRlck9yTWF4UmV0cmllcyAtIEVpdGhlciByYXRlIGxpbWl0ZXIgb3IgbWF4IHJldHJpZXNcbiAqIEBwYXJhbSBtYXhSZXRyaWVzIC0gTWF4aW11bSBudW1iZXIgb2YgcmV0cnkgYXR0ZW1wdHNcbiAqIEBwYXJhbSBkZWxheUJldHdlZW5SZXRyaWVzIC0gRGVsYXkgYmV0d2VlbiByZXRyeSBhdHRlbXB0cyBpbiBtaWxsaXNlY29uZHNcbiAqIEByZXR1cm5zIFRoZSBwYXJzZWQgQVBJIHJlc3BvbnNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaFdpdGhSZXRyeShcbiAgICBhcHBPclVybDogQXBwIHwgc3RyaW5nLCBcbiAgICB1cmxPck9wdGlvbnM6IHN0cmluZyB8IFJlcXVlc3RJbml0LCBcbiAgICBvcHRpb25zT3JSYXRlTGltaXRlcj86IFJlcXVlc3RJbml0IHwgUmF0ZUxpbWl0ZXIsXG4gICAgcmF0ZUxpbWl0ZXJPck1heFJldHJpZXM/OiBSYXRlTGltaXRlciB8IG51bWJlcixcbiAgICBtYXhSZXRyaWVzOiBudW1iZXIgPSAzLFxuICAgIGRlbGF5QmV0d2VlblJldHJpZXM6IG51bWJlciA9IDEwMDBcbik6IFByb21pc2U8YW55PiB7XG4gICAgLy8gTm9ybWFsaXplIHBhcmFtZXRlcnMgdG8gaGFuZGxlIGJvdGggY2FsbGluZyBwYXR0ZXJuc1xuICAgIGxldCBhcHA6IEFwcCB8IHVuZGVmaW5lZDtcbiAgICBsZXQgdXJsOiBzdHJpbmc7XG4gICAgbGV0IHJlcXVlc3RPcHRpb25zOiBSZXF1ZXN0SW5pdDtcbiAgICBsZXQgcmF0ZUxpbWl0ZXI6IFJhdGVMaW1pdGVyO1xuICAgIFxuICAgIGlmICh0eXBlb2YgYXBwT3JVcmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vIE9sZCBwYXR0ZXJuOiAodXJsLCBvcHRpb25zLCByYXRlTGltaXRlciwgbWF4UmV0cmllcz8pXG4gICAgICAgIHVybCA9IGFwcE9yVXJsO1xuICAgICAgICByZXF1ZXN0T3B0aW9ucyA9IHVybE9yT3B0aW9ucyBhcyBSZXF1ZXN0SW5pdDtcbiAgICAgICAgcmF0ZUxpbWl0ZXIgPSBvcHRpb25zT3JSYXRlTGltaXRlciBhcyBSYXRlTGltaXRlcjtcbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGlmIG1heFJldHJpZXMgd2FzIHByb3ZpZGVkXG4gICAgICAgIGlmICh0eXBlb2YgcmF0ZUxpbWl0ZXJPck1heFJldHJpZXMgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBtYXhSZXRyaWVzID0gcmF0ZUxpbWl0ZXJPck1heFJldHJpZXM7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBOZXcgcGF0dGVybjogKGFwcCwgdXJsLCBvcHRpb25zLCByYXRlTGltaXRlciwgbWF4UmV0cmllcz8sIGRlbGF5PylcbiAgICAgICAgYXBwID0gYXBwT3JVcmw7XG4gICAgICAgIHVybCA9IHVybE9yT3B0aW9ucyBhcyBzdHJpbmc7XG4gICAgICAgIHJlcXVlc3RPcHRpb25zID0gb3B0aW9uc09yUmF0ZUxpbWl0ZXIgYXMgUmVxdWVzdEluaXQ7XG4gICAgICAgIHJhdGVMaW1pdGVyID0gcmF0ZUxpbWl0ZXJPck1heFJldHJpZXMgYXMgUmF0ZUxpbWl0ZXI7XG4gICAgfVxuICAgIFxuICAgIC8vIFRyeSB1cCB0byBtYXhSZXRyaWVzIHRpbWVzXG4gICAgZm9yIChsZXQgYXR0ZW1wdE51bWJlciA9IDA7IGF0dGVtcHROdW1iZXIgPCBtYXhSZXRyaWVzOyBhdHRlbXB0TnVtYmVyKyspIHtcbiAgICAgICAgY29uc3QgaXNMYXN0QXR0ZW1wdCA9IGF0dGVtcHROdW1iZXIgPT09IG1heFJldHJpZXMgLSAxO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIENoZWNrIHJhdGUgbGltaXQgYmVmb3JlIG1ha2luZyByZXF1ZXN0XG4gICAgICAgICAgICBhd2FpdCByYXRlTGltaXRlci5jaGVja0xpbWl0KCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFVzZSBPYnNpZGlhbidzIHJlcXVlc3QgQVBJIGZvciBjb25zaXN0ZW50IGJlaGF2aW9yIGFjcm9zcyBwbGF0Zm9ybXNcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgbWV0aG9kOiByZXF1ZXN0T3B0aW9ucy5tZXRob2QgfHwgJ0dFVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogcmVxdWVzdE9wdGlvbnMuaGVhZGVycyBhcyBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+LFxuICAgICAgICAgICAgICAgIGJvZHk6IHJlcXVlc3RPcHRpb25zLmJvZHkgYXMgc3RyaW5nIHwgQXJyYXlCdWZmZXIgfCB1bmRlZmluZWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBQYXJzZSBhbmQgcmV0dXJuIHRoZSByZXNwb25zZVxuICAgICAgICAgICAgcmV0dXJuIHBhcnNlQXBpUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBIYW5kbGUgcmF0ZSBsaW1pdGluZyBhbmQgcmV0cnkgbG9naWNcbiAgICAgICAgICAgIGlmICghYXdhaXQgaGFuZGxlUmVxdWVzdEVycm9yKGVycm9yLCByYXRlTGltaXRlciwgYXR0ZW1wdE51bWJlciwgbWF4UmV0cmllcywgZGVsYXlCZXR3ZWVuUmV0cmllcykgJiYgaXNMYXN0QXR0ZW1wdCkge1xuICAgICAgICAgICAgICAgIC8vIElmIGl0J3MgdGhlIGxhc3QgYXR0ZW1wdCBhbmQgZXJyb3IgaGFuZGxpbmcgZGlkbid0IHJlc29sdmUgaXQsIHJldGhyb3dcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBUaGlzIHNob3VsZCBuZXZlciBiZSByZWFjaGVkIGJlY2F1c2UgdGhlIGxhc3QgaXRlcmF0aW9uIHdpbGwgZWl0aGVyXG4gICAgLy8gcmV0dXJuIGEgc3VjY2Vzc2Z1bCByZXNwb25zZSBvciB0aHJvdyBhbiBlcnJvclxuICAgIHRocm93IG5ldyBFcnJvcignUmVxdWVzdCBmYWlsZWQgYWZ0ZXIgbWF4aW11bSByZXRyeSBhdHRlbXB0cycpO1xufVxuXG4vKipcbiAqIEV4dHJhY3RzIGNvbGxlY3Rpb24gZGF0YSBmcm9tIEFQSSByZXNwb25zZVxuICogQHBhcmFtIHJlc3BvbnNlIC0gVGhlIHJhdyBBUEkgcmVzcG9uc2VcbiAqIEByZXR1cm5zIFRoZSBjb2xsZWN0aW9uIGRhdGEgb3IgbnVsbCBpZiBpbnZhbGlkIHJlc3BvbnNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0Q29sbGVjdGlvbkRhdGEocmVzcG9uc2U6IGFueSk6IGFueSB7XG4gICAgY29uc3QgaXNWYWxpZFJlc3BvbnNlID0gcmVzcG9uc2UgJiYgcmVzcG9uc2UucmVzdWx0ICYmIHJlc3BvbnNlLml0ZW07XG4gICAgXG4gICAgaWYgKGlzVmFsaWRSZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuaXRlbTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGZldGNoIGNvbGxlY3Rpb24gaW5mbzonLCByZXNwb25zZSk7XG4gICAgcmV0dXJuIG51bGw7XG59XG4iLCAiaW1wb3J0IHsgTm90aWNlIH0gZnJvbSAnb2JzaWRpYW4nO1xuXG4vKipcbiAqIFlBTUwgVXRpbGl0aWVzIGZvciBNYWtlIEl0IFJhaW5cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyB1dGlsaXRpZXMgZm9yIHNhZmVseSBjcmVhdGluZyBZQU1MIGZyb250bWF0dGVyIGluIE1hcmtkb3duIGZpbGVzLlxuICogVGhlc2UgZnVuY3Rpb25zIGhhbmRsZSBwcm9wZXIgZXNjYXBpbmcgYW5kIGZvcm1hdHRpbmcgb2YgdmFyaW91cyBkYXRhIHR5cGVzIHRvIGVuc3VyZVxuICogdmFsaWQgWUFNTCBpcyBnZW5lcmF0ZWQgcmVnYXJkbGVzcyBvZiBpbnB1dCBjb250ZW50LlxuICovXG5cbi8qKlxuICogVHlwZSBndWFyZCB0byBjaGVjayBpZiBhIHZhbHVlIGlzIGEgcGxhaW4gb2JqZWN0XG4gKiBcbiAqIEBwYXJhbSB2YWx1ZSAtIFZhbHVlIHRvIGNoZWNrXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB2YWx1ZSBpcyBhIHBsYWluIG9iamVjdCAobm90IG51bGwsIG5vdCBhbiBhcnJheSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzUGxhaW5PYmplY3QodmFsdWU6IGFueSk6IHZhbHVlIGlzIFJlY29yZDxzdHJpbmcsIGFueT4ge1xuICAgIHJldHVybiB2YWx1ZSAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmICFBcnJheS5pc0FycmF5KHZhbHVlKTtcbn1cblxuLyoqXG4gKiBGb3JtYXRzIGEgSmF2YVNjcmlwdCB2YWx1ZSBhcyBhIFlBTUwgc3RyaW5nIHdpdGggcHJvcGVyIGVzY2FwaW5nXG4gKiBcbiAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBmb3JtYXQgYXMgWUFNTFxuICogQHBhcmFtIGluZGVudExldmVsIC0gQ3VycmVudCBpbmRlbnRhdGlvbiBsZXZlbCAoZm9yIG5lc3RlZCBzdHJ1Y3R1cmVzKVxuICogQHJldHVybnMgUHJvcGVybHkgZm9ybWF0dGVkIGFuZCBlc2NhcGVkIFlBTUwgc3RyaW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRZYW1sVmFsdWUodmFsdWU6IGFueSwgaW5kZW50TGV2ZWw6IG51bWJlciA9IDApOiBzdHJpbmcge1xuICAgIGNvbnN0IGluZGVudCA9ICcgICcucmVwZWF0KGluZGVudExldmVsKTtcbiAgICBcbiAgICAvLyBIYW5kbGUgbnVsbC91bmRlZmluZWRcbiAgICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gJ251bGwnO1xuICAgIH1cbiAgICBcbiAgICAvLyBIYW5kbGUgYm9vbGVhbnNcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlID8gJ3RydWUnIDogJ2ZhbHNlJztcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIG51bWJlcnNcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIHN0cmluZ3MgLSB0aGUgbW9zdCBjb21tb24gY2FzZVxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBzdHJpbmcgbmVlZHMgc3BlY2lhbCBoYW5kbGluZ1xuICAgICAgICBpZiAoXG4gICAgICAgICAgICB2YWx1ZS5pbmNsdWRlcygnXFxuJykgfHwgXG4gICAgICAgICAgICB2YWx1ZS5pbmNsdWRlcygnOicpIHx8IFxuICAgICAgICAgICAgdmFsdWUuaW5jbHVkZXMoJ3snKSB8fCBcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCd9JykgfHxcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCdbJykgfHxcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCddJykgfHxcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCcjJykgfHxcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCcqJykgfHxcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCcmJykgfHxcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCchJykgfHxcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCd8JykgfHxcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCc+JykgfHxcbiAgICAgICAgICAgIHZhbHVlLmluY2x1ZGVzKCdgJykgfHxcbiAgICAgICAgICAgIHZhbHVlLnRyaW0oKSA9PT0gJycgfHxcbiAgICAgICAgICAgIC9eWzAtOV0vLnRlc3QodmFsdWUpIHx8IC8vIFN0YXJ0cyB3aXRoIG51bWJlclxuICAgICAgICAgICAgL150cnVlJHxeZmFsc2UkfF55ZXMkfF5ubyR8Xm9uJHxeb2ZmJC9pLnRlc3QodmFsdWUpIC8vIExvb2tzIGxpa2UgYSBib29sZWFuXG4gICAgICAgICkge1xuICAgICAgICAgICAgLy8gSWYgdGhlIHN0cmluZyBjb250YWlucyBuZXdsaW5lcywgdXNlIHRoZSBibG9jayBzY2FsYXIgc3ludGF4XG4gICAgICAgICAgICBpZiAodmFsdWUuaW5jbHVkZXMoJ1xcbicpKSB7XG4gICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBsaXRlcmFsIGJsb2NrIHNjYWxhciAofCkgZm9yIHByZXNlcnZpbmcgbGluZSBicmVha3NcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gJ3xcXG4nO1xuICAgICAgICAgICAgICAgIGNvbnN0IGxpbmVzID0gdmFsdWUuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICAgICAgICAgICAgICAvLyBBZGQgdHdvIG1vcmUgc3BhY2VzIGZvciB0aGUgYmxvY2sgaW5kZW50YXRpb25cbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAke2luZGVudH0gICR7bGluZX1cXG5gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LnRyaW1FbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHVzZSBxdW90ZWQgc3RyaW5nIHdpdGggZXNjYXBpbmdcbiAgICAgICAgICAgIHJldHVybiBgXCIke2VzY2FwZVlhbWxTdHJpbmcodmFsdWUpfVwiYDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRm9yIHNpbXBsZSBzdHJpbmdzLCBubyBxdW90ZXMgbmVlZGVkXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gICAgXG4gICAgLy8gSGFuZGxlIGFycmF5c1xuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJ1tdJztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbGV0IHJlc3VsdCA9ICdcXG4nO1xuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdmFsdWUpIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSBgJHtpbmRlbnR9LSAke2Zvcm1hdFlhbWxWYWx1ZShpdGVtLCBpbmRlbnRMZXZlbCArIDEpfVxcbmA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdC50cmltRW5kKCk7XG4gICAgfVxuICAgIFxuICAgIC8vIEhhbmRsZSBvYmplY3RzXG4gICAgaWYgKGlzUGxhaW5PYmplY3QodmFsdWUpKSB7XG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSk7XG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuICd7fSc7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGxldCByZXN1bHQgPSAnXFxuJztcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuICAgICAgICAgICAgY29uc3QgZm9ybWF0dGVkVmFsdWUgPSBmb3JtYXRZYW1sVmFsdWUodmFsdWVba2V5XSwgaW5kZW50TGV2ZWwgKyAxKTtcbiAgICAgICAgICAgIC8vIElmIHRoZSBmb3JtYXR0ZWQgdmFsdWUgc3RhcnRzIHdpdGggYSBuZXdsaW5lLCBpdCdzIGEgY29tcGxleCB2YWx1ZVxuICAgICAgICAgICAgaWYgKGZvcm1hdHRlZFZhbHVlLnN0YXJ0c1dpdGgoJ1xcbicpKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0ICs9IGAke2luZGVudH0ke2tleX06JHtmb3JtYXR0ZWRWYWx1ZX1cXG5gO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gYCR7aW5kZW50fSR7a2V5fTogJHtmb3JtYXR0ZWRWYWx1ZX1cXG5gO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQudHJpbUVuZCgpO1xuICAgIH1cbiAgICBcbiAgICAvLyBGYWxsYmFjayBmb3IgYW55IG90aGVyIHR5cGVzXG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZm9ybWF0dGluZyBZQU1MIHZhbHVlOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBgXCJFcnJvciBmb3JtYXR0aW5nIHZhbHVlXCJgO1xuICAgIH1cbn1cblxuLyoqXG4gKiBFc2NhcGVzIHNwZWNpYWwgY2hhcmFjdGVycyBpbiBhIHN0cmluZyBmb3IgWUFNTFxuICogXG4gKiBAcGFyYW0gc3RyIC0gU3RyaW5nIHRvIGVzY2FwZVxuICogQHJldHVybnMgRXNjYXBlZCBzdHJpbmcgc2FmZSBmb3IgWUFNTFxuICovXG5leHBvcnQgZnVuY3Rpb24gZXNjYXBlWWFtbFN0cmluZyhzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHN0clxuICAgICAgICAucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKSAvLyBFc2NhcGUgYmFja3NsYXNoZXMgZmlyc3RcbiAgICAgICAgLnJlcGxhY2UoL1wiL2csICdcXFxcXCInKSAgIC8vIEVzY2FwZSBkb3VibGUgcXVvdGVzXG4gICAgICAgIC5yZXBsYWNlKC9cXHQvZywgJ1xcXFx0JykgIC8vIEVzY2FwZSB0YWJzXG4gICAgICAgIC5yZXBsYWNlKC9cXHIvZywgJ1xcXFxyJyk7IC8vIEVzY2FwZSBjYXJyaWFnZSByZXR1cm5zXG4gICAgLy8gTm90ZTogV2UgZG9uJ3QgZXNjYXBlIG5ld2xpbmVzIGJlY2F1c2UgdGhleSdyZSBoYW5kbGVkIHNlcGFyYXRlbHlcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgWUFNTCBmcm9udG1hdHRlciBzZWN0aW9uIGZvciBhIE1hcmtkb3duIGZpbGVcbiAqIFxuICogQHBhcmFtIGRhdGEgLSBPYmplY3QgY29udGFpbmluZyB0aGUgZnJvbnRtYXR0ZXIgZGF0YVxuICogQHJldHVybnMgRm9ybWF0dGVkIFlBTUwgZnJvbnRtYXR0ZXIgYXMgYSBzdHJpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVlhbWxGcm9udG1hdHRlcihkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogc3RyaW5nIHtcbiAgICB0cnkge1xuICAgICAgICBsZXQgZnJvbnRtYXR0ZXIgPSAnLS0tXFxuJztcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRhdGEpKSB7XG4gICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWRWYWx1ZSA9IGZvcm1hdFlhbWxWYWx1ZSh2YWx1ZSk7XG4gICAgICAgICAgICAvLyBJZiB0aGUgZm9ybWF0dGVkIHZhbHVlIHN0YXJ0cyB3aXRoIGEgbmV3bGluZSwgaXQncyBhIGNvbXBsZXggdmFsdWVcbiAgICAgICAgICAgIGlmIChmb3JtYXR0ZWRWYWx1ZS5zdGFydHNXaXRoKCdcXG4nKSkge1xuICAgICAgICAgICAgICAgIGZyb250bWF0dGVyICs9IGAke2tleX06JHtmb3JtYXR0ZWRWYWx1ZX1cXG5gO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmcm9udG1hdHRlciArPSBgJHtrZXl9OiAke2Zvcm1hdHRlZFZhbHVlfVxcbmA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZyb250bWF0dGVyICs9ICctLS1cXG5cXG4nO1xuICAgICAgICByZXR1cm4gZnJvbnRtYXR0ZXI7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIFlBTUwgZnJvbnRtYXR0ZXI6XCIsIGVycm9yKTtcbiAgICAgICAgbmV3IE5vdGljZShcIkVycm9yIGNyZWF0aW5nIG5vdGUgZnJvbnRtYXR0ZXIuIENoZWNrIGNvbnNvbGUgZm9yIGRldGFpbHMuXCIpO1xuICAgICAgICByZXR1cm4gJy0tLVxcbnRpdGxlOiBcIkVycm9yIGNyZWF0aW5nIGZyb250bWF0dGVyXCJcXG4tLS1cXG5cXG4nO1xuICAgIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBa0JBLElBQUFBLG1CQUE2SjtBQUM3SixJQUFBQSxtQkFBeUM7OztBQ1V6QyxlQUFzQixjQUFjLEtBQVUsTUFBZ0M7QUFDMUUsU0FBTyxJQUFJLE1BQU0sUUFBUSxPQUFPLElBQUk7QUFDeEM7QUFRQSxlQUFzQixjQUFjLEtBQVUsTUFBZ0M7QUFDMUUsUUFBTSxPQUFPLE1BQU0sSUFBSSxNQUFNLFFBQVEsS0FBSyxJQUFJO0FBQzlDLFVBQU8sNkJBQU0sVUFBUztBQUMxQjtBQVFBLGVBQXNCLGFBQWEsS0FBVSxNQUFnQztBQUN6RSxRQUFNLGtCQUFrQixNQUFNLGNBQWMsS0FBSyxJQUFJO0FBRXJELE1BQUksaUJBQWlCO0FBQ2pCLFVBQU0sV0FBVyxNQUFNLGNBQWMsS0FBSyxJQUFJO0FBQzlDLFFBQUksU0FBVSxRQUFPO0FBQ3JCLFVBQU0sSUFBSSxNQUFNLG9DQUFvQyxJQUFJLEVBQUU7QUFBQSxFQUM5RDtBQUVBLE1BQUk7QUFDQSxVQUFNLElBQUksTUFBTSxhQUFhLElBQUk7QUFDakMsV0FBTztBQUFBLEVBQ1gsU0FBUyxPQUFPO0FBQ1osVUFBTSxlQUFlLGlCQUFpQixRQUFRLE1BQU0sVUFBVSxPQUFPLEtBQUs7QUFDMUUsVUFBTSxJQUFJLE1BQU0sOEJBQThCLElBQUksS0FBSyxZQUFZLEVBQUU7QUFBQSxFQUN6RTtBQUNKO0FBT08sU0FBUyxpQkFBaUIsVUFBMEI7QUFDdkQsUUFBTSxlQUFlO0FBQ3JCLFFBQU0sY0FBYztBQUdwQixRQUFNLGdCQUFnQixDQUFDLFlBQVksU0FBUyxLQUFLLE1BQU07QUFDdkQsTUFBSSxjQUFlLFFBQU87QUFFMUIsUUFBTSxnQkFBZ0IsU0FBUyxRQUFRLGNBQWMsV0FBVyxFQUFFLEtBQUs7QUFDdkUsUUFBTSxtQkFB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T0FBTyxTQUFTLGVBQWUsRUFDN0MsU0FBUyxPQUFPLFVBQWtCO0FBQ2pDLGFBQUssT0FBTyxTQUFTLGtCQUFrQixNQUFNLEtBQUs7QUFDOUMsY0FBTSxLQUFLLE9BQU8sYUFBYTtBQUFBLE1BQ25DLENBQUM7QUFBQSxJQUNQLENBQUM7QUFFRixnQkFBWSxTQUFTLElBQUk7QUFFekIsVUFBTSxTQUFTLFlBQVksVUFBVSxFQUFFLEtBQUssaUJBQWlCLENBQUM7QUFDOUQsV0FBTyxTQUFTLEtBQUssRUFBRSxNQUFNLCtEQUErRCxDQUFDO0FBQzdGLFdBQU8sU0FBUyxLQUFLLEVBQUUsTUFBTSw0QkFBNEIsTUFBTSw2Q0FBNkMsTUFBTSxFQUFFLFFBQVEsVUFBVSxLQUFLLHNCQUFzQixFQUFFLENBQUM7QUFBQSxFQUN2SztBQUFBLEVBRUEsTUFBTSxpQkFBZ0M7QUFDcEMsVUFBTSxFQUFFLGlCQUFpQixJQUFJLEtBQUssT0FBTztBQUV6QyxRQUFJLENBQUMsa0JBQWtCO0FBQ3JCLFVBQUksd0JBQU8sb0NBQW9DLEdBQUk7QUFDbkQ7QUFBQSxJQUNGO0FBRUEsUUFBSSx3QkFBTywwQkFBMEIsR0FBSTtBQUV6QyxVQUFNLGFBQWE7QUFDbkIsVUFBTSxlQUE0QjtBQUFBLE1BQ2hDLFNBQVM7QUFBQSxRQUNQLGlCQUFpQixVQUFVLGdCQUFnQjtBQUFBLFFBQzNDLGdCQUFnQjtBQUFBLE1BQ2xCO0FBQUEsSUFDRjtBQUVBLFFBQUk7QUFFRixZQUFNLFdBQVcsVUFBTSwwQkFBUTtBQUFBLFFBQzdCLEtBQUssR0FBRyxVQUFVO0FBQUEsUUFDbEIsUUFBUTtBQUFBLFFBQ1IsU0FBUyxhQUFhO0FBQUEsTUFDeEIsQ0FBQztBQUVELFVBQUk7QUFDSixVQUFJLE9BQU8sYUFBYSxVQUFVO0FBQ2hDLGVBQU8sS0FBSyxNQUFNLFFBQVE7QUFBQSxNQUM1QixPQUFPO0FBQ0wsZUFBTztBQUFBLE1BQ1Q7QUFFQSxVQUFJLEtBQUssUUFBUTtBQUNmLFlBQUksd0JBQU8sdUJBQXVCLEdBQUk7QUFBQSxNQUN4QyxPQUFPO0FBRUwsY0FBTSxlQUFlLEtBQUssV0FBVyxLQUFLLFNBQVM7QUFDbkQsWUFBSSx3QkFBTyxrQ0FBa0MsWUFBWSxJQUFJLEdBQUs7QUFDbEUsZ0JBQVEsTUFBTSxrQ0FBa0MsSUFBSTtBQUFBLE1BQ3REO0FBQUEsSUFDRixTQUFTLE9BQU87QUFDZCxVQUFJLFdBQVc7QUFDZixVQUFJLGlCQUFpQixNQUFPLFlBQVcsTUFBTTtBQUFBLGVBQ3BDLE9BQU8sVUFBVSxTQUFVLFlBQVc7QUFDL0MsVUFBSSx3QkFBTyxrQ0FBa0MsUUFBUSxJQUFJLEdBQUs7QUFDOUQsY0FBUSxNQUFNLDhCQUE4QixLQUFLO0FBQUEsSUFDbkQ7QUFBQSxFQUNGO0FBQ0Y7IiwKICAibmFtZXMiOiBbImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiX2EiLCAiY29sbGVjdGlvbklkIl0KfQo=
